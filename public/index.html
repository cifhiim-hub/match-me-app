<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MatchMe Pro | Enterprise Edition</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200;400;600;800&family=Rubik:wght@900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/framer-motion/10.16.4/framer-motion.umd.min.js"></script>

    <style>
        :root {
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --accent: #10b981;
            --danger: #ef4444;
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
        }

        /* ×¢×™×¦×•×‘ ×›×œ×œ×™ ×•×× ×™×¢×ª ×’×œ×™×œ×” ××™×•×ª×¨×ª */
        body {
            font-family: 'Assistant', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            margin: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* ×× ×™××¦×™×•×ª ×›× ×™×¡×” ×—×œ×§×•×ª */
        .page-transition {
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ×›×¨×˜×™×¡×™×•×ª ×–×›×•×›×™×ª ××©×•×¤×¨×•×ª */
        .glass-panel {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 28px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
        }

        /* ×¢×™×¦×•×‘ ×›×¤×ª×•×¨×™× "×× ×•×¤×—×™×" (Neumorphism touch) */
        .btn-action {
            background: linear-gradient(145deg, var(--primary), var(--primary-dark));
            transition: all 0.2s ease;
            box-shadow: 0 4px 14px 0 rgba(59, 130, 246, 0.39);
        }

        .btn-action:active {
            transform: scale(0.96);
            filter: brightness(0.9);
        }

        /* ×©×•×¨×ª × ×™×•×•×˜ ×¦×¤×” */
        .floating-nav {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            height: 70px;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 35px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            padding: 0 10px;
        }

        .nav-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-dim);
            transition: 0.3s;
            font-size: 10px;
            font-weight: 700;
        }

        .nav-link.active {
            color: var(--primary);
        }

        .nav-link svg {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
        }

        /* ×©×“×•×ª ×§×œ×˜ ××•×“×¨× ×™×™× */
        .input-modern {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 16px;
            padding: 16px;
            color: white;
            width: 100%;
            transition: 0.3s border-color;
        }

        .input-modern:focus {
            border-color: var(--primary);
            outline: none;
            background: #1e293b;
        }

        /* ××¢×¨×›×ª ×”×ª×¨××•×ª Toast */
        #toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
        }

        .toast {
            background: var(--bg-card);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            margin-bottom: 10px;
            box-shadow: 0 10px 15px rgba(0,0,0,0.3);
            border: 1px solid var(--primary);
            animation: toastIn 0.3s ease forwards;
        }

        @keyframes toastIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <div id="toast-container"></div>

    <div id="app-loader" class="fixed inset-0 bg-slate-950 z-[10000] flex flex-col items-center justify-center">
        <div class="relative">
            <div class="w-20 h-20 border-4 border-blue-500/20 rounded-full animate-spin"></div>
            <div class="absolute inset-0 border-t-4 border-blue-500 rounded-full animate-spin"></div>
        </div>
        <h2 class="mt-6 font-black text-2xl tracking-tighter italic">MATCH<span class="text-blue-500">ME</span></h2>
    </div>

    <section id="view-feed" class="page-content px-5 pt-8 pb-32">
        <header class="flex justify-between items-center mb-8">
            <div>
                <p class="text-xs font-bold text-blue-400 uppercase tracking-widest">×‘×•×§×¨ ×˜×•×‘,</p>
                <h1 class="text-3xl font-extrabold" id="display-user-name">××•×¨×—/×ª</h1>
            </div>
            <div class="w-12 h-12 glass-panel flex items-center justify-center text-xl" onclick="Router.go('profile')">ğŸ‘¤</div>
        </header>

        <div class="relative mb-8 group">
            <input type="text" id="search-input" class="input-modern pr-12" placeholder="×—×¤×© ××©×¨×”, ××™×§×•× ××• ×—×‘×¨×”...">
            <span class="absolute right-4 top-1/2 -translate-y-1/2 opacity-40">ğŸ”</span>
        </div>

        <div class="flex gap-3 overflow-x-auto no-scrollbar mb-8 pb-2" id="filter-bar">
            <button class="filter-btn active bg-blue-600 px-6 py-2.5 rounded-2xl text-sm font-bold whitespace-nowrap">×”×›×œ</button>
            <button class="filter-btn bg-slate-800 px-6 py-2.5 rounded-2xl text-sm font-bold whitespace-nowrap">ğŸ¢ ××©×¨×•×ª</button>
            <button class="filter-btn bg-slate-800 px-6 py-2.5 rounded-2xl text-sm font-bold whitespace-nowrap">ğŸ‘· ×¢×•×‘×“×™×</button>
            <button class="filter-btn bg-slate-800 px-6 py-2.5 rounded-2xl text-sm font-bold whitespace-nowrap">â­ ××•×¢×“×¤×™×</button>
        </div>

        <div id="feed-container" class="space-y-5">
            </div>
    </section>

    <nav class="floating-nav">
        <div class="nav-link active" onclick="Router.go('feed')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            ×œ×•×—
        </div>
        <div class="nav-link" onclick="Router.go('post')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            ×¤×¨×¡×
        </div>
        <div class="nav-link" onclick="Router.go('admin')">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
            × ×™×”×•×œ
        </div>
    </nav>

    <script>
        // ×”×× ×œ×”××©×™×š ×œ×—×œ×§ ×‘' ×¢× ×›×œ ×”×œ×•×’×™×§×” ×©×œ Firebase ×•×”×¤×•× ×§×¦×™×•×ª ×”××•×¨×›×‘×•×ª?
    </script>
</body>
</html>
    <section id="view-post" class="page-content hidden px-5 pt-8 pb-32">
        <h2 class="text-3xl font-black mb-2">×¦×•×¨ ××•×“×¢×” ×—×“×©×”</h2>
        <p class="text-slate-400 text-sm mb-8">××œ× ××ª ×”×¤×¨×˜×™× ×›×“×™ ×œ××¦×•× ××ª ×”×”×ª×××” ×”××•×©×œ××ª</p>

        <div class="glass-panel p-6 space-y-5">
            <div>
                <label class="block text-xs font-bold mb-2 opacity-50 uppercase tracking-tighter">×¡×•×’ ×”××•×“×¢×”</label>
                <div class="grid grid-cols-2 gap-3">
                    <button id="type-job" onclick="Form.setType('job')" class="py-3 rounded-xl border-2 border-blue-500 bg-blue-500/10 font-bold text-sm">ğŸ’¼ ××—×¤×© ×¢×•×‘×“</button>
                    <button id="type-worker" onclick="Form.setType('worker')" class="py-3 rounded-xl border-2 border-transparent bg-slate-800 font-bold text-sm opacity-50">ğŸ‘· ××—×¤×© ×¢×‘×•×“×”</button>
                </div>
            </div>

            <div class="space-y-4">
                <input type="text" id="inp-title" class="input-modern" placeholder="×›×•×ª×¨×ª (×œ××©×œ: × ×”×’ ××©××™×ª ×¢×“ 12 ×˜×•×Ÿ)">
                <input type="text" id="inp-name" class="input-modern" placeholder="×©× ×”×¢×¡×§ / ×©× ×”××¤×¨×¡×">
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="inp-city" class="input-modern" placeholder="×¢×™×¨">
                    <input type="tel" id="inp-phone" class="input-modern" placeholder="×˜×œ×¤×•×Ÿ ×œ×•×•××˜×¡××¤">
                </div>
                <textarea id="inp-desc" class="input-modern h-32" placeholder="×ª××¨ ××ª ×”×ª×¤×§×™×“, ×”×“×¨×™×©×•×ª ××• ×”× ×™×¡×™×•×Ÿ ×©×œ×š..."></textarea>
            </div>

            <div id="smart-quiz-builder" class="mt-6 pt-6 border-t border-slate-700">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-sm font-bold text-blue-400 uppercase">×©××œ×•×ª ×¡×™× ×•×Ÿ (×›×Ÿ/×œ×)</h3>
                    <span class="text-[10px] bg-blue-500/20 px-2 py-1 rounded">××•××œ×¥</span>
                </div>
                <div id="quiz-inputs-list" class="space-y-3">
                    <input type="text" class="quiz-q-input input-modern py-3 text-sm" placeholder="×œ××©×œ: ×”×× ×™×© ×œ×š × ×™×¡×™×•×Ÿ ×©×œ ×©× ×ª×™×™×?">
                </div>
                <button onclick="Form.addQuestion()" class="mt-3 text-xs font-bold text-blue-400 hover:text-white transition">+ ×”×•×¡×£ ×©××œ×” ×œ××•×¢××“</button>
            </div>

            <button onclick="Data.publish()" class="btn-action w-full py-5 rounded-2xl font-black text-lg mt-8">×¤×¨×¡× ×‘×œ×•×— ×›×¢×ª ğŸš€</button>
        </div>
    </section>

    <section id="view-admin" class="page-content hidden px-5 pt-8 pb-32">
        <div id="admin-auth" class="text-center py-10">
            <div class="w-20 h-20 bg-blue-500/10 rounded-full flex items-center justify-center mx-auto mb-6 text-3xl">ğŸ”</div>
            <h2 class="text-2xl font-black mb-2">××–×•×¨ ×× ×”×œ×™×</h2>
            <p class="text-slate-400 text-sm mb-8 px-10">×”×ª×—×‘×¨ ×›×“×™ ×œ× ×”×œ ××ª ×”××•×“×¢×•×ª ×©×œ×š ×•×œ×¦×¤×•×ª ×‘×¤× ×™×•×ª ×××•×¢××“×™×</p>
            
            <div class="space-y-3 max-w-sm mx-auto">
                <input type="email" id="auth-email" class="input-modern" placeholder="××™××™×™×œ">
                <input type="password" id="auth-pass" class="input-modern" placeholder="×¡×™×¡××”">
                <button onclick="Auth.process('login')" class="btn-action w-full py-4 rounded-xl font-bold">×”×ª×—×‘×¨×•×ª</button>
                <button onclick="Auth.process('signup')" class="w-full py-3 text-sm text-slate-500 font-bold uppercase tracking-widest">×™×¦×™×¨×ª ×—×©×‘×•×Ÿ ×—×“×©</button>
            </div>
        </div>

        <div id="admin-dash" class="hidden">
            <div class="flex justify-between items-end mb-8">
                <h2 class="text-3xl font-black">×”× ×™×”×•×œ ×©×œ×™</h2>
                <button onclick="Auth.logout()" class="text-xs font-bold text-red-400 underline">×”×ª× ×ª×§</button>
            </div>

            <div class="mb-10">
                <h3 class="text-xs font-bold text-blue-400 uppercase tracking-widest mb-4">××•×“×¢×•×ª ×©×¤×¨×¡××ª×™</h3>
                <div id="my-posts-container" class="space-y-3">
                    </div>
            </div>

            <div>
                <h3 class="text-xs font-bold text-green-400 uppercase tracking-widest mb-4">×¤× ×™×•×ª ×—×“×©×•×ª (×œ×™×“×™×)</h3>
                <div id="leads-container" class="space-y-4">
                    </div>
            </div>
        </div>
    </section>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ×”×’×“×¨×•×ª ××¢×¨×›×ª
        const firebaseConfig = {
            apiKey: "AIzaSyD0hsz8SOI1OG2Fh-DBy1SHeabPaEKZx-Y",
            authDomain: "matchme-32bcf.firebaseapp.com",
            projectId: "matchme-32bcf",
            storageBucket: "matchme-32bcf.appspot.com",
            appId: "1:1082863959305:web:f888f4df815598696c601f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // × ×™×”×•×œ ××¦×‘ ×’×œ×•×‘×œ×™ (State Management)
        const GlobalState = {
            user: null,
            posts: [],
            currentView: 'feed',
            filters: { type: 'all', search: '' },
            postForm: { type: 'job' }
        };

        // ××¢×¨×›×ª × ×™×ª×•×‘ ×¤× ×™××™×ª (Router)
        const Router = {
            go(viewId) {
                // ×”×¡×ª×¨×ª ×›×œ ×”×“×¤×™×
                document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
                // ×”×¦×’×ª ×”×“×£ ×”××‘×•×§×©
                const target = document.getElementById(`view-${viewId}`);
                if (target) {
                    target.classList.remove('hidden');
                    target.classList.add('page-transition');
                }
                
                // ×¢×“×›×•×Ÿ ×ª×¤×¨×™×˜ × ×™×•×•×˜
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                // ×œ×•×’×™×§×” ×œ×¢×“×›×•×Ÿ ×”-UI ×œ×¤×™ ×”-View
                GlobalState.currentView = viewId;
                if(viewId === 'feed') Data.loadFeed();
                if(viewId === 'admin') UI.refreshAdmin();
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        };

        // ××¢×¨×›×ª ×”×•×“×¢×•×ª Toast
        const Toast = {
            show(msg, duration = 3000) {
                const container = document.getElementById('toast-container');
                const t = document.createElement('div');
                t.className = 'toast';
                t.innerText = msg;
                container.appendChild(t);
                setTimeout(() => t.remove(), duration);
            }
        };

        // ×œ×•×’×™×§×ª ×˜×¤×¡×™×
        const Form = {
            setType(type) {
                GlobalState.postForm.type = type;
                const isJob = type === 'job';
                document.getElementById('type-job').className = isJob ? 'py-3 rounded-xl border-2 border-blue-500 bg-blue-500/10 font-bold text-sm' : 'py-3 rounded-xl border-2 border-transparent bg-slate-800 font-bold text-sm opacity-50';
                document.getElementById('type-worker').className = !isJob ? 'py-3 rounded-xl border-2 border-green-500 bg-green-500/10 font-bold text-sm' : 'py-3 rounded-xl border-2 border-transparent bg-slate-800 font-bold text-sm opacity-50';
                document.getElementById('smart-quiz-builder').style.display = isJob ? 'block' : 'none';
            },
            addQuestion() {
                const list = document.getElementById('quiz-inputs-list');
                const input = document.createElement('input');
                input.className = "quiz-q-input input-modern py-3 text-sm mt-2";
                input.placeholder = "×©××œ×” × ×•×¡×¤×ª...";
                list.appendChild(input);
            }
        };

        // --- ×›××Ÿ ×™×‘×•× ×—×œ×§ ×’' ×¢× ×¤×•× ×§×¦×™×•×ª ×”-Data, ×”-App ×•×”-Auth ×”××œ××•×ª ---
        window.Router = Router;
        window.Form = Form;
        window.Toast = Toast;
    </sc        // --- × ×™×”×•×œ × ×ª×•× ×™× (Firebase Data) ---
        const Data = {
            // ×˜×¢×™× ×ª ×”×œ×•×— ×”×¨××©×™
            async loadFeed() {
                UI.toggleLoader(true);
                try {
                    const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
                    const snap = await getDocs(q);
                    GlobalState.posts = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    UI.renderFeed(GlobalState.posts);
                } catch (e) {
                    Toast.show("×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×");
                    console.error(e);
                }
                UI.loaderFadeOut();
            },

            // ×¤×¨×¡×•× ××•×“×¢×” ×—×“×©×”
            async publish() {
                const title = document.getElementById('inp-title').value.trim();
                const phone = document.getElementById('inp-phone').value.trim();
                if(!title || phone.length < 9) return Toast.show("×—×•×‘×” ×œ××œ× ×›×•×ª×¨×ª ×•×˜×œ×¤×•×Ÿ ×ª×§×™×Ÿ");

                UI.toggleLoader(true);
                const questions = Array.from(document.querySelectorAll('.quiz-q-input'))
                                     .map(i => i.value.trim())
                                     .filter(v => v !== "");

                try {
                    await addDoc(collection(db, "posts"), {
                        type: GlobalState.postForm.type,
                        title: title,
                        name: document.getElementById('inp-name').value.trim() || "××¢×¡×™×§/×¢×•×‘×“",
                        city: document.getElementById('inp-city').value.trim() || "×›×œ ×”××¨×¥",
                        phone: phone.replace(/\D/g, ''),
                        desc: document.getElementById('inp-desc').value.trim(),
                        questions: questions,
                        owner: GlobalState.user ? GlobalState.user.uid : "guest",
                        createdAt: serverTimestamp()
                    });
                    Toast.show("×”××•×“×¢×” ×¤×•×¨×¡××” ×‘×”×¦×œ×—×”!");
                    Router.go('feed');
                } catch (e) {
                    Toast.show("×ª×§×œ×” ×‘×¤×¨×¡×•×. × ×¡×” ×©× ×™×ª.");
                }
                UI.toggleLoader(false);
            },

            // ××—×™×§×ª ××•×“×¢×”
            async deletePost(id) {
                if(!confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”××•×“×¢×”?")) return;
                UI.toggleLoader(true);
                await deleteDoc(doc(db, "posts", id));
                UI.refreshAdmin();
                UI.toggleLoader(false);
                Toast.show("×”××•×“×¢×” × ××—×§×”");
            }
        };

        // --- × ×™×”×•×œ ×××©×§ ××©×ª××© (UI) ---
        const UI = {
            toggleLoader(show) { 
                document.getElementById('app-loader').style.display = show ? 'flex' : 'none'; 
            },
            loaderFadeOut() {
                const l = document.getElementById('app-loader');
                l.style.transition = "opacity 0.5s";
                l.style.opacity = "0";
                setTimeout(() => l.style.display = 'none', 500);
            },

            renderFeed(list) {
                const container = document.getElementById('feed-container');
                if(list.length === 0) {
                    container.innerHTML = `<div class="text-center py-20 opacity-30 font-bold">×œ× × ××¦××• ××•×“×¢×•×ª ×›×¨×’×¢</div>`;
                    return;
                }

                container.innerHTML = list.map(item => `
                    <div class="glass-panel p-5 border-r-4 ${item.type === 'job' ? 'border-blue-500' : 'border-green-500'} active:scale-95 transition-transform" onclick="App.initApply('${item.id}')">
                        <div class="flex justify-between items-start mb-3">
                            <span class="text-[10px] font-black uppercase px-2 py-1 rounded bg-slate-900 ${item.type === 'job' ? 'text-blue-400' : 'text-green-400'}">
                                ${item.type === 'job' ? 'ğŸ’¼ ×“×¨×•×©×™×' : 'ğŸ‘· ××—×¤×© ×¢×‘×•×“×”'}
                            </span>
                            <span class="text-xs text-slate-400 font-bold">ğŸ“ ${item.city}</span>
                        </div>
                        <h3 class="text-xl font-bold mb-1">${item.title}</h3>
                        <p class="text-sm text-blue-400 font-bold mb-3">${item.name}</p>
                        <div class="text-[10px] text-slate-500 line-clamp-2 mb-4">${item.desc || '××™×Ÿ ×ª×™××•×¨ × ×•×¡×£'}</div>
                        <div class="flex items-center text-blue-500 text-[10px] font-black uppercase tracking-widest">
                            ×œ×—×¥ ×œ×”×’×©×ª ××•×¢××“×•×ª ×•×‘×“×™×§×ª ×”×ª×××” âœ¨
                        </div>
                    </div>
                `).join('');
            },

            async refreshAdmin() {
                if(!GlobalState.user) return;
                document.getElementById('admin-auth').classList.add('hidden');
                document.getElementById('admin-dash').classList.remove('hidden');

                // ×˜×¢×™× ×ª ××•×“×¢×•×ª ×©×œ×™
                const pSnap = await getDocs(query(collection(db, "posts"), where("owner", "==", GlobalState.user.uid)));
                const myPosts = document.getElementById('my-posts-container');
                myPosts.innerHTML = pSnap.docs.map(d => `
                    <div class="p-4 bg-slate-800 rounded-2xl flex justify-between items-center shadow-inner">
                        <span class="font-bold text-sm">${d.data().title}</span>
                        <button onclick="Data.deletePost('${d.id}')" class="text-red-400 text-xs bg-red-900/20 px-3 py-2 rounded-xl">××—×§</button>
                    </div>
                `).join('') || '<p class="text-xs opacity-30">×˜×¨× ×¤×¨×¡××ª ××•×“×¢×•×ª</p>';

                // ×˜×¢×™× ×ª ×œ×™×“×™× (×¤× ×™×•×ª ××œ×™)
                const lSnap = await getDocs(query(collection(db, "leads"), where("bossID", "==", GlobalState.user.uid), orderBy("createdAt", "desc")));
                const leads = document.getElementById('leads-container');
                leads.innerHTML = lSnap.docs.map(d => {
                    const l = d.data();
                    return `
                    <div class="glass-panel p-4 border-r-4 border-green-500">
                        <div class="flex justify-between items-center mb-4">
                            <div>
                                <div class="font-bold">${l.candidateName}</div>
                                <div class="text-[10px] opacity-40 uppercase">${l.jobTitle}</div>
                            </div>
                            <div class="text-green-400 font-black text-2xl">${l.matchScore}%</div>
                        </div>
                        <div class="flex gap-2">
                            <a href="https://wa.me/972${l.candidatePhone.substring(1)}" class="flex-1 text-center py-2.5 bg-green-600/20 text-green-400 rounded-xl text-xs font-bold">WhatsApp</a>
                            <a href="tel:${l.candidatePhone}" class="flex-1 text-center py-2.5 bg-blue-600/20 text-blue-400 rounded-xl text-xs font-bold">×”×ª×§×©×¨</a>
                        </div>
                    </div>`;
                }).join('') || '<p class="text-xs opacity-30">××™×Ÿ ×¤× ×™×•×ª ×—×“×©×•×ª</p>';
            }
        };

        // --- ×œ×•×’×™×§×ª ×”××¤×œ×™×§×¦×™×” (×©××œ×•×Ÿ ×•×”×’×©×”) ---
        const App = {
            async initApply(postId) {
                const post = GlobalState.posts.find(p => p.id === postId);
                if(!post) return;

                // ×× ×–×” ×¢×•×‘×“ ×©××—×¤×© ×¢×‘×•×“×” - ×™×©×¨ ×œ×•×•××˜×¡××¤
                if(post.type === 'worker' || !post.questions?.length) {
                    App.finishApply(post, 100);
                    return;
                }

                // ×‘×§×©×ª ×¤×¨×˜×™× ××”××•×¢××“
                let name = localStorage.getItem('user_name') || prompt("××” ×©××š ×”××œ×?");
                let phone = localStorage.getItem('user_phone') || prompt("××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ×™×¦×™×¨×ª ×§×©×¨?");
                if(!name || !phone) return Toast.show("×—×•×‘×” ×œ×”×–×™×Ÿ ×¤×¨×˜×™× ×œ×”×’×©×”");
                
                localStorage.setItem('user_name', name);
                localStorage.setItem('user_phone', phone);
                
                // ×”×ª×—×œ×ª ×©××œ×•×Ÿ (×× ×’× ×•×Ÿ ×¤×©×•×˜ ×‘×ª×•×š prompt ×œ×˜×•×‘×ª ×—×™×¡×›×•×Ÿ ×‘×§×•×“)
                let score = 0;
                for(let q of post.questions) {
                    if(confirm(q)) score += (100 / post.questions.length);
                }
                
                App.finishApply(post, Math.round(score), name, phone);
            },

            async finishApply(post, score, name = "××•×¢××“", phone = "050") {
                UI.toggleLoader(true);
                try {
                    await addDoc(collection(db, "leads"), {
                        bossID: post.owner,
                        jobTitle: post.title,
                        candidateName: name,
                        candidatePhone: phone.replace(/\D/g,''),
                        matchScore: score,
                        createdAt: serverTimestamp()
                    });
                    
                    const msg = encodeURIComponent(`×”×™×™, ×× ×™ ××¢×•× ×™×™×Ÿ ×‘××©×¨×”: ${post.title}. ×©××™ ${name}. ×¦×™×•×Ÿ ×”×”×ª×××” ×©×œ×™ ×”×•× ${score}%`);
                    window.location.href = `https://wa.me/972${post.phone.substring(1)}?text=${msg}`;
                } catch(e) {
                    Toast.show("×©×’×™××” ×‘×©×œ×™×—×ª ×”×¤× ×™×™×”");
                }
                UI.toggleLoader(false);
            }
        };

        // --- ××™××•×ª ××©×ª××©×™× (Auth) ---
        const Auth = {
            async process(mode) {
                const email = document.getElementById('auth-email').value;
                const pass = document.getElementById('auth-pass').value;
                if(!email || pass.length < 6) return Toast.show("××™×™×œ ×œ× ×ª×§×™×Ÿ ××• ×¡×™×¡××” ×§×¦×¨×” ××“×™");

                UI.toggleLoader(true);
                try {
                    mode === 'login' 
                        ? await signInWithEmailAndPassword(auth, email, pass)
                        : await createUserWithEmailAndPassword(auth, email, pass);
                    Toast.show("×‘×¨×•×š ×”×‘×!");
                } catch (e) {
                    Toast.show("×©×’×™××”: " + e.message);
                }
                UI.toggleLoader(false);
            },
            logout() {
                signOut(auth).then(() => {
                    Toast.show("×”×ª× ×ª×§×ª ×‘×”×¦×œ×—×”");
                    location.reload();
                });
            }
        };

        // ×”××–× ×” ×œ××¦×‘ ×—×™×‘×•×¨ ××©×ª××©
        onAuthStateChanged(auth, user => {
            GlobalState.user = user;
            if(user) {
                document.getElementById('display-user-name').innerText = user.email.split('@')[0];
                UI.refreshAdmin();
            }
        });

        // ××ª×—×•×œ ×¨××©×•× ×™
        Data.loadFeed();
        
        // ×—×©×™×¤×ª ×¤×•× ×§×¦×™×•×ª ×œ×—×œ×•×Ÿ ×”×’×œ×•×‘×œ×™ (×œ×©×™××•×© ×‘-HTML)
        window.Data = Data;
        window.Auth = Auth;
        window.App = App;
        window.UI = UI;
ript>
</body>
</html>
