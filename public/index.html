<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MatchMe Pro | Enterprise Recruitment System</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200;300;400;500;600;700;800&family=Rubik:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-main: #020617;
            --bg-card: #0f172a;
            --bg-card-hover: #1e293b;
            --primary: #3b82f6;
            --primary-glow: rgba(59, 130, 246, 0.5);
            --accent: #10b981;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --glass-border: rgba(255, 255, 255, 0.08);
            --transition-bounce: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; margin: 0; padding: 0; }

        body {
            font-family: 'Assistant', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            overflow-x: hidden;
            line-height: 1.6;
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .glass-morphism {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
        }

        .btn-neo {
            background: linear-gradient(135deg, #1d4ed8, #3b82f6);
            transition: var(--transition-bounce);
            border-radius: 16px;
            font-weight: 800;
            cursor: pointer;
        }

        .btn-neo:hover { transform: scale(1.02); box-shadow: 0 0 20px var(--primary-glow); }

        .input-premium {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 18px 24px;
            color: white;
            outline: none;
            width: 100%;
        }

        .bottom-nav {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 450px; height: 75px; z-index: 1000;
            border-radius: 35px; display: flex; justify-content: space-around; align-items: center;
        }

        .nav-link { display: flex; flex-direction: column; align-items: center; color: var(--text-dim); cursor: pointer; }
        .nav-link.active { color: var(--primary); transform: translateY(-5px); }

        .view-section { display: none; padding: 20px; min-height: 100vh; padding-bottom: 120px; animation: slideUp 0.6s ease-out forwards; }
        .view-section.active { display: block; }

        #master-loader {
            position: fixed; inset: 0; background: var(--bg-main); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }

        .pulse-logo { width: 80px; height: 80px; background: var(--primary); border-radius: 20px; animation: float 2s infinite ease-in-out; }

        .feed-card {
            background: var(--bg-card); border-radius: 24px; padding: 20px; margin-bottom: 20px;
            border-right: 5px solid var(--primary); transition: all 0.3s ease; cursor: pointer;
        }
        .feed-card:hover { transform: translateX(-5px); background: var(--bg-card-hover); }
        .feed-card.worker-post { border-right-color: var(--accent); }
        .animate-fade-in { animation: fadeIn 0.5s ease forwards; }
    </style>
</head>
<body>

    <div id="master-loader">
        <div class="pulse-logo flex items-center justify-center text-3xl">ğŸ”¥</div>
        <div class="mt-8 text-center animate-pulse">
            <h2 class="text-2xl font-black text-white">MATCHME <span class="text-blue-500">PRO</span></h2>
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.4em] mt-2">Enterprise Edition 2026</p>
        </div>
    </div>

    <div id="toast-container" class="fixed top-6 left-6 right-6 z-[10001] flex flex-col gap-3 pointer-events-none"></div>

    <section id="view-feed" class="view-section active max-w-2xl mx-auto">
        <header class="flex justify-between items-center py-8 mb-4">
            <div>
                <span class="text-[10px] font-black text-blue-500 uppercase tracking-widest block mb-1">×”×–×“×× ×•×™×•×ª ×—×“×©×•×ª</span>
                <h1 class="text-5xl font-black tracking-tighter italic">×”×¤×™×“ <span class="text-blue-500">×©×œ×š</span></h1>
            </div>
            <div onclick="Router.go('admin')" class="w-14 h-14 glass-morphism rounded-2xl flex items-center justify-center text-2xl cursor-pointer border border-blue-500/20">ğŸ‘¤</div>
        </header>

        <div class="relative mb-10">
            <input type="text" oninput="UI.handleSearch(this.value)" class="input-premium pl-14 text-lg" placeholder="×—×¤×© ×ª×¤×§×™×“, ×¢×™×¨ ××• ×—×‘×¨×”...">
            <span class="absolute left-5 top-1/2 -translate-y-1/2 text-xl opacity-40">ğŸ”</span>
        </div>

        <div id="feed-container" class="space-y-6"></div>
    </section>

    <section id="view-post" class="view-section max-w-2xl mx-auto">
        <h2 class="text-4xl font-black mb-10">×™×¦×™×¨×ª <span class="text-blue-500">××•×“×¢×”</span></h2>
        <div class="glass-morphism p-8 rounded-[40px] space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <select id="field-type" onchange="UI.toggleSmartQuiz()" class="input-premium bg-slate-900 font-bold">
                    <option value="job">ğŸ’¼ ×× ×™ ××’×™×™×¡ ×¢×•×‘×“×™×</option>
                    <option value="worker">ğŸ™‹â€â™‚ï¸ ×× ×™ ××—×¤×© ×¢×‘×•×“×”</option>
                </select>
                <input type="text" id="field-title" class="input-premium" placeholder="×›×•×ª×¨×ª ×”××©×¨×”">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <input type="text" id="field-name" class="input-premium" placeholder="×©× ×”××¤×¨×¡×">
                <input type="text" id="field-city" class="input-premium" placeholder="××™×§×•×/×¢×™×¨">
            </div>
            <input type="tel" id="field-phone" class="input-premium" placeholder="×˜×œ×¤×•×Ÿ ×œ×•×•××˜×¡××¤ (05x...)">
            <textarea id="field-desc" class="input-premium h-32" placeholder="×ª×™××•×¨ ×—×•×¤×©×™..."></textarea>

            <div id="smart-quiz-builder" class="pt-6 border-t border-white/5">
                <h4 class="font-black text-blue-400 mb-4">×©××œ×•×Ÿ ×¡×™× ×•×Ÿ ×—×›×</h4>
                <div id="quiz-inputs-container" class="space-y-3">
                    <input type="text" class="quiz-q-input input-premium py-3 text-sm" placeholder="×©××œ×” ×œ×“×•×’××”: ×”×× ×™×© ×œ×š ×¨×›×‘?">
                </div>
                <button onclick="UI.addNewQuizField()" class="w-full mt-4 py-2 border border-dashed border-white/20 rounded-xl text-xs uppercase opacity-60 hover:opacity-100">+ ×”×•×¡×£ ×©××œ×”</button>
            </div>

            <button onclick="Data.handlePublish()" class="btn-neo w-full py-5 text-xl">×¤×¨×¡× ×¢×›×©×™×• ğŸš€</button>
        </div>
    </section>

    <section id="view-admin" class="view-section max-w-2xl mx-auto">
        <div id="auth-panel" class="py-12">
            <div class="text-center mb-10">
                <h2 class="text-4xl font-black italic mb-2">×›× ×™×¡×ª <span class="text-blue-500">×× ×”×œ×™×</span></h2>
            </div>
            <div class="glass-morphism p-8 rounded-[40px] space-y-4">
                <input type="email" id="auth-email" class="input-premium" placeholder="××™××™×™×œ">
                <input type="password" id="auth-pass" class="input-premium" placeholder="×¡×™×¡××”">
                <button onclick="Auth.process('login')" class="btn-neo w-full py-4">×›× ×™×¡×”</button>
                <button onclick="Auth.process('signup')" class="w-full text-blue-400 text-xs font-bold uppercase mt-4">×¦×•×¨ ×—×©×‘×•×Ÿ ×—×“×©</button>
            </div>
        </div>

        <div id="dashboard-panel" class="hidden space-y-10">
            <div class="flex justify-between items-center">
                <h2 class="text-3xl font-black italic">×”× ×™×”×•×œ <span class="text-blue-500">×©×œ×™</span></h2>
                <button onclick="Auth.logout()" class="text-red-500 text-xs font-black uppercase">×”×ª× ×ª×§ ğŸšª</button>
            </div>
            <div>
                <h3 class="text-xs font-black text-blue-500 uppercase tracking-widest mb-4">××•×“×¢×•×ª ×¤×¢×™×œ×•×ª</h3>
                <div id="my-listings-grid" class="space-y-3"></div>
            </div>
            <div>
                <h3 class="text-xs font-black text-green-500 uppercase tracking-widest mb-4">×¤× ×™×•×ª ×××•×¢××“×™×</h3>
                <div id="my-leads-grid" class="space-y-4"></div>
            </div>
        </div>
    </section>

    <nav class="bottom-nav glass-morphism border-white/10 shadow-2xl">
        <div class="nav-link active" id="nav-feed" onclick="Router.go('feed')"><span>ğŸ </span><span class="text-[9px] font-black uppercase mt-1">×œ×•×—</span></div>
        <div class="nav-link" id="nav-post" onclick="Router.go('post')"><span>â•</span><span class="text-[9px] font-black uppercase mt-1">×¤×¨×¡×</span></div>
        <div class="nav-link" id="nav-admin" onclick="Router.go('admin')"><span>ğŸ“Š</span><span class="text-[9px] font-black uppercase mt-1">× ×™×”×•×œ</span></div>
        <div class="nav-link" onclick="UI.showAppInfo()"><span>âš™ï¸</span><span class="text-[9px] font-black uppercase mt-1">××™×“×¢</span></div>
    </nav>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD0hsz8SOI1OG2Fh-DBy1SHeabPaEKZx-Y",
        authDomain: "matchme-32bcf.firebaseapp.com",
        projectId: "matchme-32bcf",
        storageBucket: "matchme-32bcf.firebasestorage.app",
        messagingSenderId: "1082863959305",
        appId: "1:1082863959305:web:d8da5ea69af003602c27d8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const GlobalState = { user: null, posts: [], currentView: 'feed', isSyncing: false };

    const Router = {
        go(viewId) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.getElementById(`view-${viewId}`).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(`nav-${viewId}`)?.classList.add('active');
            GlobalState.currentView = viewId;
            if (viewId === 'feed') Data.sync();
            if (viewId === 'admin') UI.refreshDashboard();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    };

    const Data = {
        async sync() {
            if (GlobalState.isSyncing) return;
            GlobalState.isSyncing = true;
            UI.toggleLoader(true);
            try {
                const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
                const snap = await getDocs(q);
                GlobalState.posts = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                UI.renderFeed(GlobalState.posts);
            } catch (e) { Toast.error("×©×’×™××ª ×¡× ×›×¨×•×Ÿ"); }
            finally { UI.toggleLoader(false); GlobalState.isSyncing = false; }
        },

        async handlePublish() {
            const title = document.getElementById('field-title').value;
            const phone = document.getElementById('field-phone').value;
            const name = document.getElementById('field-name').value;
            if (!title || !phone || !name) return Toast.warning("××œ× ×©×“×•×ª ×—×•×‘×”");

            UI.toggleLoader(true);
            try {
                const questions = Array.from(document.querySelectorAll('.quiz-q-input'))
                    .map(i => i.value.trim()).filter(v => v !== "");

                await addDoc(collection(db, "posts"), {
                    type: document.getElementById('field-type').value,
                    title, name, phone, 
                    city: document.getElementById('field-city').value || "×›×œ ×”××¨×¥",
                    desc: document.getElementById('field-desc').value,
                    questions,
                    owner: GlobalState.user?.uid || "guest",
                    createdAt: serverTimestamp()
                });
                Toast.success("×¤×•×¨×¡× ×‘×”×¦×œ×—×”!");
                Router.go('feed');
            } catch (e) { Toast.error("×©×’×™××” ×‘×¤×¨×¡×•×"); }
            finally { UI.toggleLoader(false); }
        }
    };

    const App = {
        async engage(postId) {
            const post = GlobalState.posts.find(p => p.id === postId);
            if (!post) return;

            const cName = prompt("××” ×©××š ×”××œ×?");
            const cPhone = prompt("××” ×”×˜×œ×¤×•×Ÿ ×©×œ×š?");
            if (!cName || !cPhone) return;

            let score = 100;
            if (post.questions?.length > 0) {
                let correct = 0;
                for (const q of post.questions) { if (confirm(`${q}\n(××™×©×•×¨=×›×Ÿ, ×‘×™×˜×•×œ=×œ×)`)) correct++; }
                score = Math.round((correct / post.questions.length) * 100);
            }

            try {
                UI.toggleLoader(true);
                await addDoc(collection(db, "leads"), {
                    bossID: post.owner, jobTitle: post.title,
                    candidateName: cName, candidatePhone: cPhone,
                    matchScore: score, createdAt: serverTimestamp()
                });
                
                let num = post.phone.replace(/\D/g, '');
                if (num.startsWith('0')) num = '972' + num.substring(1);
                window.location.href = `https://wa.me/${num}?text=${encodeURIComponent(`×”×™×™ ${post.name}, ×¤× ×™×ª×™ ×œ××©×¨×” "${post.title}". ×©××™ ${cName}, ×”×ª×××”: ${score}%`)}`;
            } catch (e) { Toast.error("×ª×§×œ×” ×‘×©×œ×™×—×”"); }
            finally { UI.toggleLoader(false); }
        }
    };

    const UI = {
        toggleLoader(s) { document.getElementById('master-loader').style.display = s ? 'flex' : 'none'; },
        renderFeed(list) {
            document.getElementById('feed-container').innerHTML = list.map(item => `
                <div class="feed-card animate-fade-in ${item.type !== 'job' ? 'worker-post' : ''}" onclick="App.engage('${item.id}')">
                    <h3 class="text-2xl font-black">${item.title}</h3>
                    <p class="text-blue-400 font-bold">${item.name} | ${item.city}</p>
                    <p class="text-slate-400 text-sm mt-2 opacity-80">${item.desc || ''}</p>
                </div>
            `).join('');
        },
        handleSearch(val) {
            const filtered = GlobalState.posts.filter(p => p.title.toLowerCase().includes(val.toLowerCase()));
            this.renderFeed(filtered);
        },
        async refreshDashboard() {
            if (!GlobalState.user) return;
            document.getElementById('auth-panel').classList.add('hidden');
            document.getElementById('dashboard-panel').classList.remove('hidden');

            const pSnap = await getDocs(query(collection(db, "posts"), where("owner", "==", GlobalState.user.uid)));
            document.getElementById('my-listings-grid').innerHTML = pSnap.docs.map(d => `
                <div class="glass-morphism p-4 rounded-xl flex justify-between items-center">
                    <span class="font-bold">${d.data().title}</span>
                    <button onclick="Data.deletePost('${d.id}')" class="text-red-500">ğŸ—‘ï¸</button>
                </div>
            `).join('') || '××™×Ÿ ××•×“×¢×•×ª';

            const lSnap = await getDocs(query(collection(db, "leads"), where("bossID", "==", GlobalState.user.uid)));
            document.getElementById('my-leads-grid').innerHTML = lSnap.docs.map(d => {
                const l = d.data();
                return `
                <div class="glass-morphism p-4 rounded-2xl border-r-4 border-green-500">
                    <h4 class="font-black">${l.candidateName}</h4>
                    <p class="text-xs text-blue-400">${l.jobTitle} | ${l.matchScore}% ×”×ª×××”</p>
                    <div class="flex gap-2 mt-3">
                        <a href="https://wa.me/972${l.candidatePhone.substring(1)}" class="bg-green-600 px-3 py-1 rounded-lg text-[10px] font-black">WhatsApp</a>
                        <a href="tel:${l.candidatePhone}" class="bg-slate-700 px-3 py-1 rounded-lg text-[10px] font-black">×”×ª×§×©×¨</a>
                    </div>
                </div>`;
            }).join('') || '××™×Ÿ ×¤× ×™×•×ª';
        },
        addNewQuizField() {
            const i = document.createElement('input');
            i.className = "quiz-q-input input-premium py-3 text-sm mt-2";
            i.placeholder = "×”×§×œ×“ ×©××œ×”...";
            document.getElementById('quiz-inputs-container').appendChild(i);
        },
        toggleSmartQuiz() {
            document.getElementById('smart-quiz-builder').style.display = document.getElementById('field-type').value === 'job' ? 'block' : 'none';
        },
        showAppInfo() { alert("MatchMe Pro 2026"); }
    };

    const Auth = {
        async process(mode) {
            const e = document.getElementById('auth-email').value, p = document.getElementById('auth-pass').value;
            UI.toggleLoader(true);
            try {
                if (mode === 'login') await signInWithEmailAndPassword(auth, e, p);
                else await createUserWithEmailAndPassword(auth, e, p);
                Router.go('admin');
            } catch (err) { Toast.error("×©×’×™××” ×‘×—×©×‘×•×Ÿ"); }
            finally { UI.toggleLoader(false); }
        },
        logout() { signOut(auth).then(() => location.reload()); }
    };

    const Toast = {
        show(m, type) {
            const t = document.createElement('div');
            t.className = `glass-morphism p-4 rounded-xl border-r-4 ${type === 'success' ? 'border-green-500' : 'border-red-500'}`;
            t.innerHTML = `<p class="font-bold text-sm">${m}</p>`;
            document.getElementById('toast-container').appendChild(t);
            setTimeout(() => t.remove(), 3000);
        },
        success(m) { this.show(m, 'success'); },
        error(m) { this.show(m, 'error'); },
        warning(m) { this.show(m, 'error'); }
    };

    onAuthStateChanged(auth, u => { GlobalState.user = u; UI.toggleLoader(false); });
    window.Router = Router; window.Data = Data; window.UI = UI; window.Auth = Auth; window.App = App;
    Data.sync();
</script>
</body>
</html>
