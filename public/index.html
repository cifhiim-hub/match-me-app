<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MatchMe | ×”×¤×œ×˜×¤×•×¨××” ×”×××•×—×“×ª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;800&family=Inter:wght@900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --bg: #0f172a; --card: #1e293b; --success: #10b981; }
        body { font-family: 'Assistant', sans-serif; background-color: var(--bg); color: #f8fafc; margin: 0; -webkit-tap-highlight-color: transparent; }
        
        .page { display: none; min-height: 100vh; padding: 20px 20px 120px; animation: slideUp 0.4s ease-out; }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .item-card { background: var(--card); border-radius: 24px; padding: 20px; margin-bottom: 16px; border: 1px solid rgba(255,255,255,0.05); transition: 0.3s; position: relative; overflow: hidden; }
        .item-card:active { transform: scale(0.98); background: #2d3748; }
        .item-card.worker { border-right: 4px solid var(--success); }
        .item-card.job { border-right: 4px solid var(--primary); }

        .btn-main { background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); color: white; border-radius: 16px; padding: 18px; width: 100%; font-weight: 800; border: none; box-shadow: 0 10px 20px -5px rgba(37, 99, 235, 0.4); }
        .input-p { background: #2d3748; border: 2px solid transparent; border-radius: 16px; padding: 16px; width: 100%; color: white; outline: none; transition: 0.3s; margin-bottom: 12px; }
        .input-p:focus { border-color: var(--primary); background: #334155; }

        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(15px); height: 85px; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid rgba(255,255,255,0.1); z-index: 1000; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { color: #64748b; font-size: 12px; text-align: center; font-weight: 800; transition: 0.3s; }
        .nav-item.active { color: var(--primary); }

        .badge { font-size: 10px; padding: 3px 8px; border-radius: 6px; font-weight: 800; margin-bottom: 8px; display: inline-block; }
        .badge-job { background: rgba(37, 99, 235, 0.2); color: #60a5fa; }
        .badge-worker { background: rgba(16, 185, 129, 0.2); color: #34d399; }

        #loader { position: fixed; inset: 0; background: var(--bg); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
    </style>
</head>
<body>

    <div id="loader"><div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div></div>

    <div id="page-feed" class="page active">
        <h1 style="font-family: 'Inter', sans-serif;" class="text-4xl font-black italic mb-8">MATCH<span class="text-blue-500">ME</span></h1>
        
        <div class="flex gap-2 mb-6 overflow-x-auto no-scrollbar">
            <button onclick="UI.filter('all')" class="bg-slate-800 px-5 py-2 rounded-full text-xs font-bold whitespace-nowrap">×”×›×œ</button>
            <button onclick="UI.filter('job')" class="bg-blue-600/20 text-blue-400 px-5 py-2 rounded-full text-xs font-bold whitespace-nowrap">××©×¨×•×ª</button>
            <button onclick="UI.filter('worker')" class="bg-green-600/20 text-green-400 px-5 py-2 rounded-full text-xs font-bold whitespace-nowrap">×¢×•×‘×“×™×</button>
        </div>

        <div id="feed-items" class="space-y-4"></div>
    </div>

    <div id="page-post" class="page">
        <h2 class="text-2xl font-black mb-6">××” ×ª×¨×¦×” ×œ×¤×¨×¡×?</h2>
        <div class="grid grid-cols-2 gap-4 mb-6">
            <button onclick="UI.setPostType('job')" id="type-job" class="input-p py-8 text-center border-2 border-blue-500">ğŸ¢<br>××©×¨×”</button>
            <button onclick="UI.setPostType('worker')" id="type-worker" class="input-p py-8 text-center border-2 border-transparent">ğŸ™‹â€â™‚ï¸<br>×¢×•×‘×“/×ª</button>
        </div>

        <div id="post-form" class="space-y-1">
            <input type="text" id="p-title" placeholder="×›×•×ª×¨×ª (×œ××©×œ: ××—×¤×© ×¢×‘×•×“×” ×‘× ×’×¨×•×ª / ×“×¨×•×© ××œ×¦×¨)" class="input-p">
            <input type="text" id="p-name" placeholder="×©× ×”×¢×¡×§ / ×©× ××œ×" class="input-p">
            <div class="grid grid-cols-2 gap-2">
                <input type="text" id="p-city" placeholder="×¢×™×¨" class="input-p">
                <input type="tel" id="p-phone" placeholder="×˜×œ×¤×•×Ÿ (05...)" class="input-p">
            </div>
            <textarea id="p-desc" placeholder="×ª×™××•×¨ ××¤×•×¨×˜..." class="input-p h-32"></textarea>
            
            <div id="job-only-fields" class="p-4 bg-slate-900/50 rounded-2xl mb-4 border border-slate-800">
                <p class="text-xs font-black text-blue-400 mb-3 uppercase">×©××œ×•×ª ×¡×™× ×•×Ÿ (×œ××¢×¡×™×§×™× ×‘×œ×‘×“):</p>
                <div id="q-list" class="space-y-2">
                    <input type="text" class="q-val input-p py-2 text-sm" placeholder="×©××œ×” (×›×Ÿ/×œ×) ×›××•: ×”×× ×™×© ×œ×š ×¨×›×‘?">
                </div>
                <button onclick="UI.addQ()" class="text-blue-500 text-xs mt-2 font-bold">+ ×”×•×¡×£ ×©××œ×”</button>
            </div>
            
            <button onclick="Data.save()" class="btn-main mt-4">×¤×¨×¡× ×‘×œ×•×— ×¢×›×©×™×• ğŸš€</button>
        </div>
    </div>

    <div id="page-admin" class="page">
        <div id="auth-box">
            <h2 class="text-2xl font-black mb-6">×›× ×™×¡×ª ××©×ª××©×™×</h2>
            <input type="email" id="auth-email" placeholder="××™××™×™×œ" class="input-p">
            <input type="password" id="auth-pass" placeholder="×¡×™×¡××” (6+ ×ª×•×•×™×)" class="input-p">
            <button onclick="Auth.exec('login')" class="btn-main">×”×ª×—×‘×¨</button>
            <button onclick="Auth.exec('signup')" class="w-full mt-4 text-slate-500 text-sm">×™×¦×™×¨×ª ×—×©×‘×•×Ÿ ×—×“×©</button>
        </div>
        <div id="dash-box" class="hidden">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-black">×”×¤×¨×¡×•××™× ×©×œ×™</h2>
                <button onclick="Auth.logout()" class="text-red-500 font-bold text-sm">×”×ª× ×ª×§</button>
            </div>
            <div id="my-items" class="space-y-4"></div>
            <hr class="my-10 border-slate-800">
            <h2 class="text-2xl font-black mb-4">×¤× ×™×•×ª ×××•×¢××“×™× (×œ×™×“×™×)</h2>
            <div id="leads-list" class="space-y-4"></div>
        </div>
    </div>

    <div id="page-quiz" class="page text-center">
        <div class="max-w-md mx-auto py-10">
            <div class="w-full bg-slate-800 h-2 rounded-full mb-10 overflow-hidden">
                <div id="quiz-progress" class="bg-blue-600 h-full w-0 transition-all"></div>
            </div>
            <h2 id="q-text" class="text-3xl font-black mb-16 leading-tight"></h2>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="App.answer(true)" class="btn-main py-10 text-2xl">×›×Ÿ</button>
                <button onclick="App.answer(false)" class="bg-slate-700 font-bold rounded-2xl py-10 text-2xl">×œ×</button>
            </div>
        </div>
    </div>

    <nav class="nav-bar">
        <div onclick="Nav.go('feed')" class="nav-item active" id="n-feed">ğŸ <br>×œ×•×—</div>
        <div onclick="Nav.go('post')" class="nav-item" id="n-post">â•<br>×¤×¨×¡×</div>
        <div onclick="Nav.go('admin')" class="nav-item" id="n-admin">ğŸ‘¤<br>××™×©×™</div>
    </nav>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { 
        apiKey: "AIzaSyD0hsz8SOI1O...", 
        authDomain: "matchme-32bcf.firebaseapp.com", 
        projectId: "matchme-32bcf", 
        storageBucket: "matchme-32bcf.appspot.com", 
        messagingSenderId: "1082863959305", 
        appId: "1:1082863959305:web:f888f4df815598696c601f" 
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const State = { user: null, all: [], type: 'job', quiz: { idx: 0, score: 0 }, activeJob: null };

    const Nav = {
        go(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${id}`).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(`n-${id}`).classList.add('active');
            if(id === 'feed') Data.load();
            if(id === 'admin') UI.renderDash();
        }
    };

    const Data = {
        async save() {
            UI.load(true);
            const title = document.getElementById('p-title').value.trim();
            const phone = document.getElementById('p-phone').value.replace(/\D/g,'');
            if(!title || phone.length < 9) { UI.load(false); return alert("××œ× ×›×•×ª×¨×ª ×•×˜×œ×¤×•×Ÿ ×ª×§×™×Ÿ"); }

            try {
                await addDoc(collection(db, "posts"), {
                    type: State.type,
                    title, phone,
                    name: document.getElementById('p-name').value || "×¤×¨×˜×™",
                    city: document.getElementById('p-city').value || "×›×œ ×”××¨×¥",
                    desc: document.getElementById('p-desc').value || "",
                    questions: State.type === 'job' ? Array.from(document.querySelectorAll('.q-val')).map(i => i.value).filter(v => v) : [],
                    owner: auth.currentUser?.uid || 'guest',
                    createdAt: serverTimestamp()
                });
                Nav.go('feed');
            } catch(e) { alert("×©×’×™××” ×‘×¤×¨×¡×•×"); }
            UI.load(false);
        },
        async load() {
            const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
            const snap = await getDocs(q);
            State.all = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            UI.render(State.all);
        }
    };

    const UI = {
        load(s) { document.getElementById('loader').style.display = s ? 'flex' : 'none'; },
        setPostType(t) {
            State.type = t;
            document.getElementById('type-job').style.borderColor = t === 'job' ? '#3b82f6' : 'transparent';
            document.getElementById('type-worker').style.borderColor = t === 'worker' ? '#10b981' : 'transparent';
            document.getElementById('job-only-fields').style.display = t === 'job' ? 'block' : 'none';
        },
        addQ() {
            const i = document.createElement('input');
            i.className = "q-val input-p py-2 text-sm mt-2";
            i.placeholder = "×©××œ×” × ×•×¡×¤×ª...";
            document.getElementById('q-list').appendChild(i);
        },
        filter(t) {
            UI.render(t === 'all' ? State.all : State.all.filter(i => i.type === t));
        },
        render(list) {
            const container = document.getElementById('feed-items');
            container.innerHTML = list.map(item => `
                <div class="item-card ${item.type}">
                    <span class="badge ${item.type === 'job' ? 'badge-job' : 'badge-worker'}">
                        ${item.type === 'job' ? 'ğŸ’¼ ×“×¨×•×© ×¢×•×‘×“' : 'ğŸ™‹â€â™‚ï¸ ×¢×•×‘×“ ×¤× ×•×™'}
                    </span>
                    <h3 class="text-xl font-bold">${item.title || '×œ×œ× ×›×•×ª×¨×ª'}</h3>
                    <p class="text-blue-400 text-sm font-bold">${item.name || '×× ×•× ×™××™'} â€¢ ${item.city || '×™×©×¨××œ'}</p>
                    <p class="text-slate-400 text-sm mt-2 line-clamp-2">${item.desc || ''}</p>
                    <button onclick="App.contact('${item.id}')" class="mt-4 w-full py-3 bg-slate-800 rounded-xl text-xs font-bold border border-slate-700">
                        ${item.type === 'job' ? '×”×’×© ××•×¢××“×•×ª' : '×¦×•×¨ ×§×©×¨ ×‘×•×•××˜×¡××¤'}
                    </button>
                </div>
            `).join('');
        },
        async renderDash() {
            if(!auth.currentUser) return;
            document.getElementById('auth-box').classList.add('hidden');
            document.getElementById('dash-box').classList.remove('hidden');
            
            // ×”××•×“×¢×•×ª ×©×œ×™
            const myQ = query(collection(db, "posts"), where("owner", "==", auth.currentUser.uid));
            const mySnap = await getDocs(myQ);
            document.getElementById('my-items').innerHTML = mySnap.docs.map(d => `
                <div class="p-4 bg-slate-800 rounded-xl text-sm flex justify-between">
                    <b>${d.data().title}</b>
                    <span class="opacity-50">${d.data().type === 'job' ? '××©×¨×”' : '×¢×•×‘×“'}</span>
                </div>
            `).join('') || '××™×Ÿ ××•×“×¢×•×ª ×¤×¢×™×œ×•×ª';

            // ×œ×™×“×™× ×©×œ×™
            const leadQ = query(collection(db, "leads"), where("boss", "==", auth.currentUser.uid));
            const leadSnap = await getDocs(leadQ);
            document.getElementById('leads-list').innerHTML = leadSnap.docs.map(d => {
                const l = d.data();
                return `
                <div class="item-card border-r-4 border-blue-500">
                    <div class="flex justify-between"><b>${l.name}</b> <span class="text-blue-400">${l.score}%</span></div>
                    <p class="text-xs opacity-50 mb-3">×œ××©×¨×ª: ${l.jobTitle}</p>
                    <a href="https://wa.me/972${l.phone.substring(1)}" class="text-xs bg-green-600 px-3 py-1 rounded-full font-bold">×•×•××˜×¡××¤</a>
                </div>`;
            }).join('') || '××™×Ÿ ×¤× ×™×•×ª ×¢×“×™×™×Ÿ';
        }
    };

    const App = {
        contact(id) {
            const item = State.all.find(i => i.id === id);
            if(item.type === 'worker') {
                window.location.href = `https://wa.me/972${item.phone.substring(1)}?text=${encodeURIComponent('×”×™×™, ×¨××™×ª×™ ××ª ×”×¤×¨×•×¤×™×œ ×©×œ×š ×‘-MatchMe')}`;
            } else {
                State.activeJob = item;
                const name = prompt("××” ×©××š ×”××œ×?");
                const phone = prompt("××” ××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×©×œ×š?");
                if(!name || !phone) return;
                State.applicant = { name, phone: phone.replace(/\D/g,'') };
                
                if(item.questions && item.questions.length > 0) {
                    State.quiz = { idx: 0, score: 0 };
                    Nav.go('quiz');
                    App.showQ();
                } else {
                    App.finish(100);
                }
            }
        },
        showQ() {
            const q = State.activeJob.questions[State.quiz.idx];
            document.getElementById('q-text').innerText = q;
            document.getElementById('quiz-progress').style.width = ((State.quiz.idx / State.activeJob.questions.length) * 100) + '%';
        },
        answer(val) {
            if(val) State.quiz.score += (100 / State.activeJob.questions.length);
            State.quiz.idx++;
            if(State.quiz.idx < State.activeJob.questions.length) App.showQ();
            else App.finish(Math.round(State.quiz.score));
        },
        async finish(score) {
            UI.load(true);
            const bossID = State.activeJob.owner || "manual";
            await addDoc(collection(db, "leads"), {
                boss: bossID,
                jobTitle: State.activeJob.title,
                name: State.applicant.name,
                phone: State.applicant.phone,
                score: score,
                createdAt: serverTimestamp()
            });
            UI.load(false);
            const msg = encodeURIComponent(`×”×™×™, ×× ×™ ${State.applicant.name}. ×”×’×©×ª×™ ××•×¢××“×•×ª ×œ××©×¨×ª ${State.activeJob.title} ×•×§×™×‘×œ×ª×™ ${score}% ×”×ª×××” ×‘×©××œ×•×Ÿ!`);
            window.location.href = `https://wa.me/972${State.activeJob.phone.substring(1)}?text=${msg}`;
        }
    };

    const Auth = {
        async exec(m) {
            UI.load(true);
            const e = document.getElementById('auth-email').value, p = document.getElementById('auth-pass').value;
            try {
                if(m === 'login') await signInWithEmailAndPassword(auth, e, p);
                else await createUserWithEmailAndPassword(auth, e, p);
                Nav.go('admin');
            } catch(e) { alert("×©×’×™××” ×‘×¤×¨×˜×™× (×¡×™×¡××” ×œ×¤×—×•×ª 6 ×ª×•×•×™×)"); }
            UI.load(false);
        },
        logout() { signOut(auth).then(() => location.reload()); }
    };

    onAuthStateChanged(auth, u => { State.user = u; Data.load(); });
    window.Nav = Nav; window.UI = UI; window.Data = Data; window.App = App; window.Auth = Auth;
</script>
</body>
</html>
