<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MatchMe Pro | Enterprise Recruitment System</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200;300;400;500;600;700;800&family=Rubik:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* =========================================
           ADVANCED DESIGN SYSTEM (PRO-LEVEL)
           ========================================= */
        :root {
            --bg-main: #020617;
            --bg-card: #0f172a;
            --bg-card-hover: #1e293b;
            --primary: #3b82f6;
            --primary-glow: rgba(59, 130, 246, 0.5);
            --accent: #10b981;
            --danger: #ef4444;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --glass-border: rgba(255, 255, 255, 0.08);
            --transition-bounce: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* Base Reset */
        * {
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            margin: 0; padding: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--bg-main);
        }

        body {
            font-family: 'Assistant', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            overflow-x: hidden;
            line-height: 1.6;
            touch-action: manipulation;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: var(--bg-main); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }

        /* =========================================
           ANIMATION KEYFRAMES
           ========================================= */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* =========================================
           REUSABLE COMPONENTS
           ========================================= */
        .glass-morphism {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .btn-neo {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #1d4ed8, #3b82f6);
            transition: var(--transition-bounce);
            border-radius: 16px;
            font-weight: 800;
            letter-spacing: 0.5px;
            cursor: pointer;
        }

        .btn-neo:hover {
            transform: scale(1.02);
            box-shadow: 0 0 20px var(--primary-glow);
        }

        .btn-neo:active { transform: scale(0.95); }

        .input-premium {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 18px 24px;
            color: white;
            transition: all 0.3s ease;
            width: 100%;
            outline: none;
        }

        .input-premium:focus {
            border-color: var(--primary);
            background: rgba(30, 41, 59, 0.8);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.2);
        }

        /* =========================================
           LAYOUT & NAVIGATION
           ========================================= */
        .bottom-nav {
            position: fixed;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 450px;
            height: 75px;
            z-index: 1000;
            border-radius: 35px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 15px;
        }

        .nav-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-dim);
            transition: all 0.3s ease;
            text-decoration: none;
            cursor: pointer;
            position: relative;
        }

        .nav-link.active {
            color: var(--primary);
            transform: translateY(-5px);
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            width: 5px;
            height: 5px;
            background: var(--primary);
            border-radius: 50%;
        }

        /* =========================================
           PAGE STATES
           ========================================= */
        .view-section {
            display: none;
            padding: 20px;
            min-height: 100vh;
            padding-bottom: 120px;
            animation: slideUp 0.6s ease-out forwards;
        }

        .view-section.active {
            display: block;
        }

        /* =========================================
           LOADER SYSTEM
           ========================================= */
        #master-loader {
            position: fixed;
            inset: 0;
            background: var(--bg-main);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease;
        }

        .pulse-logo {
            width: 80px;
            height: 80px;
            background: var(--primary);
            border-radius: 20px;
            animation: float 2s infinite ease-in-out;
            box-shadow: 0 0 30px var(--primary-glow);
        }

        /* Card Styling */
        .feed-card {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 20px;
            border-right: 5px solid var(--primary);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .feed-card:hover {
            background: var(--bg-card-hover);
            transform: translateX(-5px);
        }

        .feed-card.worker-post {
            border-right-color: var(--accent);
        }
    </style>
</head>
<body class="custom-scrollbar overflow-x-hidden">

    <div id="master-loader">
        <div class="pulse-logo flex items-center justify-center text-3xl">ğŸ”¥</div>
        <div class="mt-8 text-center animate-pulse">
            <h2 class="text-2xl font-black tracking-tighter text-white">MATCHME <span class="text-blue-500">PRO</span></h2>
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.4em] mt-2">Enterprise Edition 2026</p>
        </div>
    </div>

    <div id="toast-container" class="fixed top-6 left-6 right-6 z-[10001] flex flex-col gap-3 pointer-events-none"></div>

    <section id="view-feed" class="view-section active max-w-2xl mx-auto">
        <header class="flex justify-between items-center py-8 mb-4">
            <div>
                <span class="text-[10px] font-black text-blue-500 uppercase tracking-widest block mb-1">×”×–×“×× ×•×™×•×ª ×—×“×©×•×ª</span>
                <h1 class="text-5xl font-black tracking-tighter italic">×”×¤×™×“ <span class="text-blue-500">×©×œ×š</span></h1>
            </div>
            <div onclick="Router.go('admin')" class="w-14 h-14 glass-morphism rounded-2xl flex items-center justify-center text-2xl cursor-pointer hover:bg-blue-500/10 transition-colors border border-blue-500/20">
                ğŸ‘¤
            </div>
        </header>

        <div class="relative mb-10 group">
            <div class="absolute -inset-1 bg-gradient-to-r from-blue-600 to-cyan-500 rounded-2xl blur opacity-20 group-focus-within:opacity-40 transition duration-1000"></div>
            <div class="relative">
                <input type="text" id="main-search" oninput="UI.handleSearch(this.value)" 
                       class="input-premium pl-14 text-lg" 
                       placeholder="×—×¤×© ×ª×¤×§×™×“, ×—×‘×¨×” ××• ×¢×™×¨...">
                <span class="absolute left-5 top-1/2 -translate-y-1/2 text-xl opacity-40">ğŸ”</span>
            </div>
        </div>

        <div id="feed-container" class="space-y-6">
            <div class="py-20 text-center opacity-30">
                <div class="loader-circle mx-auto mb-4"></div>
                <p class="font-bold tracking-widest uppercase text-xs">××¡×ª× ×›×¨×Ÿ ×¢× ××¡×“ ×”× ×ª×•× ×™×...</p>
            </div>
        </div>
    </section>

    <section id="view-post" class="view-section max-w-2xl mx-auto">
        <div class="flex items-center gap-4 mb-10">
            <div class="w-2 h-10 bg-blue-500 rounded-full shadow-[0_0_15px_rgba(59,130,246,0.5)]"></div>
            <h2 class="text-4xl font-black tracking-tighter">×™×¦×™×¨×ª <span class="text-blue-500">××•×“×¢×”</span></h2>
        </div>

        <div class="glass-morphism p-8 rounded-[40px] space-y-8 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/5 blur-3xl rounded-full"></div>
            
            <div class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-[10px] font-black text-slate-500 uppercase mr-2 tracking-widest">×¡×•×’ ×”×¤×¨×¡×•×</label>
                        <select id="field-type" onchange="UI.toggleSmartQuiz()" class="input-premium bg-slate-900 font-bold">
                            <option value="job">ğŸ’¼ ×× ×™ ××’×™×™×¡ ×¢×•×‘×“×™× (××¢×¡×™×§)</option>
                            <option value="worker">ğŸ™‹â€â™‚ï¸ ×× ×™ ××—×¤×© ×¢×‘×•×“×” (××•×¢××“)</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-black text-slate-500 uppercase mr-2 tracking-widest">×›×•×ª×¨×ª ×”××•×“×¢×”</label>
                        <input type="text" id="field-title" class="input-premium" placeholder="×œ××©×œ: × ×”×’ ××©××™×ª C1">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-[10px] font-black text-slate-500 uppercase mr-2 tracking-widest">×©× ×”××¤×¨×¡×</label>
                        <input type="text" id="field-name" class="input-premium" placeholder="×—×‘×¨×” ××• ×©×">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-black text-slate-500 uppercase mr-2 tracking-widest">××™×§×•×</label>
                        <input type="text" id="field-city" class="input-premium" placeholder="×¢×™×¨/××–×•×¨">
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-[10px] font-black text-slate-500 uppercase mr-2 tracking-widest">×˜×œ×¤×•×Ÿ ×œ×™×¦×™×¨×ª ×§×©×¨ (WhatsApp)</label>
                    <input type="tel" id="field-phone" class="input-premium font-mono" placeholder="05x-xxxxxxx">
                </div>

                <div class="space-y-2">
                    <label class="text-[10px] font-black text-slate-500 uppercase mr-2 tracking-widest">×ª×™××•×¨ ××•×¨×—×‘</label>
                    <textarea id="field-desc" class="input-premium h-40 resize-none" placeholder="×¤×¨×˜ ×›××Ÿ ×¢×œ ×”××©×¨×” ××• ×¢×œ ×”× ×™×¡×™×•×Ÿ ×©×œ×š..."></textarea>
                </div>

                <div id="smart-quiz-builder" class="pt-8 border-t border-white/5">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h4 class="font-black text-blue-400">×©××œ×•×Ÿ ×¡×™× ×•×Ÿ ×—×›×</h4>
                            <p class="text-[9px] text-slate-500 font-bold uppercase tracking-tighter">AI Candidate Screening</p>
                        </div>
                        <span class="px-3 py-1 bg-blue-500/10 text-blue-500 text-[10px] font-black rounded-lg">BETA</span>
                    </div>
                    <div id="quiz-inputs-container" class="space-y-3">
                        <input type="text" class="quiz-q-input input-premium py-4 text-sm" placeholder="×©××œ×” 1: ×”×× ×™×© ×œ×š ×¨×™×©×™×•×Ÿ ×‘×ª×•×§×£?">
                    </div>
                    <button onclick="UI.addNewQuizField()" class="w-full mt-4 py-4 border-2 border-dashed border-white/5 rounded-2xl text-[10px] font-black text-slate-500 hover:text-white transition-all uppercase tracking-[0.2em]">
                        + ×”×•×¡×£ ×©××œ×ª ×¡×™× ×•×Ÿ
                    </button>
                </div>
            </div>

            <button onclick="Data.handlePublish()" class="btn-neo w-full py-6 text-xl shadow-2xl shadow-blue-500/20">
                ×¤×¨×¡× ××•×“×¢×” ×¢×›×©×™×• ğŸš€
            </button>
        </div>
    </section>

    <section id="view-admin" class="view-section max-w-2xl mx-auto">
        <div id="auth-panel" class="py-12">
            <div class="text-center mb-12">
                <div class="w-24 h-24 bg-blue-500/10 rounded-[35px] flex items-center justify-center text-4xl mx-auto mb-6 border border-blue-500/20">ğŸ”</div>
                <h2 class="text-4xl font-black italic">×›× ×™×¡×ª <span class="text-blue-500">×× ×”×œ×™×</span></h2>
                <p class="text-slate-500 font-bold mt-2">× ×”×œ ××ª ×”××•×“×¢×•×ª ×•×”×¤× ×™×•×ª ×©×œ×š</p>
            </div>
            
            <div class="glass-morphism p-10 rounded-[45px] space-y-6">
                <input type="email" id="auth-email" class="input-premium" placeholder="×“×•××¨ ××œ×§×˜×¨×•× ×™">
                <input type="password" id="auth-pass" class="input-premium" placeholder="×¡×™×¡××”">
                <button onclick="Auth.process('login')" class="btn-neo w-full py-5 text-lg">×›× ×™×¡×” ×œ××¢×¨×›×ª</button>
                <div class="relative py-4 flex items-center gap-4">
                    <div class="flex-1 h-px bg-white/5"></div>
                    <span class="text-[10px] font-black text-slate-600 uppercase">××•</span>
                    <div class="flex-1 h-px bg-white/5"></div>
                </div>
                <button onclick="Auth.process('signup')" class="w-full text-blue-400 font-black text-xs uppercase tracking-widest hover:text-white transition-colors">×™×¦×™×¨×ª ×—×©×‘×•×Ÿ ×—×“×©</button>
            </div>
        </div>

        <div id="dashboard-panel" class="hidden space-y-12 py-6">
            <div class="flex justify-between items-end border-b border-white/5 pb-8">
                <div>
                    <h2 class="text-4xl font-black italic">×”× ×™×”×•×œ <span class="text-blue-500">×©×œ×™</span></h2>
                    <p class="text-slate-500 font-bold uppercase text-[10px] tracking-widest mt-1">Control Center</p>
                </div>
                <button onclick="Auth.logout()" class="px-6 py-3 bg-red-500/10 text-red-500 text-[10px] font-black rounded-xl uppercase border border-red-500/20 hover:bg-red-500 hover:text-white transition-all">×”×ª× ×ª×§ ğŸšª</button>
            </div>

            <div>
                <h3 class="text-xs font-black text-blue-500 uppercase tracking-[0.3em] mb-6 flex items-center gap-2">
                    <span class="w-2 h-2 bg-blue-500 rounded-full animate-ping"></span> ××•×“×¢×•×ª ×¤×¢×™×œ×•×ª
                </h3>
                <div id="my-listings-grid" class="space-y-4"></div>
            </div>

            <div>
                <h3 class="text-xs font-black text-green-500 uppercase tracking-[0.3em] mb-6 flex items-center gap-2">
                    <span class="w-2 h-2 bg-green-500 rounded-full"></span> ×¤× ×™×•×ª ×××•×¢××“×™×
                </h3>
                <div id="my-leads-grid" class="space-y-6"></div>
            </div>
        </div>
    </section>

    <nav class="bottom-nav glass-morphism border-white/10 shadow-2xl">
        <div class="nav-link active" id="nav-feed" onclick="Router.go('feed')">
            <span class="text-2xl">ğŸ </span>
            <span class="text-[9px] font-black uppercase mt-1">×œ×•×—</span>
        </div>
        <div class="nav-link" id="nav-post" onclick="Router.go('post')">
            <span class="text-2xl">â•</span>
            <span class="text-[9px] font-black uppercase mt-1">×¤×¨×¡×</span>
        </div>
        <div class="nav-link" id="nav-admin" onclick="Router.go('admin')">
            <span class="text-2xl">ğŸ“Š</span>
            <span class="text-[9px] font-black uppercase mt-1">× ×™×”×•×œ</span>
        </div>
        <div class="nav-link" onclick="UI.showAppInfo()">
            <span class="text-2xl">âš™ï¸</span>
            <span class="text-[9px] font-black uppercase mt-1">××™×“×¢</span>
        </div>
    </nav>
<script type="module">
    // ×™×™×‘×•× ×ª×©×ª×™×•×ª ×”×œ×™×‘×” ×©×œ Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp, deleteDoc, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ×§×•× ×¤×™×’×•×¨×¦×™×™×ª ×¤×¨×•×™×§×˜ matchme-32bcf
    const firebaseConfig = {
        apiKey: "AIzaSyD0hsz8SOI1OG2Fh-DBy1SHeabPaEKZx-Y",
        authDomain: "matchme-32bcf.firebaseapp.com",
        projectId: "matchme-32bcf",
        storageBucket: "matchme-32bcf.appspot.com",
        appId: "1:1082863959305:web:f888f4df815598696c601f"
    };

    // ××ª×—×•×œ Instance ×’×œ×•×‘×œ×™
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    /**
     * GLOBAL STATE MANAGEMENT
     * × ×™×”×•×œ ××¦×‘ ×”××¤×œ×™×§×¦×™×” ×‘×–×™×›×¨×•×Ÿ ×”××¢×¨×›×ª
     */
    const GlobalState = {
        user: null,
        posts: [],
        filteredPosts: [],
        currentView: 'feed',
        lastUpdate: null,
        isSyncing: false
    };

    /**
     * ADVANCED ROUTER SYSTEM
     * × ×™×”×•×œ × ×™×•×•×˜ ×“×¤×™× ×—×›×
     */
    const Router = {
        go(viewId) {
            console.log(`%c [Router] Navigating to: ${viewId} `, 'background: #222; color: #bada55');
            
            // ×¢×“×›×•×Ÿ ×•×™×–×•××œ×™ ×©×œ ×“×¤×™×
            document.querySelectorAll('.view-section').forEach(section => {
                section.classList.remove('active');
            });
            
            const target = document.getElementById(`view-${viewId}`);
            if (target) {
                target.classList.add('active');
            }

            // ×¢×“×›×•×Ÿ ××¦×‘ ×›×¤×ª×•×¨×™ ×”× ×™×•×•×˜
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            const activeLink = document.getElementById(`nav-${viewId}`);
            if (activeLink) activeLink.classList.add('active');

            GlobalState.currentView = viewId;

            // ×œ×•×’×™×§×ª ×˜×¢×™× ×” ×™×™×¢×•×“×™×ª ×œ×¤×™ ×“×£
            if (viewId === 'feed') Data.sync();
            if (viewId === 'admin') UI.refreshDashboard();

            // ×’×œ×™×œ×” ×—×œ×§×” ×œ×¨××© ×”×“×£
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    };

    /**
     * DATA ACCESS LAYER (DAL)
     * ×¤×•× ×§×¦×™×•×ª ×œ×ª×§×©×•×¨×ª ××•×œ ×”-Database
     */
    const Data = {
        // ×¡× ×›×¨×•×Ÿ × ×ª×•× ×™× ××”×¢× ×Ÿ
        async sync() {
            if (GlobalState.isSyncing) return;
            GlobalState.isSyncing = true;
            UI.toggleLoader(true);

            try {
                const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                
                GlobalState.posts = querySnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                GlobalState.filteredPosts = [...GlobalState.posts];
                UI.renderFeed(GlobalState.filteredPosts);
                GlobalState.lastUpdate = new Date();
                
            } catch (error) {
                console.error("Sync Error:", error);
                Toast.error("×ª×§×œ×” ×‘×¡× ×›×¨×•×Ÿ ×”× ×ª×•× ×™×. × ×¡×” ×©×•×‘.");
            } finally {
                UI.toggleLoader(false);
                GlobalState.isSyncing = false;
            }
        },

        // ×¤×¨×¡×•× ××•×“×¢×” ×—×“×©×”
        async handlePublish() {
            const title = document.getElementById('field-title').value.trim();
            const phone = document.getElementById('field-phone').value.trim();
            const name = document.getElementById('field-name').value.trim();
            const type = document.getElementById('field-type').value;
            const city = document.getElementById('field-city').value.trim();
            const desc = document.getElementById('field-desc').value.trim();

            if (!title || !phone || !name) {
                return Toast.warning("× × ×œ××œ× ×©×“×•×ª ×—×•×‘×”: ×›×•×ª×¨×ª, ×©× ×•×˜×œ×¤×•×Ÿ");
            }

            UI.toggleLoader(true);

            // ××™×¡×•×£ ×©××œ×•×ª ×©××œ×•×Ÿ
            const questions = Array.from(document.querySelectorAll('.quiz-q-input'))
                .map(input => input.value.trim())
                .filter(val => val !== "");

            try {
                const postData = {
                    type,
                    title,
                    name,
                    city: city || "×›×œ ×”××¨×¥",
                    phone: phone.replace(/\D/g, ''),
                    desc,
                    questions: type === 'job' ? questions : [],
                    owner: GlobalState.user ? GlobalState.user.uid : "guest",
                    stats: { views: 0, leads: 0 },
                    createdAt: serverTimestamp()
                };

                await addDoc(collection(db, "posts"), postData);
                
                Toast.success("×”××•×“×¢×” ×¤×•×¨×¡××” ×‘×”×¦×œ×—×”! ğŸš€");
                this.resetForm();
                Router.go('feed');
                
            } catch (error) {
                console.error("Publish Error:", error);
                Toast.error("×©×’×™××” ×‘×¤×¨×¡×•×. ×•×•×“× ×©××ª×” ××—×•×‘×¨.");
            } finally {
                UI.toggleLoader(false);
            }
        },

        // ××—×™×§×ª ××•×“×¢×”
        async deletePost(postId) {
            if (!confirm("×œ××—×•×§ ××ª ×”××•×“×¢×” ×œ×¦××™×ª×•×ª?")) return;
            
            UI.toggleLoader(true);
            try {
                await deleteDoc(doc(db, "posts", postId));
                Toast.success("×”××•×“×¢×” ×”×•×¡×¨×”");
                UI.refreshDashboard();
            } catch (e) {
                Toast.error("×©×’×™××” ×‘××—×™×§×”");
            } finally {
                UI.toggleLoader(false);
            }
        },

        resetForm() {
            ['field-title', 'field-name', 'field-city', 'field-phone', 'field-desc'].forEach(id => {
                document.getElementById(id).value = "";
            });
            document.getElementById('quiz-inputs-container').innerHTML = `
                <input type="text" class="quiz-q-input input-premium py-4 text-sm" placeholder="×©××œ×” 1: ×”×× ×™×© ×œ×š ×¨×™×©×™×•×Ÿ ×‘×ª×•×§×£?">
            `;
        }
    };

    // ×—×©×™×¤×ª ××•×‘×™×™×§×˜×™× ×œ×—×œ×•×Ÿ ×”×’×œ×•×‘×œ×™ (×œ×©×™××•×© ×‘-HTML)
    window.Router = Router;
    window.Data = Data;
    window.GlobalState = GlobalState;
    window.db = db;
    window.auth = auth;
    /**
     * UI & UX ENGINE
     * × ×™×”×•×œ ×”×ª×¦×•×’×”, ×”×¨×™× ×“×•×¨ ×•×”××™× ×˜×¨××§×¦×™×•×ª
     */
    const UI = {
        // × ×™×”×•×œ ××¡×š ×˜×¢×™× ×” ×¢× ×× ×’× ×•×Ÿ ×”×’× ×”
        toggleLoader(show) {
            const loader = document.getElementById('master-loader');
            if (show) {
                loader.style.display = 'flex';
                loader.style.opacity = '1';
                // ×”×’× ×ª "×“×£ ×©×—×•×¨" - ×× ×”×©×¨×ª ×œ× ×¢×•× ×” ×ª×•×š 4 ×©× ×™×•×ª, ×©×—×¨×¨ ××ª ×”××¡×š
                setTimeout(() => {
                    if(loader.style.opacity === '1') this.toggleLoader(false);
                }, 4000);
            } else {
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 500);
            }
        },

        // ×¨×™× ×“×•×¨ ×œ×•×— ×”××•×“×¢×•×ª (×¤×™×“)
        renderFeed(list) {
            const container = document.getElementById('feed-container');
            if (!list || list.length === 0) {
                container.innerHTML = `
                    <div class="py-20 text-center animate-fade-in">
                        <div class="text-6xl mb-6 opacity-20">ğŸ”</div>
                        <h3 class="text-xl font-bold opacity-40">×œ× × ××¦××• ×ª×•×¦××•×ª ×ª×•×××•×ª</h3>
                        <p class="text-sm opacity-30 mt-2">× ×¡×” ×œ×©× ×•×ª ××ª ××™×œ×•×ª ×”×—×™×¤×•×©</p>
                    </div>`;
                return;
            }

            container.innerHTML = list.map((item, index) => {
                const isJob = item.type === 'job';
                return `
                <div class="feed-card animate-fade-in ${!isJob ? 'worker-post' : ''}" 
                     style="animation-delay: ${index * 0.05}s"
                     onclick="App.engage('${item.id}')">
                    <div class="flex justify-between items-start mb-4">
                        <span class="px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest ${isJob ? 'bg-blue-500/10 text-blue-500' : 'bg-emerald-500/10 text-emerald-500'}">
                            ${isJob ? 'ğŸ’¼ ×“×¨×•×©×™×' : 'ğŸ™‹â€â™‚ï¸ ××—×¤×© ×¢×‘×•×“×”'}
                        </span>
                        <span class="text-[11px] font-bold text-slate-500 opacity-60">ğŸ“ ${item.city}</span>
                    </div>
                    <h3 class="text-2xl font-black tracking-tight text-white mb-1">${item.title}</h3>
                    <p class="text-blue-400 font-bold text-sm mb-4">${item.name}</p>
                    <div class="flex items-center justify-between pt-4 border-t border-white/5 mt-2">
                        <div class="flex -space-x-2 rtl:space-x-reverse">
                            <div class="w-7 h-7 rounded-full bg-slate-800 border border-slate-700 flex items-center justify-center text-[10px]">âœ¨</div>
                        </div>
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-tighter hover:text-blue-500 transition-colors">
                            ${isJob ? '×‘×“×•×§ ×”×ª×××” ×•×”×’×© ××•×¢××“×•×ª >' : '×¦×¤×” ×‘×¤×¨×˜×™× ×•×¦×•×¨ ×§×©×¨ >'}
                        </span>
                    </div>
                </div>`;
            }).join('');
        },

        // ×—×™×¤×•×© ×—×›× ×‘×–××Ÿ ×××ª
        handleSearch(val) {
            const term = val.toLowerCase().trim();
            GlobalState.filteredPosts = GlobalState.posts.filter(p => 
                p.title.toLowerCase().includes(term) || 
                p.city.toLowerCase().includes(term) || 
                p.name.toLowerCase().includes(term)
            );
            this.renderFeed(GlobalState.filteredPosts);
        },

        // ×¨×¢× ×•×Ÿ ×“×©×‘×•×¨×“ ×”× ×™×”×•×œ
        async refreshDashboard() {
            if (!GlobalState.user) {
                document.getElementById('auth-panel').classList.remove('hidden');
                document.getElementById('dashboard-panel').classList.add('hidden');
                return;
            }

            document.getElementById('auth-panel').classList.add('hidden');
            const dash = document.getElementById('dashboard-panel');
            dash.classList.remove('hidden');

            try {
                // ×©×œ×™×¤×ª ××•×“×¢×•×ª ×”××©×ª××©
                const pSnap = await getDocs(query(collection(db, "posts"), where("owner", "==", GlobalState.user.uid)));
                const listingsGrid = document.getElementById('my-listings-grid');
                listingsGrid.innerHTML = pSnap.docs.map(d => `
                    <div class="glass-morphism p-5 rounded-2xl flex justify-between items-center group">
                        <div>
                            <p class="font-black text-white">${d.data().title}</p>
                            <p class="text-[10px] text-slate-500 font-bold uppercase mt-1">×¤×•×¨×¡× ×‘-${new Date(d.data().createdAt?.toDate()).toLocaleDateString('he-IL')}</p>
                        </div>
                        <button onclick="Data.deletePost('${d.id}')" class="w-10 h-10 rounded-xl bg-red-500/10 text-red-500 opacity-0 group-hover:opacity-100 transition-all hover:bg-red-500 hover:text-white">ğŸ—‘ï¸</button>
                    </div>
                `).join('') || '<p class="text-sm text-slate-600 italic">×˜×¨× ×¤×¨×¡××ª ××•×“×¢×•×ª...</p>';

                // ×©×œ×™×¤×ª ×œ×™×“×™× (×¤× ×™×•×ª)
                const lSnap = await getDocs(query(collection(db, "leads"), where("bossID", "==", GlobalState.user.uid), orderBy("createdAt", "desc")));
                const leadsGrid = document.getElementById('my-leads-grid');
                leadsGrid.innerHTML = lSnap.docs.map(d => {
                    const l = d.data();
                    return `
                    <div class="glass-morphism p-6 rounded-[30px] border-r-4 border-emerald-500 relative overflow-hidden">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-black text-xl text-white">${l.candidateName}</h4>
                                <p class="text-[10px] font-bold text-blue-400 uppercase tracking-widest">${l.jobTitle}</p>
                            </div>
                            <div class="bg-emerald-500/20 text-emerald-400 px-3 py-2 rounded-2xl font-black text-sm">
                                ${l.matchScore}% ×”×ª×××”
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3 mt-6">
                            <a href="https://api.whatsapp.com/send?phone=972${l.candidatePhone.substring(1)}" target="_blank" class="py-3 bg-emerald-600 text-white rounded-xl text-center text-[10px] font-black uppercase">WhatsApp</a>
                            <a href="tel:${l.candidatePhone}" class="py-3 bg-slate-700 text-white rounded-xl text-center text-[10px] font-black uppercase">×”×ª×§×©×¨</a>
                        </div>
                    </div>`;
                }).join('') || '<p class="text-sm text-slate-600 italic text-center py-10">××™×Ÿ ×¤× ×™×•×ª ×—×“×©×•×ª ×›×¨×’×¢</p>';

            } catch (e) { console.error("Dash Error:", e); }
        },

                addNewQuizField() {
            const container = document.getElementById('quiz-inputs-container');
            const input = document.createElement('input');
            input.className = "quiz-q-input input-premium py-4 text-sm animate-fade-in mt-2";
            input.placeholder = `×©××œ×” ${container.children.length + 1}: ×”×§×œ×“ ×©××œ×ª ×›×Ÿ/×œ×...`;
            container.appendChild(input);
        },

        toggleSmartQuiz() {
            const isJob = document.getElementById('field-type').value === 'job';
            const quizBuilder = document.getElementById('smart-quiz-builder');
            if (quizBuilder) {
                quizBuilder.style.display = isJob ? 'block' : 'none';
            }
        },

        showAppInfo() {
            alert("MatchMe Pro v3.0\n××¢×¨×›×ª ×’×™×•×¡ ×•× ×™×”×•×œ ××©×¨×•×ª ××ª×§×“××ª\n2026 Enterprise Edition\n× ×‘× ×” ×œ×‘×™×¦×•×¢×™× ××§×¡×™××œ×™×™× ×•× ×™×”×•×œ ×œ×™×“×™× ×—×›×.");
        }
    };

    /**
     * MATCHING ENGINE (The "Brain")
     * ×œ×•×’×™×§×ª ×”×—×™×‘×•×¨ ×‘×™×Ÿ ××•×¢××“×™× ×œ××©×¨×•×ª ×•×—×™×©×•×‘ ×¦×™×•× ×™ ×”×ª×××”
     */
    const App = {
        async engage(postId) {
            const post = GlobalState.posts.find(p => p.id === postId);
            if (!post) return;

            // ×× ×”××•×“×¢×” ×”×™× ××¡×•×’ "×“×¨×•×©×™×" - ×”××©×ª××© ×”× ×•×›×—×™ ×”×•× ××•×¢××“
            if (post.type === 'job') {
                const name = prompt("×”×›× ×¡ ×©× ××œ× ×œ×”×’×©×ª ××•×¢××“×•×ª:");
                if (!name) return;
                
                const phone = prompt("××” ××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×©×œ×š (×‘×•×•××˜×¡××¤)?");
                if (!phone || phone.length < 9) return Toast.warning("× × ×œ×”×–×™×Ÿ ×˜×œ×¤×•×Ÿ ×ª×§×™×Ÿ ×œ×™×¦×™×¨×ª ×§×©×¨");

                let score = 100;
                // ×”×¨×¦×ª ×©××œ×•×Ÿ ×¡×™× ×•×Ÿ ×× ×§×™×™×
                if (post.questions && post.questions.length > 0) {
                    let correct = 0;
                    alert("×”××¢×¡×™×§ ×”×’×“×™×¨ ×©××œ×•×ª ×¡×™× ×•×Ÿ ×§×¦×¨×•×ª. × × ×¢× ×” ×‘×›×Ÿ/×œ×.");
                    for (const q of post.questions) {
                        if (confirm(`${q}\n\n(××™×©×•×¨ = ×›×Ÿ | ×‘×™×˜×•×œ = ×œ×)`)) {
                            correct++;
                        }
                    }
                    score = Math.round((correct / post.questions.length) * 100);
                }

                // ×©××™×¨×ª ×”×œ×™×“ ×‘-Database ×›×“×™ ×©×”××¢×¡×™×§ ×™×¨××” ××•×ª×• ×‘×“×©×‘×•×¨×“
                try {
                    UI.toggleLoader(true);
                    await addDoc(collection(db, "leads"), {
                        bossID: post.owner,
                        jobTitle: post.title,
                        candidateName: name,
                        candidatePhone: phone.replace(/\D/g, ''),
                        matchScore: score,
                        createdAt: serverTimestamp()
                    });
                    
                    Toast.success("×”××•×¢××“×•×ª × ×©×œ×—×” ×œ××¢×¡×™×§!");
                    this.sendToWhatsApp(post, name, score);
                } catch (e) { 
                    console.error(e);
                    Toast.error("×ª×§×œ×” ×‘×©××™×¨×ª ×”×¤× ×™×™×”"); 
                }
                UI.toggleLoader(false);

            } else {
                // ×× ×”××•×“×¢×” ×”×™× ××¡×•×’ "××—×¤×© ×¢×‘×•×“×”" - ×”××©×ª××© ×”× ×•×›×—×™ ×”×•× ××¢×¡×™×§
                this.sendToWhatsApp(post, "××¢×¡×™×§ ×-MatchMe", 100);
            }
        },

        sendToWhatsApp(post, senderName, score) {
            const cleanPhone = post.phone.startsWith('0') ? '972' + post.phone.substring(1) : post.phone;
            const msg = `×”×™×™ ${post.name},\n×× ×™ ×¤×•× ×” ××œ×™×š ×œ×’×‘×™ ×”××•×“×¢×”: "${post.title}" ×‘-MatchMe.\n×©××™: ${senderName}\n×¦×™×•×Ÿ ×”×ª×××”: ${score}%\n× ×©××— ×œ×“×‘×¨!`;
            const url = `https://api.whatsapp.com/send?phone=${cleanPhone}&text=${encodeURIComponent(msg)}`;
            window.open(url, '_blank');
        }
    };

    /**
     * AUTHENTICATION MODULE
     * × ×™×”×•×œ ×”×¨×©××•×ª ×•×›× ×™×¡×”
     */
    const Auth = {
        async process(mode) {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            
            if (!email || pass.length < 6) {
                return Toast.warning("× × ×œ×”×–×™×Ÿ ××™××™×™×œ ×ª×§×™×Ÿ ×•×¡×™×¡××” ×‘×ª 6 ×ª×•×•×™× ×œ×¤×—×•×ª");
            }

            UI.toggleLoader(true);
            try {
                if (mode === 'login') {
                    await signInWithEmailAndPassword(auth, email, pass);
                    Toast.success("×‘×¨×•×š ×”×©×‘ ×œ××¢×¨×›×ª!");
                } else {
                    await createUserWithEmailAndPassword(auth, email, pass);
                    Toast.success("×—×©×‘×•×Ÿ ×× ×”×œ × ×•×¦×¨ ×‘×”×¦×œ×—×”!");
                }
                Router.go('admin');
            } catch (e) { 
                console.error(e);
                Toast.error("×©×’×™××”: " + (e.code === 'auth/user-not-found' ? "××©×ª××© ×œ× ×§×™×™×" : "×¤×¨×˜×™× ×©×’×•×™×™×")); 
            }
            UI.toggleLoader(false);
        },

        logout() {
            if (confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×ª× ×ª×§?")) {
                signOut(auth).then(() => location.reload());
            }
        }
    };

    /**
     * TOAST SYSTEM
     */
    const Toast = {
        show(msg, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const colors = {
                success: 'border-emerald-500 bg-emerald-500/10 text-emerald-400',
                error: 'border-red-500 bg-red-500/10 text-red-400',
                warning: 'border-amber-500 bg-amber-500/10 text-amber-400'
            };
            toast.className = `glass-morphism p-5 rounded-2xl border-r-4 shadow-2xl animate-fade-in ${colors[type] || 'border-blue-500 text-blue-400'}`;
            toast.innerHTML = `<p class="font-bold text-sm">${msg}</p>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 500);
            }, 3500);
        },
        success(m) { this.show(m, 'success'); },
        error(m) { this.show(m, 'error'); },
        warning(m) { this.show(m, 'warning'); }
    };

    // ×”××–× ×” ×œ××¦×‘ ×”××©×ª××© ×‘×–××Ÿ ×××ª
    onAuthStateChanged(auth, (user) => {
        GlobalState.user = user;
        if (GlobalState.currentView === 'admin') UI.refreshDashboard();
        // ×”×¡×¨×ª ×”×œ×•××“×¨ ×”×¨××©×•× ×™ ×¨×§ ××—×¨×™ ×‘×“×™×§×ª ×”-Auth
        setTimeout(() => UI.toggleLoader(false), 800);
    });

    // ×—×©×™×¤×ª ×¤×•× ×§×¦×™×•×ª ×’×œ×•×‘×œ×™×•×ª
    window.UI = UI;
    window.Auth = Auth;
    window.App = App;
    window.Toast = Toast;

    // ××ª×—×•×œ ×”××¤×œ×™×§×¦×™×”
    document.addEventListener('DOMContentLoaded', () => {
        Data.sync();
        UI.toggleSmartQuiz();
    });
</script>
</body>
</html>
