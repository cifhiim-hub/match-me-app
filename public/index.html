<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MatchMe Pro | ×”×¤×œ×˜×¤×•×¨××” ×”××•×©×œ××ª</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200;400;700;800&family=Inter:wght@900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #3b82f6;
            --bg: #0f172a;
            --card: #1e293b;
        }

        body {
            font-family: 'Assistant', sans-serif;
            background-color: var(--bg);
            color: #f8fafc;
            margin: 0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* ××¢×¨×›×ª ×“×¤×™× ×—×›××” */
        .page {
            display: none;
            min-height: 100vh;
            padding: 20px 20px 100px 20px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s ease;
        }

        .page.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* ×¢×™×¦×•×‘ ×›×¨×˜×™×¡×™×•×ª ××©×¨×•×ª */
        .job-card {
            background: var(--card);
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .job-card::after {
            content: ''; position: absolute; top: 0; right: 0; width: 4px; height: 100%;
            background: var(--primary);
        }

        /* ×›×¤×ª×•×¨×™× ×•×§×œ×˜ */
        .btn-premium {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            border-radius: 18px;
            font-weight: 800;
            color: white;
            padding: 18px;
            width: 100%;
            transition: 0.2s;
            box-shadow: 0 8px 20px -6px rgba(59, 130, 246, 0.5);
        }

        .btn-premium:active { transform: scale(0.96); opacity: 0.9; }

        .input-premium {
            background: #2d3748;
            border: 2px solid transparent;
            color: white;
            border-radius: 16px;
            padding: 16px;
            width: 100%;
            outline: none;
            transition: 0.3s;
        }

        .input-premium:focus { border-color: var(--primary); background: #334155; }

        /* × ×™×•×•×˜ ×ª×—×ª×•×Ÿ */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: 85px; background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.08);
            display: flex; justify-content: space-around; align-items: center;
            z-index: 1000; padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-link {
            display: flex; flex-direction: column; align-items: center;
            color: #64748b; font-size: 12px; font-weight: 700;
        }

        .nav-link.active { color: var(--primary); }
        .nav-link i { font-size: 24px; margin-bottom: 4px; }

        #mainLoader {
            position: fixed; inset: 0; background: var(--bg);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999;
        }
    </style>
</head>
<body>

    <div id="mainLoader">
        <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
        <p class="font-bold text-blue-500">MatchMe ××¢×‘×“ × ×ª×•× ×™×...</p>
    </div>

    <div id="page-feed" class="page active">
        <div class="flex justify-between items-center mb-8">
            <h1 style="font-family: 'Inter', sans-serif;" class="text-3xl font-black italic">MATCH<span class="text-blue-500">ME</span></h1>
        </div>
        
        <input type="text" id="jobSearch" onkeyup="UI.search()" placeholder="×—×¤×© ×ª×¤×§×™×“, ×¢×™×¨ ××• ×—×‘×¨×”..." class="input-premium mb-6">
        
        <div id="jobsGrid" class="space-y-4">
            </div>
    </div>

    <div id="page-details" class="page">
        <button onclick="Nav.go('feed')" class="text-blue-500 font-bold mb-6 flex items-center">â” ×—×–×¨×” ×œ×œ×•×—</button>
        <div id="detailsBox"></div>
        
        <div class="mt-8 p-6 bg-slate-900/50 rounded-3xl border border-slate-800">
            <h3 class="text-xl font-black mb-4">×”×’×©×ª ××•×¢××“×•×ª ××”×™×¨×”</h3>
            <input type="text" id="cand-name" placeholder="×©× ××œ×" class="input-premium mb-3">
            <input type="tel" id="cand-phone" placeholder="××¡×¤×¨ ×˜×œ×¤×•×Ÿ (×•×•××˜×¡××¤)" class="input-premium mb-4">
            <button onclick="App.startProcess()" class="btn-premium">×”××©×š ×œ×©××œ×•×Ÿ ×”×ª×××” ğŸš€</button>
        </div>
    </div>

    <div id="page-quiz" class="page text-center">
        <div class="max-w-md mx-auto py-10">
            <div class="w-full bg-slate-800 h-2 rounded-full mb-12 overflow-hidden">
                <div id="quizProgress" class="bg-blue-600 h-full w-0 transition-all duration-500"></div>
            </div>
            <h2 id="qText" class="text-3xl font-black mb-16 leading-tight"></h2>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="App.answer(true)" class="btn-premium py-12 text-2xl">×›×Ÿ</button>
                <button onclick="App.answer(false)" class="bg-slate-800 py-12 text-2xl rounded-2xl font-bold">×œ×</button>
            </div>
        </div>
    </div>

    <div id="page-admin" class="page">
        <div id="loginSection">
            <h2 class="text-2xl font-black mb-6">×›× ×™×¡×ª ××¢×¡×™×§×™×</h2>
            <div class="space-y-4">
                <input type="email" id="auth-email" placeholder="××™××™×™×œ" class="input-premium">
                <input type="password" id="auth-pass" placeholder="×¡×™×¡××”" class="input-premium">
                <button onclick="Auth.exec('login')" class="btn-premium">×”×ª×—×‘×¨×•×ª</button>
                <button onclick="Auth.exec('signup')" class="w-full text-slate-500 font-bold text-sm">×™×¦×™×¨×ª ×—×©×‘×•×Ÿ ×—×“×©</button>
            </div>
        </div>

        <div id="dashboardSection" class="hidden">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-black">×”×œ×™×“×™× ×©×œ×™</h2>
                <button onclick="Auth.logout()" class="text-red-500 font-bold text-sm">×”×ª× ×ª×§</button>
            </div>
            <div id="leadsGrid" class="space-y-4"></div>
        </div>
    </div>

    <div id="page-post" class="page">
        <h2 class="text-2xl font-black mb-6">×¤×¨×¡× ××©×¨×” ×—×“×©×”</h2>
        <div class="space-y-4">
            <input type="text" id="p-title" placeholder="×›×•×ª×¨×ª ×”××©×¨×”" class="input-premium">
            <input type="text" id="p-company" placeholder="×©× ×”×¢×¡×§" class="input-premium">
            <div class="grid grid-cols-2 gap-3">
                <input type="text" id="p-city" placeholder="×¢×™×¨" class="input-premium">
                <input type="text" id="p-salary" placeholder="×©×›×¨" class="input-premium">
            </div>
            <input type="tel" id="p-phone" placeholder="×˜×œ×¤×•×Ÿ ×œ×™×¦×™×¨×ª ×§×©×¨" class="input-premium">
            <textarea id="p-desc" placeholder="×ª×™××•×¨ ×”××©×¨×”..." class="input-premium h-32"></textarea>
            
            <div class="p-4 bg-slate-900 rounded-2xl border border-slate-800">
                <p class="text-xs font-bold text-blue-400 mb-3">×©××œ×•×ª ×¡×™× ×•×Ÿ (×›×Ÿ/×œ×):</p>
                <div id="dynamicQs" class="space-y-2">
                    <input type="text" class="q-val input-premium py-3 text-sm" placeholder="×œ××©×œ: ×”×× ×™×© ×œ×š ×¨×™×©×™×•×Ÿ × ×”×™×’×”?">
                </div>
                <button onclick="UI.addQ()" class="text-blue-500 text-xs mt-3 font-bold">+ ×”×•×¡×£ ×©××œ×”</button>
            </div>
            <button onclick="Data.saveJob()" class="btn-premium py-5">×¤×¨×¡× ×¢×›×©×™×• ğŸš€</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <div onclick="Nav.go('feed')" class="nav-link active" id="n-feed"><i>ğŸ </i><span>×œ×•×—</span></div>
        <div onclick="Nav.go('post')" class="nav-link" id="n-post"><i>â•</i><span>×¤×¨×¡×</span></div>
        <div onclick="Nav.go('admin')" class="nav-link" id="n-admin"><i>ğŸ‘¤</i><span>××™×©×™</span></div>
    </nav>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Firebase Config - × ×©××¨ ××•×ª×• ×“×‘×¨
    const firebaseConfig = { 
        apiKey: "AIzaSyD0hsz8SOI1O...", 
        authDomain: "matchme-32bcf.firebaseapp.com", 
        projectId: "matchme-32bcf", 
        storageBucket: "matchme-32bcf.appspot.com", 
        messagingSenderId: "1082863959305", 
        appId: "1:1082863959305:web:f888f4df815598696c601f" 
    };

    const firebaseApp = initializeApp(firebaseConfig);
    const auth = getAuth(firebaseApp);
    const db = getFirestore(firebaseApp);

    // × ×™×”×•×œ ×–×™×›×¨×•×Ÿ ×”××¤×œ×™×§×¦×™×” (State)
    const State = {
        user: null,
        jobs: [],
        activeJob: null,
        quiz: { idx: 0, score: 0 },
        guestID: localStorage.getItem('mm_guest_id') || 'g_' + Math.random().toString(36).substr(2, 9)
    };
    if(!localStorage.getItem('mm_guest_id')) localStorage.setItem('mm_guest_id', State.guestID);

    // × ×™×•×•×˜
    const Nav = {
        go(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${id}`).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const activeNav = document.getElementById(`n-${id}`);
            if(activeNav) activeNav.classList.add('active');
            
            if(id === 'feed') Data.load();
            if(id === 'admin') UI.renderDash();
            window.scrollTo(0,0);
        }
    };

    // × ×ª×•× ×™× (Firebase)
    const Data = {
        async saveJob() {
            UI.loading(true);
            const title = document.getElementById('p-title').value.trim();
            const company = document.getElementById('p-company').value.trim();
            const phone = document.getElementById('p-phone').value.replace(/\D/g, '');
            
            if(!title || !phone) {
                alert("×—×•×‘×” ×œ××œ× ×œ×¤×—×•×ª ×›×•×ª×¨×ª ×•×˜×œ×¤×•×Ÿ");
                UI.loading(false); return;
            }

            try {
                // ×”×‘×˜×—×” ×©×©×“×” owner ×ª××™×“ ×§×™×™× (×¤×•×ª×¨ ××ª ×¦×™×œ×•× 2)
                const ownerID = State.user ? State.user.uid : State.guestID;
                
                await addDoc(collection(db, "jobs"), {
                    title, company, phone,
                    city: document.getElementById('p-city').value || "×›×œ ×”××¨×¥",
                    salary: document.getElementById('p-salary').value || "×’××™×©",
                    desc: document.getElementById('p-desc').value || "××™×Ÿ ×ª×™××•×¨ ××¤×•×¨×˜",
                    questions: Array.from(document.querySelectorAll('.q-val')).map(i => i.value).filter(v => v),
                    owner: ownerID,
                    createdAt: serverTimestamp()
                });
                Nav.go('feed');
            } catch (err) {
                console.error(err);
                alert("×©×’×™××” ×‘×¤×¨×¡×•× ×”××©×¨×”. × ×¡×” ×©×•×‘.");
            } finally { UI.loading(false); }
        },

        async load() {
            const q = query(collection(db, "jobs"), orderBy("createdAt", "desc"));
            const snap = await getDocs(q);
            State.jobs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            UI.renderFeed(State.jobs);
        }
    };

    // ×××©×§ ××©×ª××© (UI)
    const UI = {
        loading(s) { document.getElementById('mainLoader').style.display = s ? 'flex' : 'none'; },
        
        search() {
            const val = document.getElementById('jobSearch').value.toLowerCase();
            const filtered = State.jobs.filter(j => 
                (j.title || "").toLowerCase().includes(val) || 
                (j.city || "").toLowerCase().includes(val) || 
                (j.company || "").toLowerCase().includes(val)
            );
            UI.renderFeed(filtered);
        },

        renderFeed(list) {
            const grid = document.getElementById('jobsGrid');
            if(list.length === 0) {
                grid.innerHTML = `<p class="text-center opacity-30 py-10">××™×Ÿ ××©×¨×•×ª ×œ×”×¦×’×”...</p>`;
                return;
            }
            // ×˜×™×¤×•×œ ×‘-undefined (×¦×™×œ×•× 10)
            grid.innerHTML = list.map(j => `
                <div onclick="UI.openJob('${j.id}')" class="job-card">
                    <div class="flex justify-between items-start mb-1">
                        <h3 class="text-xl font-bold">${j.title || '××©×¨×” ×œ×œ× ×›×•×ª×¨×ª'}</h3>
                        <span class="text-xs font-bold text-blue-400">${j.salary || '×’××™×©'}</span>
                    </div>
                    <p class="text-slate-400 text-sm">ğŸ¢ ${j.company || '××¢×¡×™×§'} | ğŸ“ ${j.city || '×™×©×¨××œ'}</p>
                </div>
            `).join('');
        },

        openJob(id) {
            State.activeJob = State.jobs.find(x => x.id === id);
            const j = State.activeJob;
            document.getElementById('detailsBox').innerHTML = `
                <h2 class="text-3xl font-black mb-2">${j.title}</h2>
                <p class="text-blue-500 font-bold mb-6">${j.company} â€¢ ${j.city}</p>
                <p class="text-slate-300 leading-relaxed whitespace-pre-wrap mb-8">${j.desc}</p>
            `;
            Nav.go('details');
        },

        addQ() {
            const inp = document.createElement('input');
            inp.className = "q-val input-premium py-3 text-sm mt-2";
            inp.placeholder = "×©××œ×” × ×•×¡×¤×ª...";
            document.getElementById('dynamicQs').appendChild(inp);
        },

        async renderDash() {
            if(!State.user) {
                document.getElementById('loginSection').classList.remove('hidden');
                document.getElementById('dashboardSection').classList.add('hidden');
                return;
            }
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            
            const grid = document.getElementById('leadsGrid');
            grid.innerHTML = '<p class="text-center animate-pulse">×˜×•×¢×Ÿ ××•×¢××“×™×...</p>';
            
            const q = query(collection(db, "leads"), where("boss", "==", State.user.uid), orderBy("createdAt", "desc"));
            const snap = await getDocs(q);
            
            grid.innerHTML = snap.docs.map(doc => {
                const d = doc.data();
                return `
                <div class="job-card border-r-4 border-green-500">
                    <div class="flex justify-between items-center">
                        <b class="text-lg">${d.name}</b>
                        <span class="text-green-500 font-black">${d.score}%</span>
                    </div>
                    <p class="text-xs text-slate-500 mb-3">${d.jobTitle}</p>
                    <a href="https://wa.me/972${d.phone.substring(1)}" class="inline-block bg-green-600 text-white px-4 py-2 rounded-xl text-xs font-bold">×¤×ª×— ×•×•××˜×¡××¤</a>
                </div>
                `;
            }).join('') || '<p class="text-center opacity-20 py-10">×¢×“×™×™×Ÿ ××™×Ÿ ×¤× ×™×•×ª...</p>';
        }
    };

    // ×œ×•×’×™×§×ª ××¤×œ×™×§×¦×™×” ×•×©××œ×•×Ÿ
    const App = {
        startProcess() {
            const n = document.getElementById('cand-name').value.trim();
            const p = document.getElementById('cand-phone').value.replace(/\D/g, '');
            
            if(n.length < 2 || p.length < 9) {
                alert("× × ×œ××œ× ×©× ××œ× ×•×˜×œ×¤×•×Ÿ ×ª×§×™×Ÿ");
                return;
            }
            
            State.cand = { n, p };
            State.quiz = { idx: 0, score: 0 };
            
            if(State.activeJob.questions && State.activeJob.questions.length > 0) {
                Nav.go('quiz');
                App.showQ();
            } else {
                App.finish(100);
            }
        },

        showQ() {
            const q = State.activeJob.questions[State.quiz.idx];
            document.getElementById('qText').innerText = q;
            document.getElementById('quizProgress').style.width = ((State.quiz.idx / State.activeJob.questions.length) * 100) + '%';
        },

        answer(val) {
            if(val) State.quiz.score += (100 / State.activeJob.questions.length);
            State.quiz.idx++;
            
            if(State.quiz.idx < State.activeJob.questions.length) {
                App.showQ();
            } else {
                App.finish(Math.round(State.quiz.score));
            }
        },

        async finish(score) {
            UI.loading(true);
            try {
                // ×”×‘×˜×—×” ×©×©×“×” boss ×œ×¢×•×œ× ×œ× ×™×”×™×” undefined (×¤×•×ª×¨ ××ª ×¦×™×œ×•× 2)
                const bossID = State.activeJob.owner || "manual_post";
                
                await addDoc(collection(db, "leads"), {
                    boss: bossID,
                    jobTitle: State.activeJob.title,
                    name: State.cand.n,
                    phone: State.cand.p,
                    score: score,
                    createdAt: serverTimestamp()
                });

                // ×•×•××˜×¡××¤ ×‘×§×™×©×•×¨ ×”×™×¦×™×‘ ×‘×™×•×ª×¨ (×¤×•×ª×¨ ××ª ×¦×™×œ×•× 10)
                const msg = encodeURIComponent(`×”×™×™, ×× ×™ ${State.cand.n}, ×”×’×©×ª×™ ××•×¢××“×•×ª ×œ××©×¨×”: ${State.activeJob.title}. ×§×™×‘×œ×ª×™ ${score}% ×”×ª×××” ×‘×©××œ×•×Ÿ!`);
                window.location.href = `https://wa.me/972${State.activeJob.phone.substring(1)}?text=${msg}`;
                
            } catch (err) {
                console.error(err);
                alert("×©×’×™××” ×‘×¡×™×•× ×”×ª×”×œ×™×š. × ×¡×” ×©×•×‘.");
            } finally { UI.loading(false); }
        }
    };

    // ××™××•×ª ××©×ª××©×™×
    const Auth = {
        async exec(mode) {
            UI.loading(true);
            const e = document.getElementById('auth-email').value, p = document.getElementById('auth-pass').value;
            try {
                if(mode === 'login') await signInWithEmailAndPassword(auth, e, p);
                else await createUserWithEmailAndPassword(auth, e, p);
            } catch(e) { 
                alert("×©×’×™××”: ×•×•×“× ×©×”×¤×¨×˜×™× × ×›×•× ×™× (×¡×™×¡××” ×œ×¤×—×•×ª 6 ×ª×•×•×™×)"); 
            } finally { UI.loading(false); }
        },
        async logout() { await signOut(auth); location.reload(); }
    };

    onAuthStateChanged(auth, u => {
        State.user = u;
        Data.load();
        if(u) UI.renderDash();
    });

    window.Nav = Nav; window.UI = UI; window.Data = Data; window.App = App; window.Auth = Auth;

</script>
</body>
</html>
