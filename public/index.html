<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MatchMe Ultimate Pro 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200;300;400;500;600;700;800&family=Inter:wght@900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #1d4ed8;
            --bg-dark: #0f172a;
            --card-bg: #1e293b;
            --accent: #10b981;
            --error: #ef4444;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
            font-family: 'Assistant', sans-serif;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* ××¢×¨×›×ª ×“×¤×™× ×•×× ×™××¦×™×•×ª */
        .page {
            display: none;
            min-height: 100vh;
            padding: 20px 20px 100px 20px;
            opacity: 0;
            transform: translateY(15px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* ×¢×™×¦×•×‘×™ ×›×¤×ª×•×¨×™× ×•××œ×× ×˜×™× */
        .glass-nav {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
        }

        .btn-grad {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 18px;
            font-weight: 800;
            color: white;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
        }

        .btn-grad:active { transform: scale(0.95); opacity: 0.9; }
        .btn-grad:disabled { opacity: 0.5; cursor: not-allowed; }

        .input-premium {
            background: #2d3748;
            border: 2px solid transparent;
            color: white;
            border-radius: 16px;
            padding: 16px;
            width: 100%;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .input-premium:focus {
            border-color: var(--primary);
            background: #334155;
            outline: none;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
        }

        .card-job {
            background: var(--card-bg);
            border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.05);
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card-job::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 4px; height: 100%;
            background: var(--primary);
            opacity: 0.5;
        }

        .card-job:active { background: #334155; transform: scale(0.98); }

        /* ×‘×¨ ×˜×¢×™× ×” ××•×ª×× ××™×©×™×ª */
        .loader-overlay {
            position: fixed; inset: 0; background: rgba(15, 23, 42, 0.95);
            z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center;
        }

        .custom-spinner {
            width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid var(--primary); border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* × ×™×•×•×˜ ×ª×—×ª×•×Ÿ */
        .nav-item {
            display: flex; flex-direction: column; align-items: center; 
            color: var(--text-muted); font-weight: 700; font-size: 12px;
            transition: 0.3s; padding: 10px;
        }
        .nav-item.active { color: var(--primary); transform: translateY(-3px); }

        /* ××¢×¨×›×ª ×©××œ×•×Ÿ (Quiz) */
        .quiz-option {
            padding: 30px; border-radius: 20px; font-size: 24px; font-weight: 800;
            transition: 0.2s;
        }
    </style>
</head>
<body>

    <div id="loader" class="loader-overlay">
        <div class="custom-spinner mb-4"></div>
        <p class="text-primary font-bold animate-pulse">×”××¢×¨×›×ª ××¢×‘×“×ª ××ª ×”×‘×§×©×” ×©×œ×š...</p>
    </div>

    <div id="page-feed" class="page active">
        <div class="flex justify-between items-center mb-10 pt-4">
            <div>
                <h1 style="font-family: 'Inter', sans-serif;" class="text-4xl font-black italic tracking-tighter">
                    MATCH<span class="text-blue-500">ME</span>
                </h1>
                <p class="text-text-muted text-sm font-medium">××¦× ××ª ×”×”×–×“×× ×•×ª ×”×‘××” ×©×œ×š</p>
            </div>
            <div id="user-avatar" onclick="Nav.to('profile')" class="w-12 h-12 rounded-2xl bg-slate-800 border-2 border-slate-700 flex items-center justify-center text-xl cursor-pointer">
                ğŸ‘¤
            </div>
        </div>

        <div class="relative mb-8">
            <input type="text" id="globalSearch" onkeyup="UI.filterJobs()" placeholder="×—×¤×© ×ª×¤×§×™×“, ×—×‘×¨×” ××• ×¢×™×¨..." class="input-premium pr-12">
            <span class="absolute right-4 top-1/2 -translate-y-1/2 opacity-30">ğŸ”</span>
        </div>

        <div id="jobsList" class="space-y-5">
            </div>
    </div>

    <div id="page-view" class="page">
        <div class="flex items-center gap-4 mb-8">
            <button onclick="Nav.to('feed')" class="p-2 bg-slate-800 rounded-xl">â”</button>
            <h2 class="text-xl font-bold">×¤×¨×˜×™ ×”××©×¨×”</h2>
        </div>
        
        <div id="fullJobContent"></div>

        <div class="mt-10 pt-10 border-t border-slate-800">
            <h3 class="text-lg font-black mb-6">×”×’×©×ª ××•×¢××“×•×ª ××”×™×¨×”</h3>
            <div class="space-y-4">
                <div class="group">
                    <label class="text-xs font-bold text-slate-500 mb-2 block">×©× ××œ×</label>
                    <input type="text" id="app-name" placeholder="××™×š ×§×•×¨××™× ×œ×š?" class="input-premium">
                </div>
                <div class="group">
                    <label class="text-xs font-bold text-slate-500 mb-2 block">××¡×¤×¨ ×•×•××˜×¡××¤</label>
                    <input type="tel" id="app-phone" placeholder="050-0000000" class="input-premium">
                </div>
                <button onclick="App.initApplication()" class="btn-grad w-full py-6 text-xl mt-4">×‘×“×™×§×ª ×”×ª×××” ×•×”×’×©×” ğŸš€</button>
            </div>
        </div>
    </div>

    <div id="page-quiz" class="page text-center">
        <div class="max-w-md mx-auto h-[80vh] flex flex-col justify-between py-10">
            <div>
                <div class="w-full bg-slate-800 h-2.5 rounded-full mb-12">
                    <div id="quizBar" class="bg-blue-600 h-full w-0 transition-all duration-700 rounded-full shadow-[0_0_15px_rgba(59,130,246,0.5)]"></div>
                </div>
                <p id="quizStepInfo" class="text-blue-500 font-bold text-sm mb-4 uppercase tracking-widest"></p>
                <h3 id="quizQuestion" class="text-4xl font-black leading-tight"></h3>
            </div>

            <div class="grid grid-cols-1 gap-6">
                <button onclick="App.processAnswer(true)" class="quiz-option bg-blue-600 text-white shadow-xl">×‘×˜×— / ×›×Ÿ</button>
                <button onclick="App.processAnswer(false)" class="quiz-option bg-slate-800 text-slate-300">×¤×—×•×ª / ×œ×</button>
            </div>
        </div>
    </div>

    <div id="page-profile" class="page">
        <div id="locked-state" class="text-center py-20">
            <div class="w-24 h-24 bg-blue-600/10 rounded-full flex items-center justify-center mx-auto mb-8">
                <span class="text-5xl">ğŸ”</span>
            </div>
            <h2 class="text-3xl font-black mb-4">×’×™×©×” ×œ××¢×¡×™×§×™×</h2>
            <p class="text-text-muted mb-10 px-10">×›×“×™ ×œ× ×”×œ ××ª ×”××©×¨×•×ª ×©×œ×š ×•×œ×¨××•×ª ××™ ×”×’×™×© ××•×¢××“×•×ª, ×¢×œ×™×š ×œ×”×™×›× ×¡ ×œ×—×©×‘×•×Ÿ.</p>
            
            <div class="max-w-xs mx-auto space-y-4">
                <input type="email" id="auth-email" placeholder="××™××™×™×œ" class="input-premium">
                <input type="password" id="auth-pass" placeholder="×¡×™×¡××”" class="input-premium">
                <button onclick="Auth.handle('login')" class="btn-grad w-full py-4">×›× ×™×¡×” ×œ××¢×¨×›×ª</button>
                <button onclick="Auth.handle('signup')" class="w-full py-4 text-slate-500 font-bold border border-slate-800 rounded-2xl">×™×¦×™×¨×ª ×—×©×‘×•×Ÿ ××¢×¡×™×§</button>
            </div>
        </div>

        <div id="admin-state" class="hidden">
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-3xl font-black">× ×™×”×•×œ ××•×¢××“×™×</h2>
                <button onclick="Auth.logout()" class="text-error font-bold text-sm">×”×ª× ×ª×§</button>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-10">
                <div class="bg-slate-800/50 p-6 rounded-3xl border border-slate-700">
                    <div class="text-2xl font-black" id="stat-jobs">0</div>
                    <div class="text-xs text-slate-500">××©×¨×•×ª ×¤×¢×™×œ×•×ª</div>
                </div>
                <div class="bg-slate-800/50 p-6 rounded-3xl border border-slate-700">
                    <div class="text-2xl font-black text-blue-500" id="stat-leads">0</div>
                    <div class="text-xs text-slate-500">×¤× ×™×•×ª ×©×§×™×‘×œ×ª</div>
                </div>
            </div>

            <div id="adminList" class="space-y-4">
                </div>
        </div>
    </div>

    <div id="page-post" class="page">
        <h2 class="text-3xl font-black mb-8 italic">×¤×¨×¡× ××©×¨×” <span class="text-blue-500">×¢×›×©×™×•</span></h2>
        
        <div class="space-y-6">
            <section class="space-y-4">
                <h4 class="text-xs font-black text-blue-500 uppercase">×¤×¨×˜×™ ×”×¢×¡×§</h4>
                <input type="text" id="p-company" placeholder="×©× ×”×—×‘×¨×” / ×”×¢×¡×§" class="input-premium">
                <input type="tel" id="p-wa" placeholder="×•×•××˜×¡××¤ ×œ×§×‘×œ×ª ×¤× ×™×•×ª (05...)" class="input-premium">
            </section>

            <section class="space-y-4 pt-4">
                <h4 class="text-xs font-black text-blue-500 uppercase">×¤×¨×˜×™ ×”×ª×¤×§×™×“</h4>
                <input type="text" id="p-title" placeholder="×›×•×ª×¨×ª ×”××©×¨×” (×œ××©×œ: ××œ×¦×¨/×™×ª)" class="input-premium">
                <div class="grid grid-cols-2 gap-3">
                    <input type="text" id="p-city" placeholder="×¢×™×¨" class="input-premium">
                    <input type="text" id="p-salary" placeholder="×©×›×¨ (×œ××©×œ: 50â‚ª ×œ×©×¢×”)" class="input-premium">
                </div>
                <textarea id="p-desc" placeholder="×¡×¤×¨ ×§×¦×ª ×¢×œ ×”×ª×¤×§×™×“, ×“×¨×™×©×•×ª ×•×ª× ××™×..." class="input-premium h-32"></textarea>
            </section>

            <section class="p-6 bg-slate-900 rounded-3xl border border-slate-800">
                <h4 class="text-xs font-black text-blue-400 mb-4 uppercase">×©××œ×•×ª ×¡×™× ×•×Ÿ (×›×Ÿ/×œ×)</h4>
                <div id="dynamicQuestions" class="space-y-3">
                    <input type="text" class="q-field input-premium py-3" placeholder="×œ××©×œ: ×™×© ×œ×š × ×™×¡×™×•×Ÿ ×§×•×“×?">
                </div>
                <button onclick="UI.addQuestionField()" class="mt-4 text-blue-500 font-bold text-xs">+ ×”×•×¡×£ ×©××œ×ª ×¡×™× ×•×Ÿ</button>
            </section>

            <button onclick="Data.publishJob()" class="btn-grad w-full py-6 text-xl mt-6">×¤×¨×¡× ××©×¨×” ×‘×œ×•×— ğŸš€</button>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 glass-nav h-20 flex justify-around items-center px-4 z-[999]">
        <div onclick="Nav.to('feed')" class="nav-item active" id="btn-feed">
            <span class="text-2xl mb-1">ğŸ </span>
            <span>×¨××©×™</span>
        </div>
        <div onclick="Nav.to('post')" class="nav-item" id="btn-post">
            <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center text-white text-2xl shadow-lg -mt-10 border-4 border-[#0f172a]">
                +
            </div>
            <span class="mt-1">×¤×¨×¡×</span>
        </div>
        <div onclick="Nav.to('profile')" class="nav-item" id="btn-profile">
            <span class="text-2xl mb-1">ğŸ’¼</span>
            <span>× ×™×”×•×œ</span>
        </div>
    </nav>

<script type="module">
    // ×™×™×‘×•× Firebase ××ª×•×š CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ×”×’×“×¨×•×ª ×”×¤×¨×•×™×§×˜ (Firebase Config)
    const firebaseConfig = { 
        apiKey: "AIzaSyD0hsz8SOI1O...", 
        authDomain: "matchme-32bcf.firebaseapp.com", 
        projectId: "matchme-32bcf", 
        storageBucket: "matchme-32bcf.appspot.com", 
        messagingSenderId: "1082863959305", 
        appId: "1:1082863959305:web:f888f4df815598696c601f" 
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // × ×™×”×•×œ ×–×™×›×¨×•×Ÿ ×•××¦×‘ ×”××¤×œ×™×§×¦×™×” (Global State)
    const State = {
        user: null,
        allJobs: [],
        selectedJob: null,
        quiz: { currentIdx: 0, score: 0 },
        // ×–×™×”×•×™ ××›×©×™×¨ ×™×™×—×•×“×™ ×œ××§×¨×” ×©×”××©×ª××© ××™× ×• ×¨×©×•×
        guestUID: localStorage.getItem('mm_device_id') || 'guest_' + Math.random().toString(36).substr(2, 9)
    };
    if(!localStorage.getItem('mm_device_id')) localStorage.setItem('mm_device_id', State.guestUID);

    // --- ××¢×¨×›×ª × ×™×•×•×˜ (Navigation Engine) ---
    const Nav = {
        to(pageId) {
            // ×× ×™××¦×™×™×ª ×™×¦×™××”
            const current = document.querySelector('.page.active');
            if(current) {
                current.style.opacity = '0';
                current.style.transform = 'translateY(15px)';
            }
            
            setTimeout(() => {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                const next = document.getElementById(`page-${pageId}`);
                next.classList.add('active');
                
                // ×¢×“×›×•×Ÿ ×ª×¤×¨×™×˜ ×ª×—×ª×•×Ÿ
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                const btn = document.getElementById(`btn-${pageId}`);
                if(btn) btn.classList.add('active');

                // ×˜×¢×™× ×ª × ×ª×•× ×™× ×œ×¤×™ ×”×“×£
                if(pageId === 'feed') Data.fetchJobs();
                if(pageId === 'profile') UI.renderDashboard();
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 100);
        }
    };

    // --- ××¢×¨×›×ª ××™××•×ª (Authentication Engine) ---
    const Auth = {
        async handle(mode) {
            UI.toggleLoader(true);
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;

            if(!email || pass.length < 6) {
                alert("×•×•×“× ×©×”×–× ×ª ××™××™×™×œ ×ª×§×™×Ÿ ×•×¡×™×¡××” ×¢× 6 ×ª×•×•×™× ×œ×¤×—×•×ª");
                UI.toggleLoader(false);
                return;
            }

            try {
                if(mode === 'login') await signInWithEmailAndPassword(auth, email, pass);
                else await createUserWithEmailAndPassword(auth, email, pass);
            } catch (err) {
                console.error(err);
                alert("×©×’×™××” ×‘×ª×”×œ×™×š ×”××™××•×ª. × ×¡×” ×©×•×‘.");
            } finally {
                UI.toggleLoader(false);
            }
        },
        async logout() {
            await signOut(auth);
            location.reload();
        }
    };

    // --- × ×™×”×•×œ × ×ª×•× ×™× (Data & Firebase Engine) ---
    const Data = {
        async publishJob() {
            const title = document.getElementById('p-title').value;
            const company = document.getElementById('p-company').value;
            const phone = document.getElementById('p-wa').value.replace(/\D/g, '');
            
            if(!title || !company || phone.length < 9) {
                alert("××œ× ××ª ×›×œ ×©×“×•×ª ×”×—×•×‘×” ×•×•×“× ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×ª×§×™×Ÿ");
                return;
            }

            UI.toggleLoader(true);
            const questions = Array.from(document.querySelectorAll('.q-field'))
                                   .map(i => i.value.trim())
                                   .filter(v => v !== "");

            try {
                await addDoc(collection(db, "jobs"), {
                    title, company, phone,
                    city: document.getElementById('p-city').value || "×™×©×¨××œ",
                    salary: document.getElementById('p-salary').value || "×’××™×©",
                    desc: document.getElementById('p-desc').value || "",
                    questions,
                    ownerID: State.user ? State.user.uid : State.guestUID,
                    createdAt: serverTimestamp()
                });
                Nav.to('feed');
            } catch (e) {
                alert("×ª×§×œ×” ×‘×¤×¨×¡×•× ×”××©×¨×”.");
            } finally {
                UI.toggleLoader(false);
            }
        },

        async fetchJobs() {
            const q = query(collection(db, "jobs"), orderBy("createdAt", "desc"));
            const snapshot = await getDocs(q);
            State.allJobs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            UI.renderJobs(State.allJobs);
        }
    };

    // --- ××¢×¨×›×ª ×”-UI ×•×”×¨×™× ×“×•×¨ (UI Engine) ---
    const UI = {
        toggleLoader(show) {
            document.getElementById('loader').style.display = show ? 'flex' : 'none';
        },

        filterJobs() {
            const term = document.getElementById('globalSearch').value.toLowerCase();
            const filtered = State.allJobs.filter(j => 
                j.title.toLowerCase().includes(term) || 
                j.city.toLowerCase().includes(term) ||
                j.company.toLowerCase().includes(term)
            );
            UI.renderJobs(filtered);
        },

        renderJobs(list) {
            const container = document.getElementById('jobsList');
            if(list.length === 0) {
                container.innerHTML = `<div class="text-center py-20 opacity-20 font-bold">×œ× × ××¦××• ××©×¨×•×ª ××ª××™××•×ª</div>`;
                return;
            }
            container.innerHTML = list.map(job => `
                <div onclick="UI.showJobDetails('${job.id}')" class="card-job">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-xl font-extrabold">${job.title}</h3>
                        <span class="text-xs font-black text-blue-500 bg-blue-500/10 px-3 py-1 rounded-full">${job.salary}</span>
                    </div>
                    <p class="text-slate-400 font-bold text-sm">ğŸ¢ ${job.company} â€¢ ğŸ“ ${job.city}</p>
                </div>
            `).join('');
        },

        showJobDetails(id) {
            State.selectedJob = State.allJobs.find(j => j.id === id);
            const j = State.selectedJob;
            document.getElementById('fullJobContent').innerHTML = `
                <div class="card-job bg-slate-900/50 border-none p-8">
                    <h1 class="text-4xl font-black mb-4">${j.title}</h1>
                    <div class="flex gap-4 mb-8">
                        <span class="bg-slate-800 px-4 py-2 rounded-xl text-xs font-bold">ğŸ“ ${j.city}</span>
                        <span class="bg-slate-800 px-4 py-2 rounded-xl text-xs font-bold">ğŸ’° ${j.salary}</span>
                    </div>
                    <p class="text-slate-300 text-lg leading-relaxed whitespace-pre-wrap">${j.desc || '××™×Ÿ ×ª×™××•×¨ × ×•×¡×£ ×œ××©×¨×” ×–×•.'}</p>
                </div>
            `;
            Nav.to('view');
        },

        addQuestionField() {
            const container = document.getElementById('dynamicQuestions');
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'q-field input-premium py-3 mt-2';
            input.placeholder = '×©××œ×ª ×¡×™× ×•×Ÿ × ×•×¡×¤×ª...';
            container.appendChild(input);
        },

        async renderDashboard() {
            if(!State.user) {
                document.getElementById('locked-state').classList.remove('hidden');
                document.getElementById('admin-state').classList.add('hidden');
                return;
            }
            document.getElementById('locked-state').classList.add('hidden');
            document.getElementById('admin-state').classList.remove('hidden');

            const leadsWrap = document.getElementById('adminList');
            leadsWrap.innerHTML = '<div class="custom-spinner mx-auto my-10"></div>';

            // ××©×™×›×ª ×¤× ×™×•×ª (Leads) ×©×©×™×™×›×•×ª ×œ××©×ª××© ×”××—×•×‘×¨
            const q = query(collection(db, "leads"), where("bossID", "==", State.user.uid), orderBy("createdAt", "desc"));
            const snap = await getDocs(q);
            
            // ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×”
            document.getElementById('stat-leads').innerText = snap.size;
            
            leadsWrap.innerHTML = snap.docs.map(doc => {
                const d = doc.data();
                return `
                <div class="card-job border-r-4 border-accent">
                    <div class="flex justify-between items-center">
                        <h4 class="font-black text-lg">${d.candidateName}</h4>
                        <span class="text-accent font-black">${d.matchScore}% ×”×ª×××”</span>
                    </div>
                    <div class="flex justify-between items-end mt-4">
                        <div class="text-xs text-slate-500">${d.jobTitle}</div>
                        <a href="https://wa.me/972${d.candidatePhone.substring(1)}" class="bg-green-600 text-white px-4 py-2 rounded-xl text-xs font-bold">×“×‘×¨ ××™×ª×•</a>
                    </div>
                </div>
                `;
            }).join('') || '<p class="text-center opacity-20 py-10">××™×Ÿ ×¤× ×™×•×ª ×›×¨×’×¢</p>';
        }
    };

    // --- ×× ×•×¢ ×”×’×©×ª ××•×¢××“×•×ª (Application Logic) ---
    const App = {
        initApplication() {
            const name = document.getElementById('app-name').value.trim();
            const phone = document.getElementById('app-phone').value.replace(/\D/g, '');

            if(name.length < 2 || phone.length < 9) {
                alert("×× × ×”×–×Ÿ ×©× ××œ× ×•××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×ª×§×™×Ÿ");
                return;
            }

            State.currentApplication = { name, phone };
            
            if(State.selectedJob.questions && State.selectedJob.questions.length > 0) {
                State.quiz.currentIdx = 0;
                State.quiz.score = 0;
                Nav.to('quiz');
                App.renderQuiz();
            } else {
                App.finalizeApplication(100);
            }
        },

        renderQuiz() {
            const q = State.selectedJob.questions[State.quiz.currentIdx];
            const total = State.selectedJob.questions.length;
            
            document.getElementById('quizStepInfo').innerText = `×©××œ×” ${State.quiz.currentIdx + 1} ××ª×•×š ${total}`;
            document.getElementById('quizQuestion').innerText = q;
            document.getElementById('quizBar').style.width = ((State.quiz.currentIdx / total) * 100) + '%';
        },

        processAnswer(isYes) {
            if(isYes) State.quiz.score += (100 / State.selectedJob.questions.length);
            
            State.quiz.currentIdx++;
            if(State.quiz.currentIdx < State.selectedJob.questions.length) {
                App.renderQuiz();
            } else {
                App.finalizeApplication(Math.round(State.quiz.score));
            }
        },

        async finalizeApplication(score) {
            UI.toggleLoader(true);
            try {
                // ×©××™×¨×ª ×”×¤× ×™×™×” ×‘-Database
                await addDoc(collection(db, "leads"), {
                    bossID: State.selectedJob.ownerID,
                    candidateName: State.currentApplication.name,
                    candidatePhone: State.currentApplication.phone,
                    jobTitle: State.selectedJob.title,
                    matchScore: score,
                    createdAt: serverTimestamp()
                });

                // ×¤×ª×™×—×ª ×•×•××˜×¡××¤ ×¢× ×”×•×“×¢×” ××•×›× ×”
                const waMsg = encodeURIComponent(`×”×™×™, ×× ×™ ${State.currentApplication.name}. ×¨××™×ª×™ ××ª ×”××©×¨×” ×©×œ×š (${State.selectedJob.title}) ×‘-MatchMe. ×¦×™×•×Ÿ ×”×”×ª×××” ×©×œ×™ ×”×•× ${score}%. ××©××— ×œ×“×‘×¨!`);
                window.location.href = `https://wa.me/972${State.selectedJob.phone.substring(1)}?text=${waMsg}`;
                
            } catch (e) {
                alert("×©×’×™××” ×‘×©×œ×™×—×ª ×”××•×¢××“×•×ª.");
            } finally {
                UI.toggleLoader(false);
            }
        }
    };

    // ×”××–× ×” ×œ×©×™× ×•×™×™ ××©×ª××© (Auth State Observer)
    onAuthStateChanged(auth, (user) => {
        State.user = user;
        document.getElementById('user-avatar').innerHTML = user ? 'âœ…' : 'ğŸ‘¤';
        Data.fetchJobs();
    });

    // ×—×©×™×¤×ª ×¤×•× ×§×¦×™×•×ª ×œ-Window ×›×“×™ ×©×™×•×›×œ×• ×œ×”×™×§×¨× ××”-HTML
    window.Nav = Nav; window.UI = UI; window.Auth = Auth; window.Data = Data; window.App = App;

</script>
</body>
</html>
