window.apply = (id) => {
    const p = allPosts.find(x => x.id === id);
    let bonus = "";
    
    // אם יש שאלות סינון, נשאל אותן קודם
    if(p.questions && p.questions.length > 0) {
        let score = 0;
        alert("המעסיק מבקש לוודא התאמה:");
        p.questions.forEach(q => { if(confirm(q)) score++; });
        bonus = ` | התאמה לשאלות המעסיק: ${Math.round((score/p.questions.length)*100)}%`;
    }

    // כאן שיניתי את השאלה שתהיה יותר הגיונית
    const senderInfo = prompt("הכנס שם וניסיון בקצרה כדי שהמעסיק יחזור אליך:"); 
    if(!senderInfo) return;

    let num = p.phone.replace(/\D/g,'');
    if(num.startsWith('0')) num = '972' + num.substring(1);
    
    // בניית ההודעה בצורה מקצועית
    const msg = encodeURIComponent(`שלום, אני פונה לגבי המשרה: "${p.title}".\nפרטים עלי: ${senderInfo}${bonus}`);
    window.open(`https://api.whatsapp.com/send?phone=${num}&text=${msg}`, '_blank');
};
