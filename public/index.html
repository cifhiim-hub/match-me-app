<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MatchMe Pro | ×”×¤×œ×˜×¤×•×¨××” ×”××•×©×œ××ª</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200;400;700;800&family=Inter:wght@900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #1e40af;
            --bg: #0f172a;
            --card: #1e293b;
            --accent: #10b981;
            --error: #f43f5e;
        }

        body {
            font-family: 'Assistant', sans-serif;
            background-color: var(--bg);
            color: #f8fafc;
            margin: 0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* ××¢×¨×›×ª ×× ×™××¦×™×•×ª ×œ××¢×‘×¨×™ ×“×¤×™× ×—×œ×§×™× */
        .page {
            display: none;
            min-height: 100vh;
            padding: 24px 24px 120px 24px;
            opacity: 0;
            transform: scale(0.98);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page.active {
            display: block;
            opacity: 1;
            transform: scale(1);
        }

        /* ××œ×× ×˜×™× ×¢×™×¦×•×‘×™×™× ××©×•×“×¨×’×™× */
        .glass-header {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            position: sticky; top: 0; z-index: 100;
        }

        .job-card {
            background: var(--card);
            border-radius: 24px;
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
            transition: 0.3s ease;
            position: relative; overflow: hidden;
        }

        .job-card::before {
            content: ''; position: absolute; top: 0; right: 0; width: 6px; height: 100%;
            background: var(--primary); opacity: 0.7;
        }

        .job-card:active { transform: translateY(2px) scale(0.98); background: #26334d; }

        .btn-premium {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 20px;
            font-weight: 800;
            color: white;
            box-shadow: 0 12px 20px -8px rgba(59, 130, 246, 0.5);
            transition: 0.2s;
            border: none;
            width: 100%;
            padding: 18px;
            font-size: 18px;
        }

        .btn-premium:active { transform: scale(0.96); opacity: 0.9; }

        .input-premium {
            background: #2d3748;
            border: 2px solid transparent;
            color: white;
            border-radius: 18px;
            padding: 18px;
            width: 100%;
            outline: none;
            transition: 0.3s;
            font-size: 16px;
        }

        .input-premium:focus { border-color: var(--primary); background: #334155; }

        /* × ×™×•×•×˜ ×ª×—×ª×•×Ÿ ×™×•×§×¨×ª×™ */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: 85px; background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.08);
            display: flex; justify-content: space-around; align-items: center;
            z-index: 1000; padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-link {
            display: flex; flex-direction: column; align-items: center;
            color: #64748b; font-size: 12px; font-weight: 700; transition: 0.3s;
        }

        .nav-link.active { color: var(--primary); }
        .nav-link i { font-size: 24px; margin-bottom: 4px; }

        /* ×œ×•××“×¨ (Loader) ××¢×•×¦×‘ */
        #mainLoader {
            position: fixed; inset: 0; background: var(--bg);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999;
        }

        .spinner {
            width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary); border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div id="mainLoader">
        <div class="spinner mb-4"></div>
        <p class="text-blue-500 font-bold animate-pulse">MatchMe ××¢×‘×“ × ×ª×•× ×™×...</p>
    </div>

    <div id="page-feed" class="page active">
        <div class="glass-header mb-8 py-4">
            <h1 style="font-family: 'Inter', sans-serif;" class="text-4xl font-black italic tracking-tighter">
                MATCH<span class="text-blue-500">ME</span>
            </h1>
        </div>

        <div class="relative mb-8">
            <input type="text" id="jobSearch" onkeyup="UI.search()" placeholder="×—×¤×© ×ª×¤×§×™×“, ×¢×™×¨ ××• ×—×‘×¨×”..." class="input-premium pr-12">
            <span class="absolute right-5 top-1/2 -translate-y-1/2 opacity-30">ğŸ”</span>
        </div>

        <div id="jobsGrid" class="space-y-6">
            </div>
    </div>

    <div id="page-details" class="page">
        <button onclick="Nav.go('feed')" class="text-blue-500 font-bold mb-6 flex items-center">â” ×—×–×¨×” ×œ×œ×•×—</button>
        <div id="detailsBox"></div>
        
        <div class="mt-12 p-6 bg-slate-900/50 rounded-[32px] border border-slate-800">
            <h3 class="text-xl font-black mb-6">×”×’×©×ª ××•×¢××“×•×ª ××”×™×¨×”</h3>
            <div class="space-y-4">
                <input type="text" id="cand-name" placeholder="×©× ××œ×" class="input-premium">
                <input type="tel" id="cand-phone" placeholder="××¡×¤×¨ ×˜×œ×¤×•×Ÿ (×•×•××˜×¡××¤)" class="input-premium">
                <button onclick="App.startProcess()" class="btn-premium mt-4 text-xl py-6">×”××©×š ×œ×©××œ×•×Ÿ ×”×ª×××” ğŸš€</button>
            </div>
        </div>
    </div>

    <div id="page-quiz" class="page text-center">
        <div class="max-w-md mx-auto h-[70vh] flex flex-col justify-center">
            <div class="w-full bg-slate-800 h-2 rounded-full mb-12 overflow-hidden">
                <div id="quizProgress" class="bg-blue-600 h-full w-0 transition-all duration-500"></div>
            </div>
            <h2 id="qText" class="text-4xl font-black mb-20 leading-tight"></h2>
            <div class="grid grid-cols-2 gap-6">
                <button onclick="App.answer(true)" class="btn-premium py-12 text-3xl">×›×Ÿ</button>
                <button onclick="App.answer(false)" class="bg-slate-800 py-12 text-3xl rounded-[28px] font-bold">×œ×</button>
            </div>
        </div>
    </div>

    <div id="page-admin" class="page">
        <div id="loginSection">
            <div class="text-center mb-10">
                <div class="text-6xl mb-4">ğŸ”</div>
                <h2 class="text-3xl font-black">×›× ×™×¡×ª ××¢×¡×™×§×™×</h2>
                <p class="text-slate-400">×¦×¤×” ×‘××•×¢××“×™× ×©×©×œ×—×• ×œ×š ×”×•×“×¢×”</p>
            </div>
            <div class="space-y-4 max-w-xs mx-auto">
                <input type="email" id="auth-email" placeholder="××™××™×™×œ" class="input-premium">
                <input type="password" id="auth-pass" placeholder="×¡×™×¡××”" class="input-premium">
                <button onclick="Auth.exec('login')" class="btn-premium">×”×ª×—×‘×¨</button>
                <button onclick="Auth.exec('signup')" class="w-full text-slate-500 font-bold text-sm">×™×¦×™×¨×ª ×—×©×‘×•×Ÿ ×—×“×©</button>
            </div>
        </div>

        <div id="dashboardSection" class="hidden">
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-3xl font-black">×”×œ×™×“×™× ×©×œ×™</h2>
                <button onclick="Auth.logout()" class="text-error font-bold text-sm">×”×ª× ×ª×§</button>
            </div>
            <div id="leadsGrid" class="space-y-4"></div>
        </div>
    </div>

    <div id="page-post" class="page">
        <h2 class="text-3xl font-black mb-8 italic text-blue-500">×¤×¨×¡× ××©×¨×” ×—×“×©×”</h2>
        <div class="space-y-5">
            <input type="text" id="p-title" placeholder="×›×•×ª×¨×ª ×”××©×¨×”" class="input-premium">
            <input type="text" id="p-company" placeholder="×©× ×”×¢×¡×§" class="input-premium">
            <div class="grid grid-cols-2 gap-3">
                <input type="text" id="p-city" placeholder="×¢×™×¨" class="input-premium">
                <input type="text" id="p-salary" placeholder="×©×›×¨" class="input-premium">
            </div>
            <input type="tel" id="p-phone" placeholder="×˜×œ×¤×•×Ÿ ×œ×™×¦×™×¨×ª ×§×©×¨ (05...)" class="input-premium">
            <textarea id="p-desc" placeholder="×ª×™××•×¨ ××¤×•×¨×˜ ×©×œ ×”×ª×¤×§×™×“..." class="input-premium h-32"></textarea>
            
            <div class="p-6 bg-slate-900/50 rounded-3xl border border-dashed border-slate-700">
                <p class="text-xs font-black text-blue-400 mb-4 uppercase">×©××œ×•×ª ×¡×™× ×•×Ÿ (×›×Ÿ/×œ×):</p>
                <div id="dynamicQs" class="space-y-3">
                    <input type="text" class="q-val input-premium py-3" placeholder="×œ××©×œ: ×™×© ×œ×š ×¨×™×©×™×•×Ÿ × ×”×™×’×”?">
                </div>
                <button onclick="UI.addQ()" class="text-blue-500 text-xs mt-4 font-bold">+ ×”×•×¡×£ ×©××œ×”</button>
            </div>
            <button onclick="Data.saveJob()" class="btn-premium py-6 text-xl mt-6">×¤×¨×¡× ×‘×œ×•×— ×¢×›×©×™×• ğŸš€</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <div onclick="Nav.go('feed')" class="nav-link active" id="n-feed"><i>ğŸ </i><span>×œ×•×—</span></div>
        <div onclick="Nav.go('post')" class="nav-link" id="n-post"><i>â•</i><span>×¤×¨×¡×</span></div>
        <div onclick="Nav.go('admin')" class="nav-link" id="n-admin"><i>ğŸ‘¤</i><span>××™×©×™</span></div>
    </nav>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ×”×’×“×¨×•×ª Firebase - ×•×•×“× ×©×”×Ÿ × ×›×•× ×•×ª
    const firebaseConfig = { 
        apiKey: "AIzaSyD0hsz8SOI1O...", 
        authDomain: "matchme-32bcf.firebaseapp.com", 
        projectId: "matchme-32bcf", 
        storageBucket: "matchme-32bcf.appspot.com", 
        messagingSenderId: "1082863959305", 
        appId: "1:1082863959305:web:f888f4df815598696c601f" 
    };

    const firebaseApp = initializeApp(firebaseConfig);
    const auth = getAuth(firebaseApp);
    const db = getFirestore(firebaseApp);

    // × ×™×”×•×œ ××¦×‘ ×’×œ×•×‘×œ×™ (State) - ×¤×•×ª×¨ ××ª ×‘×¢×™×™×ª ×”-undefined
    const State = {
        user: null,
        jobs: [],
        activeJob: null,
        quiz: { idx: 0, score: 0 },
        // ×™×¦×™×¨×ª ××–×”×” ×™×™×—×•×“×™ ×œ××©×ª××© ×–×× ×™ ×›×“×™ ×œ×× ×•×¢ ×©×’×™××•×ª ×©××™×¨×”
        tempID: localStorage.getItem('mm_uid') || 'u_' + Math.random().toString(36).substr(2, 9)
    };
    if(!localStorage.getItem('mm_uid')) localStorage.setItem('mm_uid', State.tempID);

    // ×× ×•×¢ × ×™×•×•×˜
    const Nav = {
        go(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${id}`).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const activeNav = document.getElementById(`n-${id}`);
            if(activeNav) activeNav.classList.add('active');
            
            if(id === 'feed') Data.load();
            if(id === 'admin') UI.renderDash();
            window.scrollTo(0,0);
        }
    };

    // ×× ×•×¢ × ×ª×•× ×™× (Firebase) - ×˜×™×¤×•×œ ×‘×©×’×™××ª addDoc ×•-undefined
    const Data = {
        async saveJob() {
            UI.loading(true);
            const title = document.getElementById('p-title').value.trim();
            const company = document.getElementById('p-company').value.trim();
            const phone = document.getElementById('p-phone').value.replace(/\D/g, '');
            
            if(!title || !company || !phone) {
                alert("×—×•×‘×” ×œ××œ× ×›×•×ª×¨×ª, ×—×‘×¨×” ×•×˜×œ×¤×•×Ÿ!");
                UI.loading(false);
                return;
            }

            try {
                const owner = State.user ? State.user.uid : State.tempID;
                await addDoc(collection(db, "jobs"), {
                    title, company, phone,
                    city: document.getElementById('p-city').value || "×›×œ ×”××¨×¥",
                    salary: document.getElementById('p-salary').value || "×’××™×©",
                    desc: document.getElementById('p-desc').value || "××™×Ÿ ×ª×™××•×¨",
                    questions: Array.from(document.querySelectorAll('.q-val')).map(i => i.value).filter(v => v),
                    owner: owner,
                    createdAt: serverTimestamp()
                });
                Nav.go('feed');
            } catch (err) {
                console.error(err);
                alert("×©×’×™××” ×‘×©××™×¨×ª ×”××©×¨×”. × ×¡×” ×©×•×‘.");
            } finally { UI.loading(false); }
        },

        async load() {
            const q = query(collection(db, "jobs"), orderBy("createdAt", "desc"));
            const snap = await getDocs(q);
            State.jobs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            UI.renderFeed(State.jobs);
        }
    };

    // ×××©×§ ××©×ª××© (UI) - ×ª×™×§×•×Ÿ ×”×¦×’×ª × ×ª×•× ×™ ×”-undefined ×‘×œ×•×—
    const UI = {
        loading(s) { document.getElementById('mainLoader').style.display = s ? 'flex' : 'none'; },
        
        search() {
            const val = document.getElementById('jobSearch').value.toLowerCase();
            const filtered = State.jobs.filter(j => 
                j.title.toLowerCase().includes(val) || 
                j.city.toLowerCase().includes(val) || 
                j.company.toLowerCase().includes(val)
            );
            UI.renderFeed(filtered);
        },

        renderFeed(list) {
            const grid = document.getElementById('jobsGrid');
            if(list.length === 0) {
                grid.innerHTML = `<div class="text-center py-20 opacity-30 font-bold">×œ× × ××¦××• ××©×¨×•×ª...</div>`;
                return;
            }
            grid.innerHTML = list.map(j => `
                <div onclick="UI.openJob('${j.id}')" class="job-card">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-2xl font-black">${j.title || '××©×¨×” ×œ×œ× ×©×'}</h3>
                        <span class="text-xs font-black text-blue-500 bg-blue-500/10 px-3 py-1 rounded-full uppercase">${j.salary || '×’××™×©'}</span>
                    </div>
                    <p class="text-slate-400 font-bold">ğŸ¢ ${j.company || '××¢×¡×™×§'} | ğŸ“ ${j.city || '×™×©×¨××œ'}</p>
                </div>
            `).join('');
        },

        openJob(id) {
            State.activeJob = State.jobs.find(x => x.id === id);
            const j = State.activeJob;
            document.getElementById('detailsBox').innerHTML = `
                <div class="job-card bg-slate-900/40 border-none p-10 mb-8">
                    <h2 class="text-4xl font-black mb-4">${j.title}</h2>
                    <p class="text-blue-500 font-bold mb-8 text-xl">${j.company} â€¢ ${j.city}</p>
                    <div class="h-px bg-slate-800 mb-8"></div>
                    <p class="text-slate-300 leading-relaxed text-lg whitespace-pre-wrap">${j.desc}</p>
                </div>
            `;
            Nav.go('details');
        },

        addQ() {
            const inp = document.createElement('input');
            inp.className = "q-val input-premium py-3 mt-2";
            inp.placeholder = "×©××œ×” × ×•×¡×¤×ª...";
            document.getElementById('dynamicQs').appendChild(inp);
        },

        async renderDash() {
            if(!State.user) {
                document.getElementById('loginSection').classList.remove('hidden');
                document.getElementById('dashboardSection').classList.add('hidden');
                return;
            }
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            
            const grid = document.getElementById('leadsGrid');
            grid.innerHTML = '<div class="spinner mx-auto my-10"></div>';
            
            const q = query(collection(db, "leads"), where("boss", "==", State.user.uid), orderBy("createdAt", "desc"));
            const snap = await getDocs(q);
            
            grid.innerHTML = snap.docs.map(doc => {
                const d = doc.data();
                return `
                <div class="job-card border-r-4 border-green-500">
                    <div class="flex justify-between items-center mb-1">
                        <b class="text-xl">${d.name}</b>
                        <span class="text-green-500 font-black">${d.score}% ×”×ª×××”</span>
                    </div>
                    <div class="flex justify-between items-end">
                        <span class="text-xs text-slate-500">${d.jobTitle}</span>
                        <a href="https://api.whatsapp.com/send?phone=972${d.phone.substring(1)}" class="bg-green-600 text-white px-5 py-2 rounded-xl text-xs font-black shadow-lg">×•×•××˜×¡××¤</a>
                    </div>
                </div>
                `;
            }).join('') || '<p class="text-center opacity-20 py-20 font-bold">×¢×•×“ ×œ× ×”×’×™×¢×• ××•×¢××“×™×...</p>';
        }
    };

    // ×œ×•×’×™×§×ª ××¤×œ×™×§×¦×™×” - ×©××œ×•×Ÿ ×•×—×™×‘×•×¨ ×œ×•×•××˜×¡××¤ (×¤×•×ª×¨ ××ª ×©×’×™××ª ×”-Business ×©×¨××™×ª)
    const App = {
        startProcess() {
            const n = document.getElementById('cand-name').value.trim();
            const p = document.getElementById('cand-phone').value.replace(/\D/g, '');
            
            if(n.length < 2 || p.length < 9) {
                alert("× × ×œ××œ× ×©× ××œ× ×•××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×ª×§×™×Ÿ ×œ×”××©×š");
                return;
            }
            
            State.cand = { n, p };
            State.quiz = { idx: 0, score: 0 };
            
            if(State.activeJob.questions?.length > 0) {
                Nav.go('quiz');
                App.showQ();
            } else {
                App.finish(100);
            }
        },

        showQ() {
            const q = State.activeJob.questions[State.quiz.idx];
            document.getElementById('qText').innerText = q;
            document.getElementById('quizProgress').style.width = ((State.quiz.idx / State.activeJob.questions.length) * 100) + '%';
        },

        answer(val) {
            if(val) State.quiz.score += (100 / State.activeJob.questions.length);
            State.quiz.idx++;
            
            if(State.quiz.idx < State.activeJob.questions.length) {
                App.showQ();
            } else {
                App.finish(Math.round(State.quiz.score));
            }
        },

        async finish(score) {
            UI.loading(true);
            try {
                // ×©××™×¨×ª ×”×œ×™×“ (×”×ª×™×§×•×Ÿ ×œ×©×’×™××ª ×”-addDoc)
                await addDoc(collection(db, "leads"), {
                    boss: State.activeJob.owner || "anon",
                    jobTitle: State.activeJob.title,
                    name: State.cand.n,
                    phone: State.cand.p,
                    score: score,
                    createdAt: serverTimestamp()
                });

                // ×¤×ª×™×—×ª ×•×•××˜×¡××¤ ×¢× ×§×™×©×•×¨ ××•× ×™×‘×¨×¡×œ×™ (×¤×•×ª×¨ ××ª ×”×‘×¢×™×” ×‘×¦×™×œ×•× ××¡×š 10)
                const msg = encodeURIComponent(`×”×™×™, ×× ×™ ${State.cand.n}, ×”×’×©×ª×™ ××•×¢××“×•×ª ×œ××©×¨×ª ${State.activeJob.title} ×•×§×™×‘×œ×ª×™ ${score}% ×”×ª×××”!`);
                window.location.href = `https://api.whatsapp.com/send?phone=972${State.activeJob.phone.substring(1)}&text=${msg}`;
                
                Nav.go('feed');
            } catch (err) {
                console.error(err);
                alert("×©×’×™××” ×‘×¡×™×•× ×”×ª×”×œ×™×š. × ×¡×” ×©×•×‘.");
            } finally { UI.loading(false); }
        }
    };

    // × ×™×”×•×œ ×”×¨×©××•×ª (Auth)
    const Auth = {
        async exec(mode) {
            UI.loading(true);
            const e = document.getElementById('auth-email').value, p = document.getElementById('auth-pass').value;
            try {
                if(mode === 'login') await signInWithEmailAndPassword(auth, e, p);
                else await createUserWithEmailAndPassword(auth, e, p);
            } catch(e) { alert("×©×’×™××”: ×•×•×“× ×©×”××™××™×™×œ × ×›×•×Ÿ ×•×”×¡×™×¡××” ××¨×•×›×” ×-6 ×ª×•×•×™×"); }
            finally { UI.loading(false); }
        },
        async logout() { await signOut(auth); location.reload(); }
    };

    onAuthStateChanged(auth, u => {
        State.user = u;
        Data.load();
    });

    // ×—×©×™×¤×ª ×¤×•× ×§×¦×™×•×ª ×œ×’×œ×•×‘×œ
    window.Nav = Nav; window.UI = UI; window.Data = Data; window.App = App; window.Auth = Auth;

</script>
</body>
</html>
