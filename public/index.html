<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MatchMe Pro | Ultimate Enterprise Edition</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200;300;400;500;600;700;800&family=Rubik:ital,wght@0,900;1,900&display=swap" rel="stylesheet">
    
    <style>
        /* =========================================
           Design System & Variables
           ========================================= */
        :root {
            --bg-main: #020617;
            --bg-card: #0f172a;
            --bg-card-hover: #1e293b;
            --primary: #3b82f6;
            --primary-light: #60a5fa;
            --primary-dark: #1d4ed8;
            --accent: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --nav-height: 80px;
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* =========================================
           Core Reset & Scroll
           ========================================= */
        * {
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            margin: 0; padding: 0;
        }

        body {
            font-family: 'Assistant', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            overflow-x: hidden;
            line-height: 1.6;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-main); }
        ::-webkit-scrollbar-thumb { background: var(--bg-card-hover); border-radius: 10px; }

        /* =========================================
           Utility Classes
           ========================================= */
        .glass {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
        }

        .glass-dark {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(25px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .input-modern {
            width: 100%;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            padding: 16px 20px;
            color: white;
            font-size: 16px;
            font-weight: 500;
            transition: var(--transition-smooth);
            outline: none;
        }

        .input-modern:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
            background: var(--bg-card);
        }

        .btn-premium {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 20px;
            padding: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: var(--transition-smooth);
            cursor: pointer;
            box-shadow: 0 10px 20px -5px rgba(29, 78, 216, 0.4);
        }

        .btn-premium:active { transform: scale(0.96); opacity: 0.9; }

        /* =========================================
           Navigation Component
           ========================================= */
        .main-nav {
            position: fixed;
            bottom: calc(24px + var(--safe-area-inset-bottom));
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 48px);
            max-width: 480px;
            height: 76px;
            z-index: 5000;
            display: grid;
            grid-template-cols: repeat(4, 1fr);
            border-radius: 38px;
            padding: 0 8px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-dim);
            transition: var(--transition-smooth);
            position: relative;
            cursor: pointer;
        }

        .nav-item.active { color: var(--primary-light); }
        .nav-item.active .nav-icon { transform: translateY(-4px); }
        
        .nav-dot {
            position: absolute;
            bottom: 12px;
            width: 4px;
            height: 4px;
            background: var(--primary-light);
            border-radius: 50%;
            opacity: 0;
            transition: var(--transition-smooth);
        }
        .nav-item.active .nav-dot { opacity: 1; transform: scale(1.5); }

        /* =========================================
           Animations
           ========================================= */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse-soft {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .animate-fade-in { animation: fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        /* =========================================
           Page States
           ========================================= */
        .page-content {
            display: none;
            min-height: 100vh;
            padding-bottom: 140px;
            opacity: 0;
        }

        .page-content.active {
            display: block;
            animation: fadeInUp 0.6s ease forwards;
        }

        /* =========================================
           Skeleton & Loader
           ========================================= */
        #app-loader {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: var(--bg-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .loader-circle {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(59, 130, 246, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.5, 0, 0.5, 1) infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* =========================================
           Job Cards System
           ========================================= */
        .job-card {
            background: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.03);
            border-radius: 28px;
            padding: 24px;
            transition: var(--transition-smooth);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .job-card:hover {
            background: var(--bg-card-hover);
            transform: translateY(-5px);
            border-color: rgba(59, 130, 246, 0.2);
        }

        .job-card::before {
            content: '';
            position: absolute;
            top: 0; right: 0; width: 4px; height: 100%;
            background: var(--primary);
            opacity: 0.7;
        }

        .job-card.worker-type::before { background: var(--accent); }

        .badge {
            font-size: 10px;
            font-weight: 800;
            padding: 4px 10px;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-blue { background: rgba(59, 130, 246, 0.15); color: var(--primary-light); }
        .badge-green { background: rgba(16, 185, 129, 0.15); color: var(--accent); }

        /* =========================================
           Toast System
           ========================================= */
        #toast-wrapper {
            position: fixed;
            top: 24px; left: 24px; right: 24px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }

        .toast-item {
            pointer-events: auto;
            background: rgba(15,
<body class="custom-scrollbar">

    <div id="app-loader">
        <div class="loader-circle"></div>
        <div class="mt-6 text-center">
            <h2 class="text-xl font-black tracking-tighter text-blue-500 italic">MATCHME PRO</h2>
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.3em] mt-1">Connecting Talent</p>
        </div>
    </div>

    <div id="toast-wrapper"></div>

    <section id="view-feed" class="page-content active px-6 pt-10">
        <header class="flex justify-between items-end mb-10">
            <div class="animate-fade-in">
                <p class="text-[10px] font-black text-blue-400 uppercase tracking-[0.2em] mb-1 opacity-80">×‘×¨×•×›×™× ×”×‘××™× ×œ××¢×¨×›×ª</p>
                <h1 class="text-5xl font-black tracking-tighter" id="display-user-name">××•×¨×—/×ª</h1>
            </div>
            <div onclick="Router.go('admin')" class="w-16 h-16 glass flex items-center justify-center text-3xl cursor-pointer active:scale-90 transition-all border-2 border-blue-500/20 rounded-[22px] hover:bg-blue-500/10">
                ğŸ‘¤
            </div>
        </header>

        <div class="relative mb-10 group animate-fade-in" style="animation-delay: 0.1s">
            <input type="text" id="search-input" oninput="UI.doSearch(this.value)" 
                   class="input-modern pr-14 h-16 shadow-2xl shadow-blue-900/10" 
                   placeholder="×—×¤×© ×ª×¤×§×™×“, ×¢×™×¨ ××• ×—×‘×¨×”...">
            <span class="absolute right-5 top-1/2 -translate-y-1/2 text-xl opacity-30 group-focus-within:opacity-100 transition-opacity">ğŸ”</span>
        </div>

        <div id="feed-container" class="space-y-6 animate-fade-in" style="animation-delay: 0.2s">
            <div class="flex flex-col items-center justify-center py-24 space-y-4 opacity-20">
                <div class="loader-circle scale-75"></div>
                <p class="font-bold italic">××¨×¢× ×Ÿ × ×ª×•× ×™× ××”×¢× ×Ÿ...</p>
            </div>
        </div>
    </section>

    <section id="view-post" class="page-content px-6 pt-10">
        <div class="flex items-center gap-4 mb-8">
            <div class="w-2.5 h-10 bg-blue-500 rounded-full shadow-[0_0_15px_rgba(59,130,246,0.5)]"></div>
            <h2 class="text-4xl font-black tracking-tighter">×¤×¨×¡× ××•×“×¢×”</h2>
        </div>
        
        <div class="glass p-8 space-y-6 rounded-[35px] shadow-2xl">
            <div class="space-y-2">
                <label class="block text-[10px] font-black uppercase text-blue-400 mr-1 tracking-widest">×¡×•×’ ×”××•×“×¢×” ×©×œ×š</label>
                <select id="inp-type" onchange="UI.toggleQuizBuilder()" class="input-modern font-bold bg-slate-900/50 appearance-none border-none ring-1 ring-white/10">
                    <option value="job">ğŸ’¼ ×× ×™ ××—×¤×© ×¢×•×‘×“ (××¢×¡×™×§)</option>
                    <option value="worker">ğŸ™‹â€â™‚ï¸ ×× ×™ ××—×¤×© ×¢×‘×•×“×” (×¢×•×‘×“)</option>
                </select>
            </div>

            <div class="grid grid-cols-1 gap-5">
                <div class="space-y-2">
                    <label class="block text-[10px] font-black uppercase text-slate-500 mr-1">×›×•×ª×¨×ª ×”××•×“×¢×”</label>
                    <input type="text" id="inp-title" class="input-modern" placeholder="×œ××©×œ: × ×”×’ ××©××™×ª ×¢×“ 12 ×˜×•×Ÿ">
                </div>
                <div class="space-y-2">
                    <label class="block text-[10px] font-black uppercase text-slate-500 mr-1">×©× ×”×¢×¡×§ / ××¤×¨×¡×</label>
                    <input type="text" id="inp-name" class="input-modern" placeholder="×©× ×”×—×‘×¨×” ××• ×”×©× ×©×œ×š">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="block text-[10px] font-black uppercase text-slate-500 mr-1">××™×§×•× / ×¢×™×¨</label>
                        <input type="text" id="inp-city" class="input-modern" placeholder="×œ××©×œ: ×ª×œ ××‘×™×‘">
                    </div>
                    <div class="space-y-2">
                        <label class="block text-[10px] font-black uppercase text-slate-500 mr-1">×˜×œ×¤×•×Ÿ (WhatsApp)</label>
                        <input type="tel" id="inp-phone" class="input-modern" placeholder="05XXXXXXXX">
                    </div>
                </div>
                <div class="space-y-2">
                    <label class="block text-[10px] font-black uppercase text-slate-500 mr-1">×ª×™××•×¨ ×”×ª×¤×§×™×“</label>
                    <textarea id="inp-desc" class="input-modern h-36 resize-none" placeholder="×¤×¨×˜ ×›××Ÿ ×¢×œ ×”××©×¨×”, ×ª× ××™×, ×©×›×¨ ×•×›×•'..."></textarea>
                </div>
            </div>
            
            <div id="quiz-section" class="pt-6 border-t border-white/5">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <p class="text-[11px] font-black uppercase text-blue-400">×©××œ×•×ª ×¡×™× ×•×Ÿ ×œ××•×¢××“×™×</p>
                        <p class="text-[9px] text-slate-500 font-bold uppercase">Candidate Screening (Optional)</p>
                    </div>
                    <span class="text-[9px] bg-blue-500/10 text-blue-400 px-3 py-1 rounded-full font-black">AI SMART</span>
                </div>
                <div id="quiz-list" class="space-y-3">
                    <input type="text" class="q-input input-modern py-4 text-sm" placeholder="×©××œ×” 1: ×”×× ×™×© ×œ×š × ×™×¡×™×•×Ÿ ×©×œ ×©× ×ª×™×™× ×œ×¤×—×•×ª?">
                </div>
                <button onclick="UI.addQField()" class="w-full py-4 mt-3 border-2 border-dashed border-white/5 rounded-2xl text-[10px] font-black text-slate-500 hover:text-white hover:border-blue-500/30 transition-all uppercase tracking-widest">
                    + ×”×•×¡×£ ×©××œ×” × ×•×¡×¤×ª ×œ×¡×™× ×•×Ÿ
                </button>
            </div>

            <button onclick="Data.publish()" class="btn-premium w-full py-6 rounded-2xl font-black text-xl shadow-2xl shadow-blue-500/30 group">
                ×¤×¨×¡× ×‘×œ×•×— ×›×¢×ª
                <span class="group-hover:translate-x-[-10px] transition-transform">ğŸš€</span>
            </button>
        </div>
    </section>

    <section id="view-admin" class="page-content px-6 pt-10">
        <div id="auth-ui" class="animate-fade-in">
            <div class="text-center mb-12">
                <div class="inline-block p-6 bg-blue-500/10 rounded-[30px] mb-6 shadow-inner">
                    <span class="text-5xl">ğŸ”</span>
                </div>
                <h2 class="text-4xl font-black tracking-tighter">××–×•×¨ × ×™×”×•×œ</h2>
                <p class="text-slate-500 text-sm font-bold mt-2">× ×”×œ ××ª ×”××•×“×¢×•×ª ×•×”×¤× ×™×•×ª ×©×œ×š ×‘×–××Ÿ ×××ª</p>
            </div>
            
            <div class="glass p-10 space-y-5 rounded-[40px] shadow-2xl border-white/10">
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-500 mr-1 uppercase">×“×•××¨ ××œ×§×˜×¨×•× ×™</label>
                    <input type="email" id="auth-email" class="input-modern" placeholder="email@example.com">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-500 mr-1 uppercase">×¡×™×¡××” ××™×©×™×ª</label>
                    <input type="password" id="auth-pass" class="input-modern" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                </div>
                <button onclick="Auth.handle('login')" class="btn-premium w-full py-5 rounded-2xl font-black text-lg mt-4">×›× ×™×¡×” ×œ××¢×¨×›×ª</button>
                <div class="flex items-center gap-4 py-4">
                    <div class="flex-1 h-px bg-white/5"></div>
                    <span class="text-[10px] font-black text-slate-600 uppercase">××•</span>
                    <div class="flex-1 h-px bg-white/5"></div>
                </div>
                <button onclick="Auth.handle('signup')" class="w-full py-4 text-blue-400 text-xs font-black uppercase tracking-widest hover:text-white transition-colors">×™×¦×™×¨×ª ×—×©×‘×•×Ÿ ××¢×¡×™×§/×¢×•×‘×“ ×—×“×©</button>
            </div>
        </div>

        <div id="dash-ui" class="hidden">
            <div class="flex justify-between items-end mb-12 animate-fade-in">
                <div>
                    <h2 class="text-4xl font-black tracking-tighter">×”× ×™×”×•×œ ×©×œ×™</h2>
                    <p class="text-blue-400 text-[10px] font-black uppercase tracking-[0.2em] mt-1">Control Panel</p>
                </div>
                <button onclick="Auth.logout()" class="px-5 py-2.5 bg-red-500/10 text-red-500 text-[10px] font-black rounded-xl uppercase border border-red-500/20 active:scale-95 transition-all">×”×ª× ×ª×§ ğŸšª</button>
            </div>

            <div class="space-y-12">
                <section>
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-1.5 h-6 bg-blue-500 rounded-full"></div>
                        <h3 class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em]">×”××•×“×¢×•×ª ×”×¤×¢×™×œ×•×ª ×©×œ×š</h3>
                    </div>
                    <div id="my-posts" class="space-y-4">
                        </div>
                </section>

                <section>
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-1.5 h-6 bg-green-500 rounded-full"></div>
                        <h3 class="text-[11px] font-black text-green-400 uppercase tracking-[0.2em]">×¤× ×™×•×ª ×•×œ×™×“×™× ×—×“×©×™×</h3>
                    </div>
                    <div id="my-leads" class="space-y-5">
                        </div>
                </section>
            </div>
        </div>
    </section>

    <nav class="main-nav glass-dark shadow-[0_-10px_40px_rgba(0,0,0,0.5)]">
        <div class="nav-item active" id="nav-feed" onclick="Router.go('feed')">
            <span class="text-2xl nav-icon transition-transform duration-300">ğŸ </span>
            <span class="text-[9px] font-black uppercase mt-1 tracking-tighter">×œ×•×— ××©×¨×•×ª</span>
            <div class="nav-dot"></div>
        </div>
        <div class="nav-item" id="nav-post" onclick="Router.go('post')">
            <span class="text-2xl nav-icon transition-transform duration-300">â•</span>
            <span class="text-[9px] font-black uppercase mt-1 tracking-tighter">×¤×¨×¡×•× ×—×“×©</span>
            <div class="nav-dot"></div>
        </div>
        <div class="nav-item" id="nav-admin" onclick="Router.go('admin')">
            <span class="text-2xl nav-icon transition-transform duration-300">ğŸ“Š</span>
            <span class="text-[9px] font-black uppercase mt-1 tracking-tighter">××–×•×¨ ××™×©×™</span>
            <div class="nav-dot"></div>
        </div>
        <div class="nav-item" onclick="UI.showInfo()">
            <span class="text-2xl nav-icon transition-transform duration-300">â„¹ï¸</span>
            <span class="text-[9px] font-black uppercase mt-1 tracking-tighter">××™×“×¢ ×¢×œ×™× ×•</span>
            <div class="nav-dot"></div>
        </div>
    </nav>
<script type="module">
    // ×™×™×‘×•× ××•×“×•×œ×™× ×¨×©××™×™× ×©×œ Firebase ××”-CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ×”×’×“×¨×•×ª Firebase - ××•×ª×× ×œ×¤×¨×•×™×§×˜ matchme-32bcf
    const firebaseConfig = {
        apiKey: "AIzaSyD0hsz8SOI1OG2Fh-DBy1SHeabPaEKZx-Y",
        authDomain: "matchme-32bcf.firebaseapp.com",
        projectId: "matchme-32bcf",
        storageBucket: "matchme-32bcf.appspot.com",
        appId: "1:1082863959305:web:f888f4df815598696c601f"
    };

    // ××ª×—×•×œ Instance ×©×œ Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // × ×™×”×•×œ ××¦×‘ ×’×œ×•×‘×œ×™ (State Management)
    const GlobalState = {
        user: null,
        posts: [],
        filteredPosts: [],
        currentView: 'feed',
        isLoading: false
    };

    /**
     * ××¢×¨×›×ª ×”× ×™×ª×•×‘ (Router)
     * ××—×¨××™×ª ×¢×œ ××¢×‘×¨ ×—×œ×§ ×‘×™×Ÿ ×“×¤×™× ×•× ×™×”×•×œ ×”-URL ×”×•×•×™×¨×˜×•××œ×™
     */
    const Router = {
        go(viewId) {
            console.log(`Navigating to: ${viewId}`);
            
            // ×¢×“×›×•×Ÿ UI ×©×œ ×”×“×¤×™× - ×”×¢×œ××” ×•×”×•×¤×¢×”
            document.querySelectorAll('.page-content').forEach(p => {
                p.classList.remove('active');
            });
            
            const targetPage = document.getElementById(`view-${viewId}`);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // ×¢×“×›×•×Ÿ ××¦×‘ ×›×¤×ª×•×¨×™ ×”× ×™×•×•×˜ (Active State)
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const activeNav = document.getElementById(`nav-${viewId}`);
            if (activeNav) activeNav.classList.add('active');

            GlobalState.currentView = viewId;
            
            // ×œ×•×’×™×§×ª ×˜×¢×™× ×” ×™×™×¢×•×“×™×ª ×œ×¤×™ ×“×£
            if(viewId === 'feed') Data.load();
            if(viewId === 'admin') UI.refreshDash();
            
            // ×’×œ×™×œ×” ××•×˜×•××˜×™×ª ×œ×¨××© ×”×“×£
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    };

    /**
     * × ×™×”×•×œ × ×ª×•× ×™× (Data Layer)
     * ×›×œ ×”×¤×•× ×§×¦×™×•×ª ×©××ª×§×©×¨×•×ª ×™×©×™×¨×•×ª ×¢× Firestore
     */
    const Data = {
        // ×˜×¢×™× ×ª ×›×œ ×”××•×“×¢×•×ª ××”×©×¨×ª
        async load() {
            if (GlobalState.isLoading) return;
            UI.loader(true);
            GlobalState.isLoading = true;

            try {
                const q = query(
                    collection(db, "posts"), 
                    orderBy("createdAt", "desc")
                );
                
                const querySnapshot = await getDocs(q);
                GlobalState.posts = querySnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                GlobalState.filteredPosts = [...GlobalState.posts];
                UI.renderFeed(GlobalState.filteredPosts);
            } catch (error) {
                console.error("Data Load Error:", error);
                Toast.show("×©×’×™××” ×‘×¡× ×›×¨×•×Ÿ ×”× ×ª×•× ×™×. × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨.");
            } finally {
                UI.loader(false);
                GlobalState.isLoading = false;
            }
        },

        // ×¤×¨×¡×•× ××•×“×¢×” ×—×“×©×” (××¢×¡×™×§ ××• ×¢×•×‘×“)
        async publish() {
            const title = document.getElementById('inp-title').value.trim();
            const phone = document.getElementById('inp-phone').value.trim();
            const type = document.getElementById('inp-type').value;
            const name = document.getElementById('inp-name').value.trim();
            const city = document.getElementById('inp-city').value.trim();
            const desc = document.getElementById('inp-desc').value.trim();

            // ×•×•×œ×™×“×¦×™×” ×‘×¡×™×¡×™×ª
            if(!title || phone.length < 9 || !name) {
                return Toast.show("× × ×œ××œ× ××ª ×›×œ ×©×“×•×ª ×”×—×•×‘×” (×›×•×ª×¨×ª, ×©× ×•×˜×œ×¤×•×Ÿ ×ª×§×™×Ÿ)");
            }

            UI.loader(true);

            // ××™×¡×•×£ ×©××œ×•×ª ×”×©××œ×•×Ÿ (×¨×§ ×× ×–×” ×¡×•×’ "××¢×¡×™×§")
            const questions = Array.from(document.querySelectorAll('.q-input'))
                                 .map(input => input.value.trim())
                                 .filter(val => val !== "");

            try {
                const newDoc = {
                    type,
                    title,
                    name,
                    city: city || "×›×œ ×”××¨×¥",
                    phone: phone.replace(/\D/g, ''), // × ×™×§×•×™ ×ª×•×•×™× ×©×”× ×œ× ×¡×¤×¨×•×ª
                    desc: desc,
                    questions: type === 'job' ? questions : [],
                    owner: GlobalState.user ? GlobalState.user.uid : "guest",
                    createdAt: serverTimestamp(),
                    viewCount: 0
                };

                await addDoc(collection(db, "posts"), newDoc);
                
                Toast.show("×”××•×“×¢×” ×¤×•×¨×¡××” ×‘×”×¦×œ×—×”! ğŸš€");
                
                // ××™×¤×•×¡ ×˜×•×¤×¡
                document.getElementById('inp-title').value = "";
                document.getElementById('inp-desc').value = "";
                
                Router.go('feed');
            } catch (error) {
                console.error("Publish Error:", error);
                Toast.show("×ª×§×œ×” ×‘×¤×¨×¡×•×. ×•×•×“× ×©××ª×” ××—×•×‘×¨ ×œ××™× ×˜×¨× ×˜.");
            } finally {
                UI.loader(false);
            }
        },

        // ××—×™×§×ª ××•×“×¢×” ××”×“×©×‘×•×¨×“
        async deletePost(id) {
            if(!confirm("×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”××•×“×¢×” ×œ×¦××™×ª×•×ª?")) return;
            
            UI.loader(true);
            try {
                await deleteDoc(doc(db, "posts", id));
                Toast.show("×”××•×“×¢×” ×”×•×¡×¨×” ×‘×”×¦×œ×—×”");
                UI.refreshDash(); // ×¨×¢× ×•×Ÿ ×ª×¦×•×’×ª ×”× ×™×”×•×œ
            } catch (error) {
                Toast.show("×©×’×™××” ×‘××—×™×§×ª ×”××•×“×¢×”");
            } finally {
                UI.loader(false);
            }
        }
    };

    // ×—×©×™×¤×ª ××•×‘×™×™×§×˜×™× ×œ×—×œ×•×Ÿ ×”×’×œ×•×‘×œ×™ ×œ×¦×•×¨×š ×©×™××•×© ×‘-HTML
    window.Router = Router;
    window.Data = Data;
    window.GlobalState = GlobalState;
    window.auth = auth;
    window.db = db;
    /**
     * ×××©×§ ××©×ª××© (UI Layer)
     * ××—×¨××™ ×¢×œ ×”×¤×™×›×ª ×”× ×ª×•× ×™× ×œ××œ×× ×˜×™× ×•×™×–×•××œ×™×™×
     */
    const UI = {
        // ×©×œ×™×˜×” ×¢×œ ×”×¦×’×ª ×”×œ×•××“×¨
        loader(show) {
            const loader = document.getElementById('app-loader');
            if (show) {
                loader.style.display = 'flex';
                loader.style.opacity = '1';
            } else {
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 400);
            }
        },

        // ×¨×™× ×“×•×¨ ×œ×•×— ×”××•×“×¢×•×ª
        renderFeed(list) {
            const container = document.getElementById('feed-container');
            if (list.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-20 opacity-40 animate-fade-in">
                        <div class="text-6xl mb-4">ğŸ”</div>
                        <p class="font-bold">×œ× × ××¦××• ××•×“×¢×•×ª ×ª×•×××•×ª...</p>
                        <button onclick="Data.load()" class="text-blue-500 text-xs mt-2 underline">×¨×¢× ×Ÿ ×”×›×œ</button>
                    </div>`;
                return;
            }

            container.innerHTML = list.map((item, index) => {
                const isJob = item.type === 'job';
                const delay = (index % 10) * 0.05;
                return `
                <div class="job-card animate-fade-in ${!isJob ? 'worker-type' : ''}" 
                     style="animation-delay: ${delay}s"
                     onclick="App.handleAction('${item.id}')">
                    <div class="flex justify-between items-start mb-4">
                        <span class="badge ${isJob ? 'badge-blue' : 'badge-green'}">
                            ${isJob ? 'ğŸ’¼ ×“×¨×•×©×™×' : 'ğŸ™‹â€â™‚ï¸ ××—×¤×© ×¢×‘×•×“×”'}
                        </span>
                        <span class="text-[11px] font-bold text-slate-500">ğŸ“ ${item.city || '××¨×¦×™'}</span>
                    </div>
                    <h3 class="text-2xl font-black mb-1 text-white tracking-tight">${item.title}</h3>
                    <p class="text-blue-400 font-bold text-sm mb-4">${item.name}</p>
                    <div class="flex items-center gap-2 pt-4 border-t border-white/5 mt-auto">
                        <div class="w-8 h-8 rounded-full bg-blue-500/10 flex items-center justify-center text-xs">âœ¨</div>
                        <span class="text-[11px] font-black uppercase text-slate-400 tracking-wider">
                            ${isJob ? '×‘×“×•×§ ×”×ª×××” ×•×”×’×© ××•×¢××“×•×ª' : '×¦×¤×” ×‘×¤×¨×˜×™× ×•×¦×•×¨ ×§×©×¨'}
                        </span>
                    </div>
                </div>`;
            }).join('');
        },

        // ×—×™×¤×•×© ×“×™× ××™ ×‘×–××Ÿ ×××ª
        doSearch(val) {
            const term = val.toLowerCase().trim();
            GlobalState.filteredPosts = GlobalState.posts.filter(p => 
                p.title.toLowerCase().includes(term) || 
                p.city.toLowerCase().includes(term) || 
                p.name.toLowerCase().includes(term)
            );
            this.renderFeed(GlobalState.filteredPosts);
        },

        // ×¨×¢× ×•×Ÿ ×“×©×‘×•×¨×“ ×”× ×™×”×•×œ ×”××™×©×™
        async refreshDash() {
            if (!GlobalState.user) return;
            document.getElementById('auth-ui').classList.add('hidden');
            const dash = document.getElementById('dash-ui');
            dash.classList.remove('hidden');

            try {
                // ××©×™×›×ª ××•×“×¢×•×ª ×©×¤×¨×¡××ª×™
                const pSnap = await getDocs(query(collection(db, "posts"), where("owner", "==", GlobalState.user.uid)));
                const myPosts = document.getElementById('my-posts');
                myPosts.innerHTML = pSnap.docs.map(d => `
                    <div class="glass p-5 flex justify-between items-center rounded-2xl border-white/5">
                        <div>
                            <p class="font-black text-sm">${d.data().title}</p>
                            <p class="text-[10px] text-slate-500 font-bold uppercase">${new Date(d.data().createdAt?.toDate()).toLocaleDateString('he-IL')}</p>
                        </div>
                        <button onclick="Data.deletePost('${d.id}')" class="w-10 h-10 flex items-center justify-center bg-red-500/10 text-red-500 rounded-xl hover:bg-red-500 hover:text-white transition-all">ğŸ—‘ï¸</button>
                    </div>
                `).join('') || '<div class="glass p-8 text-center rounded-2xl opacity-30 italic text-sm">×˜×¨× ×¤×¨×¡××ª ××•×“×¢×•×ª</div>';

                // ××©×™×›×ª ×¤× ×™×•×ª ×©×§×™×‘×œ×ª×™ (Leads)
                const lSnap = await getDocs(query(collection(db, "leads"), where("bossID", "==", GlobalState.user.uid), orderBy("createdAt", "desc")));
                const leads = document.getElementById('my-leads');
                leads.innerHTML = lSnap.docs.map(d => {
                    const l = d.data();
                    return `
                    <div class="glass p-6 border-r-4 border-green-500 rounded-2xl animate-fade-in">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="font-black text-lg">${l.candidateName}</h4>
                                <p class="text-[10px] font-bold text-blue-400 uppercase tracking-widest">${l.jobTitle}</p>
                            </div>
                            <div class="bg-green-500/20 text-green-400 w-12 h-12 rounded-full flex items-center justify-center font-black shadow-lg shadow-green-900/20">
                                ${l.matchScore}%
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <a href="https://api.whatsapp.com/send?phone=972${l.candidatePhone.substring(1)}" target="_blank" class="flex items-center justify-center py-3 bg-green-600 text-white rounded-xl text-[10px] font-black uppercase">WhatsApp</a>
                            <a href="tel:${l.candidatePhone}" class="flex items-center justify-center py-3 bg-slate-700 text-white rounded-xl text-[10px] font-black uppercase tracking-widest">Call Now</a>
                        </div>
                    </div>`;
                }).join('') || '<div class="glass p-8 text-center rounded-2xl opacity-30 italic text-sm">××™×Ÿ ×¤× ×™×•×ª ×—×“×©×•×ª ×›×¨×’×¢</div>';

            } catch (e) { console.error("Dash Refresh Error:", e); }
        },

        toggleQuizBuilder() {
            const isJob = document.getElementById('inp-type').value === 'job';
            document.getElementById('quiz-section').style.display = isJob ? 'block' : 'none';
        },

        addQField() {
            const container = document.getElementById('quiz-list');
            const input = document.createElement('input');
            input.className = "q-input input-modern py-4 text-sm animate-fade-in";
            input.placeholder = "×”×•×¡×£ ×©××œ×ª ×›×Ÿ/×œ× × ×•×¡×¤×ª...";
            container.appendChild(input);
        },

        showInfo() {
            alert("MatchMe Pro v3.0\n------------------\n××¢×¨×›×ª ×’×™×•×¡ ×—×›××” ××‘×•×¡×¡×ª AI ×•×”×ª×××” ×‘×•×•××˜×¡××¤.\n× ×‘× ×” ×¢×‘×•×¨ ×‘×™×¦×•×¢×™× ××§×¡×™××œ×™×™×.");
        }
    };

    /**
     * ×œ×•×’×™×§×ª ×”××¤×œ×™×§×¦×™×” (Application Logic)
     */
    const App = {
        async handleAction(postId) {
            const post = GlobalState.posts.find(p => p.id === postId);
            if (!post) return;

            // ×× ×–×” ×¢×•×‘×“ ×©××—×¤×© ×¢×‘×•×“×” - ×¤×•× ×™× ××œ×™×• ×™×©×™×¨×•×ª
            if (post.type === 'worker') {
                this.finalizeApplication(post, 100, "×× ×”×œ ×’×™×•×¡");
                return;
            }

            // ×× ×–×” ××¢×¡×™×§ - ××ª×—×™×œ×™× ×©××œ×•×Ÿ ×¡×™× ×•×Ÿ
            const name = prompt("×”×›× ×¡ ××ª ×©××š ×”××œ× ×œ×”×ª×—×œ×ª ×”×ª×”×œ×™×š:");
            if (!name) return;
            const phone = prompt("××” ××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×©×œ×š?");
            if (!phone || phone.length < 9) return Toast.show("×˜×œ×¤×•×Ÿ ×œ× ×ª×§×™×Ÿ");

            let score = 100;
            if (post.questions && post.questions.length > 0) {
                let correct = 0;
                for (const q of post.questions) {
                    if (confirm(`${q}\n\n(××™×©×•×¨ = ×›×Ÿ | ×‘×™×˜×•×œ = ×œ×)`)) correct++;
                }
                score = Math.round((correct / post.questions.length) * 100);
            }

            // ×©××™×¨×ª ×œ×™×“ ×œ××¢×¡×™×§
            try {
                UI.loader(true);
                await addDoc(collection(db, "leads"), {
                    bossID: post.owner,
                    jobTitle: post.title,
                    candidateName: name,
                    candidatePhone: phone.replace(/\D/g, ''),
                    matchScore: score,
                    createdAt: serverTimestamp()
                });
                this.finalizeApplication(post, score, name);
            } catch (e) { Toast.show("×ª×§×œ×” ×‘×©×œ×™×—×ª ×”××•×¢××“×•×ª"); }
            UI.loader(false);
        },

        finalizeApplication(post, score, name) {
            const cleanPhone = post.phone.startsWith('0') ? '972' + post.phone.substring(1) : post.phone;
            const msg = encodeURIComponent(`×”×™×™, ×× ×™ ×¤×•× ×” ×“×¨×š MatchMe ×œ×’×‘×™: ${post.title}.\n×©××™: ${name}\n×¦×™×•×Ÿ ×”×ª×××” ×œ×©××œ×•×Ÿ: ${score}%`);
            window.open(`https://api.whatsapp.com/send?phone=${cleanPhone}&text=${msg}`, '_blank');
        }
    };

    /**
     * ××™××•×ª ××©×ª××©×™× (Auth)
     */
    const Auth = {
        async handle(mode) {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            if (!email || pass.length < 6) return Toast.show("××™×™×œ ×œ× ×ª×§×™×Ÿ ××• ×¡×™×¡××” ×§×¦×¨×” ××“×™");

            UI.loader(true);
            try {
                if (mode === 'login') {
                    await signInWithEmailAndPassword(auth, email, pass);
                    Toast.show("×‘×¨×•×š ×”×©×‘! âœ¨");
                } else {
                    await createUserWithEmailAndPassword(auth, email, pass);
                    Toast.show("×‘×¨×•×š ×”×‘× ×œ××©×¤×—×”! ğŸš€");
                }
                Router.go('admin');
            } catch (e) { Toast.show("×©×’×™××”: " + e.code); }
            UI.loader(false);
        },
        logout() {
            if (confirm("×œ×”×ª× ×ª×§?")) signOut(auth).then(() => location.reload());
        }
    };

    /**
     * ×”×ª×¨××•×ª (Toast)
     */
    const Toast = {
        show(msg) {
            const wrapper = document.getElementById('toast-wrapper');
            const el = document.createElement('div');
            el.className = "toast-item";
            el.innerHTML = `<span>ğŸ””</span><span class="text-sm font-bold">${msg}</span>`;
            wrapper.appendChild(el);
            setTimeout(() => {
                el.style.opacity = '0';
                setTimeout(() => el.remove(), 500);
            }, 3500);
        }
    };

    // ×”××–× ×” ×œ××¦×‘ ×”××©×ª××©
    onAuthStateChanged(auth, (user) => {
        GlobalState.user = user;
        if (user) {
            document.getElementById('display-user-name').innerText = user.email.split('@')[0];
            if (GlobalState.currentView === 'admin') UI.refreshDash();
        } else {
            document.getElementById('display-user-name').innerText = "××•×¨×—/×ª";
        }
        UI.loader(false);
    });

    // ×™×™×¦×•× ×¤×•× ×§×¦×™×•×ª ×œ-DOM
    window.UI = UI;
    window.Auth = Auth;
    window.App = App;
    window.Toast = Toast;

    // ××ª×—×•×œ ×¨××©×•× ×™
    Data.load();
</script>
</body>
</html>
