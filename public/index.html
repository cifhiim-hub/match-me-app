<style>
    .delete-btn { color: #ef4444; font-size: 10px; font-weight: bold; border: 1px solid #ef4444; padding: 2px 8px; border-radius: 6px; }
    .success-badge { animation: scaleIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes scaleIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
</style>

<script type="module">
    // ... (Firebase Import & Config נשארים אותו דבר)

    // פונקציית מחיקה חדשה
    window.deletePost = async (id) => {
        if(!confirm("להסיר את המודעה מהלוח?")) return;
        UI.loader(true);
        try {
            await deleteDoc(doc(db, "posts", id));
            UI.renderDash();
        } catch(e) { alert("שגיאה במחיקה"); }
        UI.loader(false);
    };

    // עדכון UI.renderDash כדי לכלול כפתור מחיקה
    UI.renderDash = async () => {
        if(!State.user) { 
            document.getElementById('auth-section').classList.remove('hidden');
            document.getElementById('dash-section').classList.add('hidden');
            return;
        }
        document.getElementById('auth-section').classList.add('hidden');
        document.getElementById('dash-section').classList.remove('hidden');

        const myPosts = await getDocs(query(collection(db, "posts"), where("owner", "==", State.user.uid)));
        document.getElementById('my-list').innerHTML = myPosts.docs.map(d => `
            <div class="p-4 bg-slate-800 rounded-2xl flex justify-between items-center border-r-4 border-blue-500 mb-2">
                <div>
                    <span class="font-bold block">${d.data().title}</span>
                    <span class="text-[10px] opacity-40">פורסם ב: ${d.data().createdAt?.toDate().toLocaleDateString() || 'עכשיו'}</span>
                </div>
                <button onclick="deletePost('${d.id}')" class="delete-btn">מחק</button>
            </div>
        `).join('') || '<p class="text-xs opacity-30">אין מודעות פעילות</p>';

        const leads = await getDocs(query(collection(db, "leads"), where("bossID", "==", State.user.uid)));
        document.getElementById('leads-list').innerHTML = leads.docs.map(d => {
            const l = d.data();
            return `
            <div class="glass-card flex justify-between items-center !mb-3">
                <div>
                    <div class="font-black text-lg">${l.candidateName}</div>
                    <div class="text-[10px] opacity-60">למשרה: ${l.jobTitle}</div>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-black ${l.matchScore > 70 ? 'text-green-400' : 'text-yellow-400'}">${l.matchScore}%</div>
                    <a href="https://wa.me/972${l.candidatePhone.substring(1)}" class="text-[10px] text-blue-400 font-bold underline">וואטסאפ</a>
                </div>
            </div>`;
        }).join('') || '<p class="text-xs opacity-30 text-center">טרם התקבלו פניות</p>';
    };

    // ולידציה משופרת בפרסום
    Data.save = async () => {
        const title = document.getElementById('p-title').value;
        const phone = document.getElementById('p-phone').value;
        const name = document.getElementById('p-name').value;
        
        if(title.length < 3) return alert("כותרת קצרה מדי");
        if(!/^05\d{8}$/.test(phone.replace(/\D/g,''))) return alert("מספר טלפון לא תקין (צריך להיות 05XXXXXXXX)");
        if(!name) return alert("נא להזין שם מפרסם");

        UI.loader(true);
        // ... (שאר הלוגיקה של addDoc)
    };
</script>
