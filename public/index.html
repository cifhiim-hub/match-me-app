<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MatchMe Pro | Premium Edition</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200;400;600;800&family=Rubik:wght@900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --accent: #10b981;
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
        }

        body {
            font-family: 'Assistant', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            margin: 0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 24px;
        }

        .btn-action {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
            transition: 0.2s;
        }

        .btn-action:active { transform: scale(0.95); }

        .input-modern {
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 14px;
            padding: 14px;
            color: white;
            width: 100%;
        }

        .floating-nav {
            position: fixed; bottom: 20px; left: 20px; right: 20px;
            height: 70px; background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px); border-radius: 35px;
            display: flex; justify-content: space-around; align-items: center;
            z-index: 1000; border: 1px solid rgba(255,255,255,0.1);
        }

        .nav-link { font-size: 10px; font-weight: 800; color: var(--text-dim); text-align: center; }
        .nav-link.active { color: var(--primary); }

        .page-content { display: none; animation: fadeIn 0.4s ease; }
        .page-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; }
        .toast { background: #1e293b; color: white; padding: 12px 25px; border-radius: 50px; border: 1px solid var(--primary); margin-bottom: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    </style>
</head>
<body>
    <div id="toast-container"></div>

    <div id="app-loader" class="fixed inset-0 bg-slate-950 z-[10000] flex flex-col items-center justify-center">
        <div class="w-16 h-16 border-4 border-blue-500/20 border-t-blue-500 rounded-full animate-spin"></div>
        <h2 class="mt-4 font-black text-xl italic uppercase tracking-tighter">Match<span class="text-blue-500">Me</span></h2>
    </div>
    <section id="view-feed" class="page-content active px-5 pt-8 pb-32">
        <header class="flex justify-between items-center mb-8">
            <div>
                <p class="text-xs font-bold text-blue-400 uppercase tracking-widest">×‘×¨×•×›×™× ×”×‘××™×,</p>
                <h1 class="text-3xl font-extrabold" id="display-user-name">××•×¨×—/×ª</h1>
            </div>
            <div class="w-12 h-12 glass-panel flex items-center justify-center text-xl">ğŸ‘¤</div>
        </header>

        <input type="text" id="search-input" oninput="UI.doSearch(this.value)" class="input-modern mb-6" placeholder="×—×¤×© ××©×¨×”, ×¢×™×¨ ××• ×—×‘×¨×”...">

        <div id="feed-container" class="space-y-4">
            </div>
    </section>

    <section id="view-post" class="page-content px-5 pt-8 pb-32">
        <h2 class="text-2xl font-black mb-6">×¤×¨×¡× ××•×“×¢×” ×—×“×©×”</h2>
        <div class="glass-panel p-6 space-y-4">
            <select id="inp-type" onchange="UI.toggleQuizBuilder()" class="input-modern text-blue-400 font-bold">
                <option value="job">ğŸ’¼ ×× ×™ ××—×¤×© ×¢×•×‘×“</option>
                <option value="worker">ğŸ™‹â€â™‚ï¸ ×× ×™ ××—×¤×© ×¢×‘×•×“×”</option>
            </select>
            <input type="text" id="inp-title" class="input-modern" placeholder="×›×•×ª×¨×ª ×”××•×“×¢×”">
            <input type="text" id="inp-name" class="input-modern" placeholder="×©× ×”×¢×¡×§ / ××¤×¨×¡×">
            <input type="text" id="inp-city" class="input-modern" placeholder="×¢×™×¨">
            <input type="tel" id="inp-phone" class="input-modern" placeholder="×˜×œ×¤×•×Ÿ (×œ×•×•××˜×¡××¤)">
            <textarea id="inp-desc" class="input-modern h-24" placeholder="×¤×™×¨×•×˜ × ×•×¡×£..."></textarea>
            
            <div id="quiz-section">
                <p class="text-[10px] font-bold text-blue-400 mb-2">×©××œ×•×ª ×¡×™× ×•×Ÿ (×›×Ÿ/×œ×):</p>
                <div id="quiz-list" class="space-y-2">
                    <input type="text" class="q-input input-modern py-2 text-sm" placeholder="×©××œ×”: ×”×× ×™×© ×œ×š ×¨×™×©×™×•×Ÿ?">
                </div>
                <button onclick="UI.addQField()" class="text-blue-500 text-xs mt-2 font-bold">+ ×”×•×¡×£ ×©××œ×”</button>
            </div>

            <button onclick="Data.publish()" class="btn-action w-full py-4 rounded-xl font-bold mt-4">×¤×¨×¡× ×¢×›×©×™×• âœ¨</button>
        </div>
    </section>

    <section id="view-admin" class="page-content px-5 pt-8 pb-32">
        <div id="auth-ui">
            <h2 class="text-2xl font-black mb-8 text-center">×”×ª×—×‘×¨×•×ª ×œ××¢×¨×›×ª</h2>
            <div class="space-y-3">
                <input type="email" id="auth-email" class="input-modern" placeholder="××™××™×™×œ">
                <input type="password" id="auth-pass" class="input-modern" placeholder="×¡×™×¡××”">
                <button onclick="Auth.handle('login')" class="btn-action w-full py-4 rounded-xl font-bold">×”×ª×—×‘×¨</button>
                <button onclick="Auth.handle('signup')" class="w-full text-slate-500 text-sm font-bold mt-4">×™×¦×™×¨×ª ×—×©×‘×•×Ÿ ×—×“×©</button>
            </div>
        </div>

        <div id="dash-ui" class="hidden">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-black">×”× ×™×”×•×œ ×©×œ×™</h2>
                <button onclick="Auth.logout()" class="text-red-400 text-xs font-bold underline">×”×ª× ×ª×§</button>
            </div>
            <div id="my-posts" class="mb-8 space-y-3"></div>
            <h3 class="font-bold text-green-400 mb-4 uppercase text-xs tracking-widest">×¤× ×™×•×ª ×©×§×™×‘×œ×ª</h3>
            <div id="my-leads" class="space-y-4"></div>
        </div>
    </section>

    <nav class="floating-nav">
        <div class="nav-link active" onclick="Router.go('feed')">ğŸ <br>×œ×•×—</div>
        <div class="nav-link" onclick="Router.go('post')">â•<br>×¤×¨×¡×</div>
        <div class="nav-link" onclick="Router.go('admin')">ğŸ‘¤<br>× ×™×”×•×œ</div>
    </nav>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, serverTimestamp, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD0hsz8SOI1OG2Fh-DBy1SHeabPaEKZx-Y",
        authDomain: "matchme-32bcf.firebaseapp.com",
        projectId: "matchme-32bcf",
        storageBucket: "matchme-32bcf.appspot.com",
        appId: "1:1082863959305:web:f888f4df815598696c601f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let GlobalState = { user: null, posts: [] };

    const Router = {
        go(viewId) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
            document.getElementById(`view-${viewId}`).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            if(viewId === 'feed') Data.load();
            if(viewId === 'admin') UI.refreshDash();
        }
    };

    const Toast = {
        show(msg) {
            const c = document.getElementById('toast-container');
            const t = document.createElement('div');
            t.className = 'toast'; t.innerText = msg;
            c.appendChild(t); setTimeout(() => t.remove(), 3000);
        }
    };

    const UI = {
        loader(s) { document.getElementById('app-loader').style.display = s ? 'flex' : 'none'; },
        toggleQuizBuilder() {
            document.getElementById('quiz-section').style.display = document.getElementById('inp-type').value === 'job' ? 'block' : 'none';
        },
        addQField() {
            const inp = document.createElement('input');
            inp.className = "q-input input-modern py-2 text-sm mt-2";
            inp.placeholder = "×©××œ×” × ×•×¡×¤×ª...";
            document.getElementById('quiz-list').appendChild(inp);
        },
        doSearch(val) {
            const filtered = GlobalState.posts.filter(p => p.title.toLowerCase().includes(val.toLowerCase()));
            UI.renderFeed(filtered);
        },
        renderFeed(list) {
            const container = document.getElementById('feed-container');
            container.innerHTML = list.map(item => `
                <div class="glass-panel p-5 border-r-4 ${item.type==='job'?'border-blue-500':'border-green-500'}" onclick="App.apply('${item.id}')">
                    <div class="flex justify-between text-[10px] font-bold opacity-50 mb-1">
                        <span>${item.type==='job'?'ğŸ’¼ ×“×¨×•×©×™×':'ğŸ™‹â€â™‚ï¸ ×¢×•×‘×“'}</span>
                        <span>ğŸ“ ${item.city}</span>
                    </div>
                    <h3 class="text-xl font-bold">${item.title}</h3>
                    <p class="text-blue-400 text-sm font-bold mb-3">${item.name}</p>
                    <div class="text-blue-500 text-[10px] font-black uppercase">×œ×—×¥ ×œ×”×’×©×ª ××•×¢××“×•×ª âœ¨</div>
                </div>
            `).join('');
        },
        async refreshDash() {
            if(!GlobalState.user) return;
            document.getElementById('auth-ui').classList.add('hidden');
            document.getElementById('dash-ui').classList.remove('hidden');
            
            const pSnap = await getDocs(query(collection(db, "posts"), where("owner", "==", GlobalState.user.uid)));
            document.getElementById('my-posts').innerHTML = pSnap.docs.map(d => `
                <div class="p-3 bg-slate-800 rounded-xl flex justify-between items-center text-sm">
                    <span>${d.data().title}</span>
                    <button onclick="Data.deletePost('${d.id}')" class="text-red-400 font-bold bg-red-900/10 px-3 py-1 rounded-lg">××—×§</button>
                </div>
            `).join('');

            const lSnap = await getDocs(query(collection(db, "leads"), where("bossID", "==", GlobalState.user.uid)));
            document.getElementById('my-leads').innerHTML = lSnap.docs.map(d => `
                <div class="glass-panel p-4 border-r-4 border-green-500">
                    <div class="flex justify-between">
                        <b>${d.data().candidateName}</b>
                        <span class="text-green-400 font-black">${d.data().matchScore}%</span>
                    </div>
                    <a href="https://wa.me/972${d.data().candidatePhone.substring(1)}" class="block text-center py-2 bg-green-500/10 text-green-400 rounded-xl text-xs font-bold mt-3">×•×•××˜×¡××¤</a>
                </div>
            `).join('');
        }
    };
    const Data = {
        async load() {
            UI.loader(true);
            const snap = await getDocs(query(collection(db, "posts"), orderBy("createdAt", "desc")));
            GlobalState.posts = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            UI.renderFeed(GlobalState.posts);
            UI.loader(false);
        },
        async publish() {
            const title = document.getElementById('inp-title').value;
            const phone = document.getElementById('inp-phone').value;
            if(!title || phone.length < 9) return Toast.show("× × ×œ××œ× ×¤×¨×˜×™× ×ª×§×™× ×™×");

            UI.loader(true);
            const qs = Array.from(document.querySelectorAll('.q-input')).map(i => i.value).filter(v => v);
            await addDoc(collection(db, "posts"), {
                type: document.getElementById('inp-type').value,
                title, name: document.getElementById('inp-name').value,
                city: document.getElementById('inp-city').value,
                phone: phone.replace(/\D/g,''),
                desc: document.getElementById('inp-desc').value,
                questions: qs, owner: GlobalState.user?.uid || 'guest',
                createdAt: serverTimestamp()
            });
            Toast.show("×¤×•×¨×¡× ×‘×”×¦×œ×—×”!"); Router.go('feed');
        },
        async deletePost(id) {
            if(confirm("×œ××—×•×§?")) { await deleteDoc(doc(db, "posts", id)); UI.refreshDash(); }
        }
    };

    const App = {
        async apply(id) {
            const post = GlobalState.posts.find(p => p.id === id);
            let name = localStorage.getItem('m_name') || prompt("××” ×©××š?");
            let phone = localStorage.getItem('m_phone') || prompt("×˜×œ×¤×•×Ÿ?");
            if(!name || !phone) return;
            localStorage.setItem('m_name', name); localStorage.setItem('m_phone', phone);

            let score = 0;
            if(post.questions?.length) {
                for(let q of post.questions) { if(confirm(q)) score += (100 / post.questions.length); }
            } else { score = 100; }

            UI.loader(true);
            await addDoc(collection(db, "leads"), {
                bossID: post.owner, jobTitle: post.title, candidateName: name,
                candidatePhone: phone.replace(/\D/g,''), matchScore: Math.round(score),
                createdAt: serverTimestamp()
            });
            window.location.href = `https://wa.me/972${post.phone.substring(1)}?text=×”×™×™, ××¢×•× ×™×™×Ÿ ×‘${post.title}. ×”×ª×××”: ${Math.round(score)}%`;
        }
    };

    const Auth = {
        async handle(mode) {
            const e = document.getElementById('auth-email').value, p = document.getElementById('auth-pass').value;
            UI.loader(true);
            try {
                mode === 'login' ? await signInWithEmailAndPassword(auth, e, p) : await createUserWithEmailAndPassword(auth, e, p);
                location.reload();
            } catch { Toast.show("×©×’×™××” ×‘×—×™×‘×•×¨"); UI.loader(false); }
        },
        logout() { signOut(auth).then(() => location.reload()); }
    };

    onAuthStateChanged(auth, u => {
        GlobalState.user = u;
        if(u) {
            document.getElementById('display-user-name').innerText = u.email.split('@')[0];
            UI.refreshDash();
        }
    });

    Data.load();
    window.Router = Router; window.UI = UI; window.Data = Data; window.Auth = Auth; window.App = App;
</script>
</body>
</html>
